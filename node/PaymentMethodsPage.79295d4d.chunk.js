"use strict";exports.id=697,exports.ids=[697],exports.modules={973:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var a=r(6689),n=r.n(a),o=r(6695),s=r(6022),l=r(1233),i=r(4941),m=(r(3665),r(2790)),d=r(3093),c=r(6902),h=r(9930),u=r(2745),p=r(7600),y=r(2411),P=r(9003),g=r.n(P),M=r(6639);const _={root:"PaymentMethodsForm_root__IjHRq",card:"PaymentMethodsForm_card__piZp1 marketplaceInputStyles",cardError:"PaymentMethodsForm_cardError__3uteV",error:"PaymentMethodsForm_error__L9do+",errorMessage:"PaymentMethodsForm_errorMessage__Zq0Am",paymentHeading:"PaymentMethodsForm_paymentHeading__P1KfT",messageHeading:"PaymentMethodsForm_messageHeading__3ZLXi",messageLabel:"PaymentMethodsForm_messageLabel__qIBFX",messageOptional:"PaymentMethodsForm_messageOptional__44RXZ",message:"PaymentMethodsForm_message__ok9Pb",submitContainer:"PaymentMethodsForm_submitContainer__9szIN",infoText:"PaymentMethodsForm_infoText__Wunwb h5",submitButton:"PaymentMethodsForm_submitButton__ltWAh",missingStripeKey:"PaymentMethodsForm_missingStripeKey__5o2CU",paymentAddressField:"PaymentMethodsForm_paymentAddressField__jgaak",formRow:"PaymentMethodsForm_formRow__TODWa",postalCode:"PaymentMethodsForm_postalCode__4wOQC",city:"PaymentMethodsForm_city__iz67K",field:"PaymentMethodsForm_field__lXCiE"},b=(e,t)=>{const{message:r,code:a,type:n}=t;if(!a||!n)return e.formatMessage({id:"PaymentMethodsForm.genericError"});const o="validation_error"===n?"PaymentMethodsForm.stripe.validation_error.".concat(a):"PaymentMethodsForm.stripe.".concat(n);return e.formatMessage({id:o,defaultMessage:r})},E={fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Inter"}]},f={base:{fontFamily:'-apple-system, BlinkMacSystemFont, "Inter var", Helvetica, Arial, sans-serif',fontSize:"undefined"!==typeof window&&window.innerWidth<768?"14px":"16px",fontSmoothing:"antialiased",lineHeight:"24px",letterSpacing:"-0.1px",color:"#4A4A4A","::placeholder":{color:"#B2B2B2"}}},C={error:null,cardValueValid:!1};class S extends a.Component{constructor(e){super(e),this.state=C,this.handleCardValueChange=this.handleCardValueChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.paymentForm=this.paymentForm.bind(this),this.finalFormAPI=null,this.stripe=null}componentDidMount(){var e,t;if(!window.Stripe)throw new Error("Stripe must be loaded for PaymentMethodsForm");const r=null===(e=this.props.config)||void 0===e||null===(t=e.stripe)||void 0===t?void 0:t.publishableKey;if(r){this.stripe=window.Stripe(r);const e=this.stripe.elements(E);this.card=e.create("card",{style:f}),this.card.mount(this.cardContainer),this.card.addEventListener("change",this.handleCardValueChange),window.addEventListener("resize",(()=>{window.innerWidth<768?this.card.update({style:{base:{fontSize:"14px",lineHeight:"24px"}}}):this.card.update({style:{base:{fontSize:"18px",lineHeight:"24px"}}})}))}}componentWillUnmount(){this.card&&(this.card.removeEventListener("change",this.handleCardValueChange),this.card.unmount())}handleCardValueChange(e){const{intl:t}=this.props,{error:r,complete:a}=e,n=e.value.postalCode;this.finalFormAPI&&this.finalFormAPI.change("postal",n),this.setState((e=>({error:r?b(t,r):null,cardValueValid:a})))}handleSubmit(e){const{onSubmit:t,inProgress:r,formId:a}=this.props,n=!this.state.cardValueValid;if(r||n)return;t({stripe:this.stripe,card:this.card,formId:a,formValues:e})}paymentForm(e){const{className:t,rootClassName:r,inProgress:a,formId:o,intl:s,invalid:i,handleSubmit:m,addPaymentMethodError:d,deletePaymentMethodError:c,createStripeCustomerError:u,handleCardSetupError:p,form:y,config:P}=e;this.finalFormAPI=y;const M=!this.state.cardValueValid,b=i||M||a,E=this.state.error&&!a,f=g()(r||_.root,t),C=g()(_.card,{[_.cardSuccess]:this.state.cardValueValid,[_.cardError]:E}),S=d||c||u||p,F=s.formatMessage({id:"PaymentMethodsForm.genericError"}),N=s.formatMessage({id:"PaymentMethodsForm.billingDetailsNameLabel"}),v=s.formatMessage({id:"PaymentMethodsForm.billingDetailsNamePlaceholder"}),I=s.formatMessage({id:"PaymentMethodsForm.infoText"},{marketplaceName:P.marketplaceName}),w=n().createElement(h.hy,{intl:s,form:y,fieldId:o,card:this.card,locale:P.localization.locale});return P.stripe.publishableKey?n().createElement(h.l0,{className:f,onSubmit:m},n().createElement("label",{className:_.paymentLabel,htmlFor:"".concat(o,"-card")},n().createElement(l._H,{id:"PaymentMethodsForm.paymentCardDetails"})),n().createElement("div",{className:C,id:"".concat(o,"-card"),ref:e=>{this.cardContainer=e}}),n().createElement("div",{className:_.infoText},I),E?n().createElement("span",{className:_.error},this.state.error):null,n().createElement("div",{className:_.paymentAddressField},n().createElement(h.H4,{as:"h3"},n().createElement(l._H,{id:"PaymentMethodsForm.billingDetails"})),n().createElement(h.gC,{className:_.field,type:"text",id:"name",name:"name",autoComplete:"cc-name",label:N,placeholder:v}),w),n().createElement("div",{className:_.submitContainer},S?n().createElement("span",{className:_.errorMessage},S.message?S.message:F):null,n().createElement(h.KM,{className:_.submitButton,type:"submit",inProgress:a,disabled:b},n().createElement(l._H,{id:"PaymentMethodsForm.submitPaymentInfo"})))):n().createElement("div",{className:_.missingStripeKey},n().createElement(l._H,{id:"PaymentMethodsForm.missingStripeKey"}))}render(){const{onSubmit:e,...t}=this.props;return n().createElement(y.Form,Object.assign({onSubmit:this.handleSubmit},t,{render:this.paymentForm}))}}S.defaultProps={className:null,rootClassName:null,inProgress:!1,onSubmit:null,addPaymentMethodError:null,deletePaymentMethodError:null,createStripeCustomerError:null,handleCardSetupError:null,form:null};const F=e=>{const t=(0,M.mX)(),r=(0,l.YB)();return n().createElement(S,Object.assign({config:t,intl:r},e))};var N=r(1465);const v={content:"PaymentMethodsPage_content__3X1Dt",desktopTopbar:"PaymentMethodsPage_desktopTopbar__W5r3o",mobileTopbar:"PaymentMethodsPage_mobileTopbar__9YjSm"},I=e=>{const[t,r]=(0,a.useState)(!1),[o,s]=(0,a.useState)(null),{currentUser:m,addPaymentMethodError:d,deletePaymentMethodError:c,createStripeCustomerError:y,handleCardSetupError:P,deletePaymentMethodInProgress:g,onCreateSetupIntent:M,onHandleCardSetup:_,onSavePaymentMethod:b,onDeletePaymentMethod:E,fetchStripeCustomer:f,scrollingDisabled:C,onManageDisableScrolling:S,intl:N,stripeCustomerFetched:I}=e,w=e=>e&&e.attributes?e.attributes.clientSecret:null,V=(e,t)=>{const{name:r,addressLine1:a,addressLine2:n,postal:o,state:s,city:l,country:m}=t,d=a&&o?{address:{city:l,country:m,line1:a,line2:n,postal_code:o,state:s}}:{};return{payment_method_data:{billing_details:{name:r,email:(0,i.j0)(e).attributes.email,...d}}}},H=()=>{E().then((()=>{f()}))},x=N.formatMessage({id:"PaymentMethodsPage.title"}),D=(0,i.j0)(m),A=!!D.id,T=m&&(0,i.Cy)(m.stripeCustomer).attributes.stripeCustomerId&&(0,i.S2)(m.stripeCustomer.defaultPaymentMethod).id,L={name:A?"".concat(D.attributes.profile.firstName," ").concat(D.attributes.profile.lastName):null},k=T?(0,i.S2)(m.stripeCustomer.defaultPaymentMethod).attributes.card:null,B="replaceCard"===o||!T,z=!!T;return n().createElement(h.T3,{title:x,scrollingDisabled:C},n().createElement(h.i_,{topbar:n().createElement(n().Fragment,null,n().createElement(u.Z,{currentPage:"PaymentMethodsPage",desktopClassName:v.desktopTopbar,mobileClassName:v.mobileTopbar}),n().createElement(h.Tb,{currentPage:"PaymentMethodsPage"})),sideNav:null,useAccountSettingsNav:!0,currentPage:"PaymentMethodsPage",footer:n().createElement(p.Z,null)},n().createElement("div",{className:v.content},n().createElement(h.H3,{as:"h1"},n().createElement(l._H,{id:"PaymentMethodsPage.heading"})),I?n().createElement(n().Fragment,null,z?n().createElement(h.Me,{card:k,onManageDisableScrolling:S,onChange:s,onDeleteCard:H,deletePaymentMethodInProgress:g}):null,B?n().createElement(F,{className:v.paymentForm,formId:"PaymentMethodsForm",initialValues:L,onSubmit:e=>{r(!0);const t=(0,i.j0)(m).stripeCustomer,{stripe:a,card:n,formValues:o}=e;M().then((e=>{const t={stripe:a,card:n,setupIntentClientSecret:w(e),paymentParams:V(m,o)};return _(t)})).then((e=>{const r=e.setupIntent.payment_method;return b(t,r)})).then((()=>{f(),r(!1),s("default")})).catch((e=>{console.error(e),r(!1)}))},handleRemovePaymentMethod:H,hasDefaultPaymentMethod:T,addPaymentMethodError:d,deletePaymentMethodError:c,createStripeCustomerError:y,handleCardSetupError:P,inProgress:t}):null):null)))};I.defaultProps={currentUser:null,addPaymentMethodError:null,deletePaymentMethodError:null,createStripeCustomerError:null,handleCardSetupError:null};const w=(0,o.compose)((0,s.connect)((e=>{const{currentUser:t}=e.user,{deletePaymentMethodInProgress:r,addPaymentMethodError:a,deletePaymentMethodError:n,createStripeCustomerError:o}=e.paymentMethods,{stripeCustomerFetched:s}=e.PaymentMethodsPage,{handleCardSetupError:l}=e.stripe;return{currentUser:t,scrollingDisabled:(0,c.uS)(e),deletePaymentMethodInProgress:r,addPaymentMethodError:a,deletePaymentMethodError:n,createStripeCustomerError:o,handleCardSetupError:l,stripeCustomerFetched:s}}),(e=>({onManageDisableScrolling:(t,r)=>e((0,c.R4)(t,r)),fetchStripeCustomer:()=>e((0,N.sz)()),onHandleCardSetup:t=>e((0,d.c8)(t)),onCreateSetupIntent:t=>e((0,N.zw)(t)),onSavePaymentMethod:(t,r)=>e((0,m.BX)(t,r)),onDeletePaymentMethod:t=>e((0,m.gp)(t))}))),l.XN)(I)}};
//# sourceMappingURL=PaymentMethodsPage.79295d4d.chunk.js.map