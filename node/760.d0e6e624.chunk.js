"use strict";exports.id=760,exports.ids=[760],exports.modules={1760:(e,t,a)=>{a.d(t,{Z:()=>x});var i=a(6689),n=a.n(i),r=a(2411),s=a(9003),l=a.n(s),o=a(1233),m=(a(3665),a(4941)),d=a(9930),c=a(1341),p=a(775);const h="ShippingDetails_root__YJSTk",g="ShippingDetails_heading__Y2aKv p",u="ShippingDetails_formRow__2bxpH",y="ShippingDetails_field__qPTQ+",S="ShippingDetails_fieldFullWidth__BWtHK",P=e=>{const{rootClassName:t,className:a,locale:i,intl:r,disabled:s,formApi:m,fieldId:P}=e,f=l()(t||h,a),C=r.formatMessage({id:"ShippingDetails.optionalText"}),E=(0,p.Z)(i);return n().createElement("div",{className:f},n().createElement(d.X6,{as:"h3",rootClassName:g},n().createElement(o._H,{id:"ShippingDetails.title"})),n().createElement(d.gC,{id:"".concat(P,".recipientName"),name:"recipientName",disabled:s,className:S,type:"text",autoComplete:"shipping name",label:r.formatMessage({id:"ShippingDetails.recipientNameLabel"}),placeholder:r.formatMessage({id:"ShippingDetails.recipientNamePlaceholder"}),validate:c.C1(r.formatMessage({id:"ShippingDetails.recipientNameRequired"})),onUnmount:()=>m.change("recipientName",void 0)}),n().createElement(d.gC,{id:"".concat(P,".recipientPhoneNumber"),name:"recipientPhoneNumber",disabled:s,className:S,type:"text",autoComplete:"shipping phoneNumber",label:r.formatMessage({id:"ShippingDetails.recipientPhoneNumberLabel"},{optionalText:C}),placeholder:r.formatMessage({id:"ShippingDetails.recipientPhoneNumberPlaceholder"}),onUnmount:()=>m.change("recipientPhoneNumber",void 0)}),n().createElement("div",{className:u},n().createElement(d.gC,{id:"".concat(P,".recipientAddressLine1"),name:"recipientAddressLine1",disabled:s,className:y,type:"text",autoComplete:"shipping address-line1",label:r.formatMessage({id:"ShippingDetails.addressLine1Label"}),placeholder:r.formatMessage({id:"ShippingDetails.addressLine1Placeholder"}),validate:c.C1(r.formatMessage({id:"ShippingDetails.addressLine1Required"})),onUnmount:()=>m.change("recipientAddressLine1",void 0)}),n().createElement(d.gC,{id:"".concat(P,".recipientAddressLine2"),name:"recipientAddressLine2",disabled:s,className:y,type:"text",autoComplete:"shipping address-line2",label:r.formatMessage({id:"ShippingDetails.addressLine2Label"},{optionalText:C}),placeholder:r.formatMessage({id:"ShippingDetails.addressLine2Placeholder"}),onUnmount:()=>m.change("recipientAddressLine2",void 0)})),n().createElement("div",{className:u},n().createElement(d.gC,{id:"".concat(P,".recipientPostalCode"),name:"recipientPostal",disabled:s,className:y,type:"text",autoComplete:"shipping postal-code",label:r.formatMessage({id:"ShippingDetails.postalCodeLabel"}),placeholder:r.formatMessage({id:"ShippingDetails.postalCodePlaceholder"}),validate:c.C1(r.formatMessage({id:"ShippingDetails.postalCodeRequired"})),onUnmount:()=>m.change("recipientPostal",void 0)}),n().createElement(d.gC,{id:"".concat(P,".recipientCity"),name:"recipientCity",disabled:s,className:y,type:"text",autoComplete:"shipping address-level2",label:r.formatMessage({id:"ShippingDetails.cityLabel"}),placeholder:r.formatMessage({id:"ShippingDetails.cityPlaceholder"}),validate:c.C1(r.formatMessage({id:"ShippingDetails.cityRequired"})),onUnmount:()=>m.change("recipientCity",void 0)})),n().createElement("div",{className:u},n().createElement(d.gC,{id:"".concat(P,".recipientState"),name:"recipientState",disabled:s,className:y,type:"text",autoComplete:"shipping address-level1",label:r.formatMessage({id:"ShippingDetails.stateLabel"},{optionalText:C}),placeholder:r.formatMessage({id:"ShippingDetails.statePlaceholder"}),onUnmount:()=>m.change("recipientState",void 0)}),n().createElement(d.Wy,{id:"".concat(P,".recipientCountry"),name:"recipientCountry",disabled:s,className:y,label:r.formatMessage({id:"ShippingDetails.countryLabel"}),validate:c.C1(r.formatMessage({id:"ShippingDetails.countryRequired"}))},n().createElement("option",{disabled:!0,value:""},r.formatMessage({id:"ShippingDetails.countryPlaceholder"})),E.map((e=>n().createElement("option",{key:e.code,value:e.code},e.name))))))};P.defaultProps={rootClassName:null,className:null,disabled:!1,fieldId:null};const f=P,C={root:"StripePaymentForm_root__hbiuC",locationWrapper:"StripePaymentForm_locationWrapper__2KG8C",heading:"StripePaymentForm_heading__p2zD8 p",locationDetails:"StripePaymentForm_locationDetails__UB4YX",card:"StripePaymentForm_card__vw7yG marketplaceInputStyles",cardError:"StripePaymentForm_cardError__0Oi2a",error:"StripePaymentForm_error__LIO0Z",errorMessage:"StripePaymentForm_errorMessage__UtRNh",paymentMethodSelector:"StripePaymentForm_paymentMethodSelector__ylBMy",saveForLaterUse:"StripePaymentForm_saveForLaterUse__MzO+Z",saveForLaterUseCheckbox:"StripePaymentForm_saveForLaterUseCheckbox__nIbci",saveForLaterUseLabel:"StripePaymentForm_saveForLaterUseLabel__HVqvK h5",saveForLaterUseLegalInfo:"StripePaymentForm_saveForLaterUseLegalInfo__LLu7- h5",billingDetails:"StripePaymentForm_billingDetails__oCkv9",sameAddressCheckbox:"StripePaymentForm_sameAddressCheckbox__LnjYi",messageLabel:"StripePaymentForm_messageLabel__2WvIC",messageOptional:"StripePaymentForm_messageOptional__ESxce",message:"StripePaymentForm_message__2HH+h",submitContainer:"StripePaymentForm_submitContainer__+n637",paymentInfo:"StripePaymentForm_paymentInfo__CFlG6 h5",submitButton:"StripePaymentForm_submitButton__6ayQi",missingStripeKey:"StripePaymentForm_missingStripeKey__PSMlx"},E=(e,t)=>{const{message:a,code:i,type:n}=t;if(!i||!n)return e.formatMessage({id:"StripePaymentForm.genericError"});const r="validation_error"===n?"StripePaymentForm.stripe.validation_error.".concat(i):"StripePaymentForm.stripe.".concat(n);return e.formatMessage({id:r,defaultMessage:a})},b={fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Inter"}]},_={base:{fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", Helvetica, Arial, sans-serif',fontSize:"undefined"!==typeof window&&window.innerWidth<768?"14px":"16px",fontSmoothing:"antialiased",lineHeight:"24px",letterSpacing:"-0.1px",color:"#4A4A4A","::placeholder":{color:"#B2B2B2"}}},F=e=>{const{cardClasses:t,formId:a,handleStripeElementRef:i,hasCardError:r,error:s,label:l,intl:m,marketplaceName:c}=e,p=l||m.formatMessage({id:"StripePaymentForm.saveAfterOnetimePayment"});return n().createElement(n().Fragment,null,n().createElement("label",{className:C.paymentLabel,htmlFor:"".concat(a,"-card")},n().createElement(o._H,{id:"StripePaymentForm.paymentCardDetails"})),n().createElement("div",{className:t,id:"".concat(a,"-card"),ref:i}),r?n().createElement("span",{className:C.error},s):null,n().createElement("div",{className:C.saveForLaterUse},n().createElement(d.vE,{className:C.saveForLaterUseCheckbox,textClassName:C.saveForLaterUseLabel,id:"saveAfterOnetimePayment",name:"saveAfterOnetimePayment",label:p,value:"saveAfterOnetimePayment",useSuccessColor:!0}),n().createElement("span",{className:C.saveForLaterUseLegalInfo},n().createElement(o._H,{id:"StripePaymentForm.saveforLaterUseLegalInfo",values:{marketplaceName:c}}))))},v=e=>{const{cardClasses:t,formId:a,changePaymentMethod:i,defaultPaymentMethod:r,handleStripeElementRef:s,hasCardError:l,error:m,paymentMethod:c,intl:p,marketplaceName:h}=e,g=r.attributes.card.last4Digits,u=p.formatMessage({id:"StripePaymentForm.replaceAfterOnetimePayment"},{last4Digits:g});return n().createElement(n().Fragment,null,n().createElement(d.X6,{as:"h3",rootClassName:C.heading},n().createElement(o._H,{id:"StripePaymentForm.payWithHeading"})),n().createElement(d.Me,{className:C.paymentMethodSelector,card:r.attributes.card,onChange:i}),"replaceCard"===c?n().createElement(F,{cardClasses:t,formId:a,handleStripeElementRef:s,hasCardError:l,error:m,label:u,intl:p,marketplaceName:h}):null)},M=(e,t)=>null==e&&t?"defaultCard":null==e?"onetimeCardPayment":e,N=(e,t,a,i)=>{const n=i||"defaultCard"===t&&a,r=["onetimeCardPayment","replaceCard"].includes(t);return{onetimePaymentNeedsAttention:!n&&!(r&&e),showOnetimePaymentFields:r}},L=e=>{const{askShippingDetails:t,showPickUplocation:a,listingLocation:i,formApi:r,locale:s,isBooking:l,isFuzzyLocation:m,intl:c}=e,p=null!==i&&void 0!==i&&i.building?"".concat(i.building,", ").concat(i.address):null!==i&&void 0!==i&&i.address?i.address:c.formatMessage({id:"StripePaymentForm.locationUnknown"});return t?n().createElement(f,{intl:c,formApi:r,locale:s}):!l&&a?n().createElement("div",{className:C.locationWrapper},n().createElement(d.X6,{as:"h3",rootClassName:C.heading},n().createElement(o._H,{id:"StripePaymentForm.pickupDetailsTitle"})),n().createElement("p",{className:C.locationDetails},p)):l&&!m?n().createElement("div",{className:C.locationWrapper},n().createElement(d.X6,{as:"h3",rootClassName:C.heading},n().createElement(o._H,{id:"StripePaymentForm.locationDetailsTitle"})),n().createElement("p",{className:C.locationDetails},p)):null},D={error:null,cardValueValid:!1,paymentMethod:null};class A extends i.Component{constructor(e){super(e),this.state=D,this.updateBillingDetailsToMatchShippingAddress=this.updateBillingDetailsToMatchShippingAddress.bind(this),this.handleCardValueChange=this.handleCardValueChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.paymentForm=this.paymentForm.bind(this),this.initializeStripeElement=this.initializeStripeElement.bind(this),this.handleStripeElementRef=this.handleStripeElementRef.bind(this),this.changePaymentMethod=this.changePaymentMethod.bind(this),this.finalFormAPI=null,this.cardContainer=null}componentDidMount(){if(!window.Stripe)throw new Error("Stripe must be loaded for StripePaymentForm");const e=this.props.stripePublishableKey;if(e){const{onStripeInitialized:t,hasHandledCardPayment:a,defaultPaymentMethod:i,loadingData:n}=this.props;this.stripe=window.Stripe(e),t(this.stripe),a||i||n||this.initializeStripeElement()}}componentWillUnmount(){this.card&&(this.card.removeEventListener("change",this.handleCardValueChange),this.card.unmount(),this.card=null)}initializeStripeElement(e){const t=this.stripe.elements(b);this.card||(this.card=t.create("card",{style:_}),this.card.mount(e||this.cardContainer),this.card.addEventListener("change",this.handleCardValueChange),window.addEventListener("resize",(()=>{this.card&&(window.innerWidth<768?this.card.update({style:{base:{fontSize:"14px",lineHeight:"24px"}}}):this.card.update({style:{base:{fontSize:"18px",lineHeight:"24px"}}}))})))}updateBillingDetailsToMatchShippingAddress(e){var t;const a=this.finalFormAPI,i=(null===(t=a.getState())||void 0===t?void 0:t.values)||{};a.batch((()=>{a.change("name",e?i.recipientName:""),a.change("addressLine1",e?i.recipientAddressLine1:""),a.change("addressLine2",e?i.recipientAddressLine2:""),a.change("postal",e?i.recipientPostal:""),a.change("city",e?i.recipientCity:""),a.change("state",e?i.recipientState:""),a.change("country",e?i.recipientCountry:"")}))}changePaymentMethod(e){this.card&&"defaultCard"===e&&(this.card.removeEventListener("change",this.handleCardValueChange),this.card.unmount(),this.card=null,this.setState({cardValueValid:!1})),this.setState({paymentMethod:e}),"defaultCard"===e&&this.finalFormAPI?this.finalFormAPI.change("sameAddressCheckbox",void 0):"replaceCard"===e&&this.finalFormAPI&&(this.finalFormAPI.change("sameAddressCheckbox",["sameAddress"]),this.updateBillingDetailsToMatchShippingAddress(!0))}handleStripeElementRef(e){this.cardContainer=e,this.stripe&&e&&this.initializeStripeElement(e)}handleCardValueChange(e){const{intl:t}=this.props,{error:a,complete:i}=e,n=e.value.postalCode;this.finalFormAPI&&this.finalFormAPI.change("postal",n),this.setState((e=>({error:a?E(t,a):null,cardValueValid:i})))}handleSubmit(e){const{onSubmit:t,inProgress:a,formId:i,hasHandledCardPayment:n,defaultPaymentMethod:r}=this.props,{initialMessage:s}=e,{cardValueValid:l,paymentMethod:o}=this.state,d=null===r||void 0===r?void 0:r.id,c=M(o,d),{onetimePaymentNeedsAttention:p}=N(l,c,d,n);if(a||p)return;t({message:s?s.trim():null,card:this.card,formId:i,formValues:e,paymentMethod:M(o,(0,m.S2)(r).id)})}paymentForm(e){const{className:t,rootClassName:a,inProgress:i,loadingData:r,formId:s,paymentInfo:c,authorDisplayName:p,showInitialMessageInput:h,intl:g,initiateOrderError:u,confirmCardPaymentError:y,confirmPaymentError:S,invalid:P,handleSubmit:f,form:E,hasHandledCardPayment:b,defaultPaymentMethod:_,listingLocation:D,askShippingDetails:A,showPickUplocation:x,totalPrice:I,locale:k,stripePublishableKey:H,marketplaceName:U,isBooking:w,isFuzzyLocation:B,values:z}=e;this.finalFormAPI=E;const V=(0,m.S2)(_),O=!(b||S),{cardValueValid:R,paymentMethod:T}=this.state,W=V.id,K=M(T,W),{onetimePaymentNeedsAttention:X,showOnetimePaymentFields:q}=N(R,K,W,b),Y=P||X||i,Z=this.state.error&&!i,G=y||S,j=l()(a||C.root,t),Q=l()(C.card,{[C.cardSuccess]:this.state.cardValueValid,[C.cardError]:Z}),J=I||"",$=y&&"payment_intent_authentication_failure"===y.code?g.formatMessage({id:"StripePaymentForm.confirmCardPaymentError"}):y?y.message:S?g.formatMessage({id:"StripePaymentForm.confirmPaymentError"}):g.formatMessage({id:"StripePaymentForm.genericError"}),ee=g.formatMessage({id:"StripePaymentForm.billingDetailsNameLabel"}),te=g.formatMessage({id:"StripePaymentForm.billingDetailsNamePlaceholder"}),ae=g.formatMessage({id:"StripePaymentForm.messagePlaceholder"},{name:p}),ie=g.formatMessage({id:"StripePaymentForm.messageOptionalText"}),ne=g.formatMessage({id:"StripePaymentForm.messageLabel"},{messageOptionalText:ie}),re=n().createElement(d.hy,{intl:g,form:E,fieldId:s,card:this.card,locale:k}),se=w?"yes":"no";return H?n().createElement(d.l0,{className:j,onSubmit:f,enforcePagePreloadFor:"OrderDetailsPage"},n().createElement(L,{askShippingDetails:A,showPickUplocation:x,listingLocation:D,isBooking:w,isFuzzyLocation:B,formApi:E,locale:k,intl:g}),O&&!r?n().createElement(n().Fragment,null,W?n().createElement(v,{cardClasses:Q,formId:s,defaultPaymentMethod:V,changePaymentMethod:this.changePaymentMethod,handleStripeElementRef:this.handleStripeElementRef,hasCardError:Z,error:this.state.error,paymentMethod:K,intl:g,marketplaceName:U}):n().createElement(n().Fragment,null,n().createElement(d.X6,{as:"h3",rootClassName:C.heading},n().createElement(o._H,{id:"StripePaymentForm.paymentHeading"})),n().createElement(F,{cardClasses:Q,formId:s,handleStripeElementRef:this.handleStripeElementRef,hasCardError:Z,error:this.state.error,intl:g,marketplaceName:U})),q?n().createElement("div",{className:C.billingDetails},n().createElement(d.X6,{as:"h3",rootClassName:C.heading},n().createElement(o._H,{id:"StripePaymentForm.billingDetails"})),A?n().createElement(d.vE,{className:C.sameAddressCheckbox,textClassName:C.sameAddressLabel,id:"sameAddressCheckbox",name:"sameAddressCheckbox",label:g.formatMessage({id:"StripePaymentForm.sameBillingAndShippingAddress"}),value:"sameAddress",useSuccessColor:!0,onChange:e=>{const t=e.target.checked;this.updateBillingDetailsToMatchShippingAddress(t)}}):null,n().createElement(d.gC,{className:C.field,type:"text",id:"name",name:"name",autoComplete:"cc-name",label:ee,placeholder:te}),re):null):r?n().createElement("p",{className:C.spinner},n().createElement(d.vM,null)):null,u?n().createElement("span",{className:C.errorMessage},u.message):null,h?n().createElement("div",null,n().createElement(d.X6,{as:"h3",rootClassName:C.heading},n().createElement(o._H,{id:"StripePaymentForm.messageHeading"})),n().createElement(d.gC,{type:"textarea",id:"".concat(s,"-message"),name:"initialMessage",label:ne,placeholder:ae,className:C.message})):null,n().createElement("div",{className:C.submitContainer},G?n().createElement("span",{className:C.errorMessage},$):null,n().createElement(d.KM,{className:C.submitButton,type:"submit",inProgress:i,disabled:Y},O?n().createElement(o._H,{id:"StripePaymentForm.submitPaymentInfo",values:{totalPrice:J,isBooking:se}}):n().createElement(o._H,{id:"StripePaymentForm.submitConfirmPaymentInfo",values:{totalPrice:J,isBooking:se}})),n().createElement("p",{className:C.paymentInfo},n().createElement(o._H,{id:"StripePaymentForm.submitConfirmPaymentFinePrint",values:{isBooking:se,name:p}})))):n().createElement("div",{className:C.missingStripeKey},n().createElement(o._H,{id:"StripePaymentForm.missingStripeKey"}))}render(){const{onSubmit:e,...t}=this.props;return n().createElement(r.Form,Object.assign({onSubmit:this.handleSubmit},t,{render:this.paymentForm}))}}A.defaultProps={className:null,rootClassName:null,inProgress:!1,loadingData:!1,showInitialMessageInput:!0,hasHandledCardPayment:!1,defaultPaymentMethod:null,initiateOrderError:null,confirmCardPaymentError:null,confirmPaymentError:null,askShippingDetails:!1,showPickUplocation:!1,listingLocation:null,totalPrice:null,isFuzzyLocation:!1};const x=(0,o.XN)(A)}};
//# sourceMappingURL=760.d0e6e624.chunk.js.map