"use strict";exports.id=661,exports.ids=[661],exports.modules={4817:(t,e,n)=>{n.d(e,{Z:()=>U});var a=n(6689),i=n.n(a),o=n(9003),s=n.n(o),r=(n(1233),n(3176)),l=(n(3665),n(1341)),d=n(9930);const m="FieldDateAndTimeInput_root__bNnFA",c="FieldDateAndTimeInput_formRow__AgXHr",u="FieldDateAndTimeInput_field__mlwWG",h="FieldDateAndTimeInput_fieldDateInput__usera",g="FieldDateAndTimeInput_fieldSelect__D8+qm",b="FieldDateAndTimeInput_fieldSelectDisabled__DHtUU FieldDateAndTimeInput_fieldSelect__D8+qm",p="FieldDateAndTimeInput_select__EvNg-",T="FieldDateAndTimeInput_selectDisabled__SUW5u FieldDateAndTimeInput_select__EvNg-",D="FieldDateAndTimeInput_arrowIcon__E4EL3",k="FieldDateAndTimeInput_startDate__uj2N+",y="FieldDateAndTimeInput_lineBetween__98BmD",E="FieldDateAndTimeInput_lineBetweenDisabled__7ITbZ",v=new Date,S=(t,e)=>(0,r.RY)(t,"month",e,1,"months"),_=(t,e)=>(0,r.RY)(t,"month",e,-1,"months"),f=(t,e,n)=>(0,r.RY)(t,"day",n,e-1,"days"),M=(t,e,n,a)=>{if(0===a.length||!a[0]||!n)return[];const i=(0,r.RY)(n,"day",e);return a.reduce(((n,a)=>{const o=a.attributes.start,s=a.attributes.end,l=(0,r.RY)(i,"day",e,1,"days"),d=(0,r.U$)(i,o)?i:o,m=(0,r.U$)(s,l)?l:s,c=(0,r.Sj)(d,m,e,t);return n.concat(c)}),[])},C=(t,e,n,a,i)=>{if(!i||!i.attributes||!a||!n)return[];const o=i.attributes.end,s=(0,r.Ft)(n),l=(0,r.RY)(a,"day",e,1,"days"),d=(0,r.RY)(s,"day",e,1,"days"),m=(0,r.RY)(a,"day",e);let c,u;return(0,r.U$)(m,s)?(c=(0,r.U$)(s,m)?s:m,u=(0,r.Fo)((0,r.RY)(o,"day",e),m)?o:l):(c=s,u=(0,r.U$)(d,o)?o:d),(0,r.Ym)(c,u,e,t)},N=(t,e,n)=>t&&t[0]?t.filter((t=>(0,r.mh)(e,t.attributes.start,t.attributes.end,"day",n))):[],I=(t,e,n,a,i,o)=>{const s=i?[]:M(t,e,a,N(n,a,e)),l=i||(s.length>0&&s[0]&&s[0].timestamp?s[0].timestamp.toString():null),d=l?(0,r.Ft)(l):null,m=o||(d?new Date((0,r.Kn)(d,"hour",e).getTime()-1):null),c=n.find((t=>(0,r.mh)(d,t.attributes.start,t.attributes.end))),u=C(t,e,l,m,c);return{startTime:l,endDate:m,endTime:u.length>0&&u[0]&&u[0].timestamp?u[0].timestamp.toString():null,selectedTimeSlot:c}},A=(t,e,n)=>{const a=(0,r.XU)(e,n);return t&&0!==Object.keys(t).length&&t[a]&&t[a].timeSlots?t[a].timeSlots:[]},F=t=>i().createElement(d.JT,Object.assign({},t,{direction:"left",rootClassName:D})),R=t=>i().createElement(d.JT,Object.assign({},t,{direction:"right",rootClassName:D})),Y=t=>{const{currentMonth:e,dayCountAvailableForBooking:n,timeZone:a}=t,o=S(e,a);return(0,r.U$)(o,f(v,n,a))?null:i().createElement(R,null)},B=t=>{const{currentMonth:e,timeZone:n}=t,a=_(e,n),o=(0,r.RY)(v,"month",n);return(0,r.U$)(a,o)?i().createElement(F,null):null};class Z extends a.Component{constructor(t){super(t),this.onBookingStartDateChange=t=>{const{monthlyTimeSlots:e,timeZone:n,intl:a,form:i}=this.props;if(!t||!t.date)return i.batch((()=>{i.change("bookingStartTime",null),i.change("bookingEndDate",{date:null}),i.change("bookingEndTime",null)})),void this.setState({currentMonth:(0,r.RY)(v,"month",n)});const o=(0,r.vc)(t.date,n),s=A(e,this.state.currentMonth,n),l=N(s,o,n),{startTime:d,endDate:m,endTime:c}=I(a,n,l,o);i.batch((()=>{i.change("bookingStartTime",d),i.change("bookingEndDate",{date:m}),i.change("bookingEndTime",c)}))},this.onBookingStartTimeChange=t=>{const{monthlyTimeSlots:e,timeZone:n,intl:a,form:i,values:o}=this.props,s=A(e,this.state.currentMonth,n),r=o.bookingStartDate.date,l=N(s,r,n),{endDate:d,endTime:m}=I(a,n,l,r,t);i.batch((()=>{i.change("bookingEndDate",{date:d}),i.change("bookingEndTime",m)}))},this.onBookingEndDateChange=t=>{const{monthlyTimeSlots:e,timeZone:n,intl:a,form:i,values:o}=this.props;if(!t||!t.date)return void i.change("bookingEndTime",null);const s=(0,r.vc)(t.date,n),{bookingStartDate:l,bookingStartTime:d}=o,m=l.date,c=A(e,this.state.currentMonth,n),u=N(c,m,n),{endTime:h}=I(a,n,u,m,d,s);i.change("bookingEndTime",h)},this.state={currentMonth:(0,r.RY)(v,"month",t.timeZone)},this.fetchMonthData=this.fetchMonthData.bind(this),this.onMonthClick=this.onMonthClick.bind(this),this.onBookingStartDateChange=this.onBookingStartDateChange.bind(this),this.onBookingStartTimeChange=this.onBookingStartTimeChange.bind(this),this.onBookingEndDateChange=this.onBookingEndDateChange.bind(this),this.isOutsideRange=this.isOutsideRange.bind(this)}fetchMonthData(t){const{listingId:e,timeZone:n,onFetchTimeSlots:a,dayCountAvailableForBooking:i}=this.props,o=f(v,i,n);if((0,r.mh)(t,v,o)){const i=(0,r.U$)(v,t)?v:t,s=S(t,n);a(e,i,(0,r.U$)(s,o)?(0,r.RY)(o,"day",n):s,n)}}onMonthClick(t){const{onMonthChanged:e,timeZone:n}=this.props;this.setState((e=>({currentMonth:t(e.currentMonth,n)})),(()=>{this.fetchMonthData(t(this.state.currentMonth,n));const a=(0,r.XU)(this.state.currentMonth,n),i=this.props.monthlyTimeSlots[a];i&&i.fetchTimeSlotsError&&this.fetchMonthData(this.state.currentMonth),e&&e(a)}))}isOutsideRange(t,e,n,a){if(!n)return!0;const i=(0,r.vc)(t,a),o=(0,r.RY)(e,"day",a),s=new Date(n.attributes.end.getTime()-1),l=(0,r.RY)(s,"day",a,1,"days");return!((0,r.U$)(i,o)&&(0,r.U$)(l,i))}render(){const{rootClassName:t,className:e,formId:n,startDateInputProps:a,values:o,monthlyTimeSlots:D,timeZone:f,intl:F,dayCountAvailableForBooking:R}=this.props,Z=s()(t||m,e),U=o.bookingStartDate&&o.bookingStartDate.date?o.bookingStartDate.date:null,w=o.bookingStartTime?o.bookingStartTime:null,P=o.bookingEndDate&&o.bookingEndDate.date?o.bookingEndDate.date:null,O=A(D,this.state.currentMonth,f),$=N(O,U,f),x=M(F,f,U,$),j=x.length>0&&x[0]&&x[0].timestamp?x[0].timestamp:null,{startTime:J,endDate:W,selectedTimeSlot:X}=I(F,f,$,U,w||j,P||U),q=C(F,f,w||J,P||W,X),H=O?t=>!O.find((e=>(0,r.JV)(t,e.attributes.start,e.attributes.end,f))):()=>!1,V=(0,r.Kn)(v,"hour",f);let K="08:00";try{var L;K=null===(L=(0,r.DX)(V,F,{timeZone:f}))||void 0===L?void 0:L.time}catch(z){}const Q=(0,r.RY)(v,"day",f),G=U&&(w||J);return i().createElement("div",{className:Z},i().createElement("div",{className:c},i().createElement("div",{className:s()(u,k)},i().createElement(d.vl,{className:h,name:"bookingStartDate",id:n?"".concat(n,".bookingStartDate"):"bookingStartDate",label:a.label,placeholderText:a.placeholderText,format:t=>t&&t.date?{date:(0,r.dw)(t.date,f)}:t,parse:t=>t&&t.date?{date:(0,r.vc)(t.date,f)}:t,initialVisibleMonth:(0,r.$T)(U||Q,f),isDayBlocked:H,onChange:this.onBookingStartDateChange,onPrevMonthClick:()=>this.onMonthClick(_),onNextMonthClick:()=>this.onMonthClick(S),navNext:i().createElement(Y,{currentMonth:this.state.currentMonth,timeZone:f,dayCountAvailableForBooking:R}),navPrev:i().createElement(B,{currentMonth:this.state.currentMonth,timeZone:f}),useMobileMargins:!0,validate:(0,l.BA)(F.formatMessage({id:"BookingTimeForm.requiredDate"})),onClose:t=>{var e;return this.setState({currentMonth:(0,r.RY)(null!==(e=null===t||void 0===t?void 0:t.date)&&void 0!==e?e:v,"month",this.props.timeZone)})}}))),i().createElement("div",{className:c},i().createElement("div",{className:u},i().createElement(d.Wy,{name:"bookingStartTime",id:n?"".concat(n,".bookingStartTime"):"bookingStartTime",className:U?g:b,selectClassName:U?p:T,label:F.formatMessage({id:"FieldDateAndTimeInput.startTime"}),disabled:!U,onChange:this.onBookingStartTimeChange},U?x.map((t=>i().createElement("option",{key:t.timeOfDay,value:t.timestamp},t.timeOfDay))):i().createElement("option",null,K))),i().createElement("div",{className:U?y:E},"-"),i().createElement("div",{className:u},i().createElement(d.Wy,{name:"bookingEndTime",id:n?"".concat(n,".bookingEndTime"):"bookingEndTime",className:U?g:b,selectClassName:U?p:T,label:F.formatMessage({id:"FieldDateAndTimeInput.endTime"}),disabled:!G},G?q.map((t=>i().createElement("option",{key:"00:00"===t.timeOfDay?"24:00":t.timeOfDay,value:t.timestamp},"00:00"===t.timeOfDay?"24:00":t.timeOfDay))):i().createElement("option",null,K)))))}}Z.defaultProps={rootClassName:null,className:null,startDateInputProps:null,endDateInputProps:null,startTimeInputProps:null,endTimeInputProps:null,listingId:null,monthlyTimeSlots:null,timeZone:null};const U=Z},8975:(t,e,n)=>{n.d(e,{Z:()=>D});var a=n(6689),i=n.n(a),o=n(9200),s=n.n(o),r=n(6319),l=n(1233),d=n(3665),m=n(5198),c=n(7285),u=n(9930),h=n(949);const{Money:g,UUID:b}=r.types,p=(t,e)=>{const n=t.reduce(((t,e)=>{const n=(0,m.ud)(e.lineTotal);return new(s())(n).add(t)}),new(s())(0)),a=t[0]&&t[0].unitPrice?t[0].unitPrice.currency:e;return new g((0,m.aV)(n.toNumber(),(0,m.p_)(a)),a)},T=function(t,e,n){const a={start:t,end:e};return{id:new b("estimated-booking"),type:"booking",attributes:{...a}}},D=t=>{const{breakdownData:e={},lineItems:n,timeZone:a,currency:o,marketplaceName:s,processName:r}=t,{startDate:m,endDate:g}=e;let D=null;try{D=(0,c.Yt)(r)}catch(M){return i().createElement("div",{className:h.Z.error},i().createElement(l._H,{id:"OrderPanel.unknownTransactionProcess"}))}const k=null===n||void 0===n?void 0:n.find((t=>d.Y8.includes(t.code)&&!t.reversal)),y=null===k||void 0===k?void 0:k.code,E=[d.E4,d.mi].includes(y),v=n&&n.length>0,S=!E||m&&g,_=y===d.PC?d.In:d.FJ,f=v&&S?((t,e,n,a,i,o,s,r)=>{const l=null===o||void 0===o?void 0:o.transitions,d=new Date,m=t.filter((t=>t.includeFor.includes("customer"))),u=t.filter((t=>t.includeFor.includes("provider"))),h=p(m,r),g=p(u,r),D=e&&n?{booking:T(e,n,a,i)}:{};return{id:new b("estimated-transaction"),type:"transaction",attributes:{createdAt:d,processName:s,lastTransitionedAt:d,lastTransition:l.REQUEST_PAYMENT,payinTotal:h,payoutTotal:g,lineItems:m,transitions:[{createdAt:d,by:c.AL,transition:l.REQUEST_PAYMENT}]},...D}})(n,m,g,y,a,D,r,o):null;return f?i().createElement(u.J0,{className:h.Z.receipt,userRole:"customer",transaction:f,booking:f.booking,dateType:_,timeZone:a,currency:o,marketplaceName:s}):null}}};
//# sourceMappingURL=661.66b62f7d.chunk.js.map