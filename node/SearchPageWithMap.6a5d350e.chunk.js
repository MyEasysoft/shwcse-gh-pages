"use strict";exports.id=412,exports.ids=[412],exports.modules={8422:(e,t,n)=>{n.r(t),n.d(t,{SearchPageComponent:()=>xt,default:()=>Bt});var a={};n.r(a),n.d(a,{INFO_CARD_HANDLE:()=>ye,LABEL_HANDLE:()=>Se,SOURCE_AUTOCOMPLETE:()=>_e,default:()=>Te,fitMapToBounds:()=>Ee,getMapBounds:()=>Ae,getMapCenter:()=>Fe,isMapsLibLoaded:()=>Re,mapboxBoundsToSDKBounds:()=>Ne,mapboxLngLatToSDKLatLng:()=>ke});var s={};n.r(s),n.d(s,{INFO_CARD_HANDLE:()=>ze,LABEL_HANDLE:()=>Ue,default:()=>ot,fitMapToBounds:()=>Ge,getMapBounds:()=>qe,getMapCenter:()=>Ye,googleBoundsToSDKBounds:()=>Xe,googleLatLngToSDKLatLng:()=>je,isMapsLibLoaded:()=>Je});var i=n(6689),o=n.n(i),r=n(6022),l=n(6695),c=n(4661),d=n(3908),p=n.n(d),h=n(3901),m=n.n(h),u=n(9003),g=n.n(u),C=n(1233),f=n(6639),M=n(6134),b=n(1422),v=n(1956),L=n(5161),S=(n(3665),n(5863)),y=n(6902),_=n(9930),w=n(2745),P=n(3012),E=n(7419),k=n(9733),N=n(2536),I=n(8492),A=n.n(I),F=n(9822),R=n.n(F);const O=(e,t)=>[...document.querySelectorAll(".".concat(t))].some((t=>t!==e&&t.contains(e))),T=e=>A()(e,(e=>{const t=e.attributes.geolocation;return"".concat(t.lat,"-").concat(t.lng)})),x=e=>R()(e,((e,t)=>e.concat([t])),[]);var B=n(6405),H=n.n(B),D=n(454),Z=n.n(D),W=n(113),U=n.n(W),z=n(6319),Q=n(4941),V=n(5198);const K="SearchMapPriceLabel_root__N6UDB",G="SearchMapPriceLabel_priceLabel__P0HdP h5",j="SearchMapPriceLabel_caret__GJlFH",X="SearchMapPriceLabel_noPriceSetLabel__+zQzB",q="SearchMapPriceLabel_mapLabelActive__CRu+Q",Y="SearchMapPriceLabel_caretShadow__ibR+i",J="SearchMapPriceLabel_caretActive__hmPUi";class $ extends i.Component{shouldComponentUpdate(e){const t=(0,Q.Me)(this.props.listing),n=(0,Q.Me)(e.listing),a=t.id.uuid===n.id.uuid,s=t.attributes.price===n.attributes.price,i=this.props.isActive===e.isActive,o=this.props.mapComponentRefreshToken===e.mapComponentRefreshToken;return!(a&&s&&i&&o)}render(){const{className:e,rootClassName:t,intl:n,listing:a,onListingClicked:s,isActive:i,config:r}=this.props,l=(0,Q.Me)(a),{price:c}=l.attributes,d=c&&c.currency===r.currency?(0,V.lb)(n,c):null!==c&&void 0!==c&&c.currency?c.currency:null,p=g()(t||K,e),h=g()(G,{[q]:i,[X]:!d}),m=g()(j,{[J]:i});return o().createElement("button",{className:p,onClick:()=>s(l)},o().createElement("div",{className:Y}),o().createElement("div",{className:h},d),o().createElement("div",{className:m}))}}$.defaultProps={className:null,rootClassName:null};const ee=(0,C.XN)($),te={root:"SearchMapInfoCard_root__HissA",anchor:"SearchMapInfoCard_anchor__DgYV9",card:"SearchMapInfoCard_card__QMLp3 h5",aspectratioWrapper:"SearchMapInfoCard_aspectratioWrapper__cXHHj",rootForImage:"SearchMapInfoCard_rootForImage__NhEmK",info:"SearchMapInfoCard_info__4qKxt",price:"SearchMapInfoCard_price__Xu5l6",name:"SearchMapInfoCard_name__QWwZw",paginationInfo:"SearchMapInfoCard_paginationInfo__CAzYs",paginationPage:"SearchMapInfoCard_paginationPage__Sn-gk textSmall",paginationPrev:"SearchMapInfoCard_paginationPrev__Ox7Io",paginationNext:"SearchMapInfoCard_paginationNext__AJoz9",caretShadow:"SearchMapInfoCard_caretShadow__4NsLR",caret:"SearchMapInfoCard_caret__SMMfK",caretWithCarousel:"SearchMapInfoCard_caretWithCarousel__-6DSW",borderRadiusInheritTop:"SearchMapInfoCard_borderRadiusInheritTop__oWoc-",borderRadiusInheritBottom:"SearchMapInfoCard_borderRadiusInheritBottom__j4GYv"},ne=e=>{var t;const{className:n,clickHandler:a,intl:s,isInCarousel:i,listing:r,urlToListing:l,config:c}=e,{title:d,price:p}=r.attributes,h=p&&p.currency===c.currency?(0,V.lb)(s,p):null!==p&&void 0!==p&&p.currency?p.currency:null,m=r.images&&r.images.length>0?r.images[0]:null,{aspectWidth:u=1,aspectHeight:C=1,variantPrefix:f="listing-card"}=c.layout.listingImage,M=m?Object.keys(null===m||void 0===m||null===(t=m.attributes)||void 0===t?void 0:t.variants).filter((e=>e.startsWith(f))):[],b=g()(te.anchor,te.borderRadiusInheritTop,{[te.borderRadiusInheritBottom]:!i},n);return o().createElement("a",{alt:d,className:b,href:l,onClick:e=>{e.preventDefault(),a(r)}},o().createElement("div",{className:g()(te.card,te.borderRadiusInheritTop,{[te.borderRadiusInheritBottom]:!i})},o().createElement(_.Zz,{className:te.aspectRatioWrapper,width:u,height:C},o().createElement(_.t3,{rootClassName:g()(te.rootForImage,te.borderRadiusInheritTop),alt:d,noImageMessage:s.formatMessage({id:"SearchMapInfoCard.noImage"}),image:m,variants:M,sizes:"250px"})),o().createElement("div",{className:g()(te.info,{[te.borderRadiusInheritBottom]:!i})},o().createElement("div",{className:g()(te.price,{[te.noPriceSetLabel]:!h})},h),o().createElement("div",{className:te.name},d))))};ne.defaultProps={className:null};const ae=e=>{const[t,n]=(0,i.useState)(0),{className:a,rootClassName:s,intl:r,listings:l,createURLToListing:c,onListingInfoCardClicked:d,config:p}=e,h=(0,Q.Me)(l[t]),m=l.length>1,u=g()(s||te.root,a),C=g()(te.caret,{[te.caretWithCarousel]:m});return o().createElement("div",{className:u},o().createElement("div",{className:te.caretShadow}),o().createElement(ne,{clickHandler:d,urlToListing:c(h),listing:h,intl:r,isInCarousel:m,config:p}),m?o().createElement("div",{className:g()(te.paginationInfo,te.borderRadiusInheritBottom)},o().createElement("button",{className:te.paginationPrev,onClick:e=>{e.preventDefault(),e.stopPropagation(),n((e=>(e+l.length-1)%l.length))}}),o().createElement("div",{className:te.paginationPage},"".concat(t+1,"/").concat(l.length)),o().createElement("button",{className:te.paginationNext,onClick:e=>{e.preventDefault(),e.stopPropagation(),n((e=>(e+l.length+1)%l.length))}})):null,o().createElement("div",{className:C}))};ae.defaultProps={className:null,rootClassName:null};const se=(0,l.compose)(C.XN)(ae);var ie=n(580),oe=n.n(ie);const re="SearchMapGroupLabel_root__PVedw",le="SearchMapGroupLabel_details__0Sei6 p",ce="SearchMapGroupLabel_caret__piFaj",de="SearchMapGroupLabel_detailsActive__wXeih",pe="SearchMapGroupLabel_caretShadow__oYFSs",he="SearchMapGroupLabel_caretActive__s5fmy";class me extends i.Component{shouldComponentUpdate(e){const t=e.listings.length===this.props.listings.length,n=this.props.isActive===e.isActive,a=this.props.mapComponentRefreshToken===e.mapComponentRefreshToken;return!(t&&n&&a)}render(){const{className:e,rootClassName:t,listings:n,onListingClicked:a,isActive:s}=this.props,i=g()(t||re,e),r=g()(le,{[de]:s}),l=g()(ce,{[he]:s});return o().createElement("button",{className:i,onClick:()=>a(n)},o().createElement("div",{className:pe}),o().createElement("div",{className:r},n.length),o().createElement("div",{className:l}))}}me.defaultProps={className:null,rootClassName:null};const{arrayOf:ue,func:ge,string:Ce}=oe(),fe=me,Me="SearchMapWithMapbox_fullArea__7PtpL",be="SearchMapWithMapbox_activeLabel__RIrWc",ve="SearchMapWithMapbox_labelContainer__9cc+3",Le="SearchMapWithMapbox_infoCardContainer__Z-7qO",Se="SearchMapLabel",ye="SearchMapInfoCard",_e="autocomplete",{LatLng:we,LatLngBounds:Pe}=z.types,Ee=(e,t,n)=>{const{padding:a=0,isAutocompleteSearch:s=!1}=n,i=Ie(t),o=null==a?{padding:a}:{},r=s?{searchSource:_e}:{};e&&i&&e.fitBounds(i,{...o,linear:!0,duration:0},r)},ke=e=>{const t=e.lng,n=t>180?t-360:t<-180?t+360:t;return new we(e.lat,n)},Ne=e=>{if(!e)return null;const t=e.getNorthEast(),n=e.getSouthWest();return new Pe(ke(t),ke(n))},Ie=e=>{if(!e)return null;const{ne:t,sw:n}=e;return[[n.lng>t.lng?-360+n.lng:n.lng,n.lat],[t.lng,t.lat]]},Ae=e=>Ne(e.getBounds()),Fe=e=>ke(e.getCenter()),Re=()=>"undefined"!==typeof window&&window.mapboxgl&&window.mapboxgl;class Oe extends i.Component{constructor(e){super(e),this.map="undefined"!==typeof window&&window.mapboxMap?window.mapboxMap:null,this.currentMarkers=[],this.currentInfoCard=null,this.state={mapContainer:null,isMapReady:!1},this.viewportBounds=null,this.onMount=this.onMount.bind(this),this.onMoveend=this.onMoveend.bind(this),this.initializeMap=this.initializeMap.bind(this),this.handleDoubleClickOnInfoCard=this.handleDoubleClickOnInfoCard.bind(this),this.handleMobilePinchZoom=this.handleMobilePinchZoom.bind(this)}componentDidUpdate(e){if(!U()(e.location,this.props.location)){const{mapSearch:e}=(0,L.Qc)(this.props.location.search,{latlng:["origin"],latlngBounds:["bounds"]});e||(this.viewportBounds=null)}if(this.map){const e=Ae(this.map);U()(this.props.bounds,e)||this.viewportBounds||Ee(this.map,this.props.bounds,{padding:0,isAutocompleteSearch:!0})}!this.map&&this.state.mapContainer?(this.initializeMap(),this.props.onMapLoad(this.map)):e.mapComponentRefreshToken!==this.props.mapComponentRefreshToken&&this.props.onMapLoad(this.map)}componentWillUnmount(){this.currentInfoCard.markerContainer.removeEventListener("dblclick",this.handleDoubleClickOnInfoCard),document.removeEventListener("gesturestart",this.handleMobilePinchZoom,!1),document.removeEventListener("gesturechange",this.handleMobilePinchZoom,!1),document.removeEventListener("gestureend",this.handleMobilePinchZoom,!1)}onMount(e){document.addEventListener("gesturestart",this.handleMobilePinchZoom,!1),document.addEventListener("gesturechange",this.handleMobilePinchZoom,!1),document.addEventListener("gestureend",this.handleMobilePinchZoom,!1),this.setState({mapContainer:e})}onMoveend(e){if(this.map){if(!(this.props.reusableMapHiddenHandle&&this.state.mapContainer.parentElement.classList.contains(this.props.reusableMapHiddenHandle))){const e=Ae(this.map),t=Fe(this.map),n=(0,N.bA)(e,8),a=this.viewportBounds&&!(0,N.EQ)(this.viewportBounds,n);this.props.onMapMoveEnd(a,{viewportBounds:n,viewportMapCenter:t}),this.viewportBounds=n}}}initializeMap(){const{offsetHeight:e,offsetWidth:t}=this.state.mapContainer;if(e>0&&t>0){this.map=new window.mapboxgl.Map({container:this.state.mapContainer,style:"mapbox://styles/mapbox/streets-v10",scrollZoom:!1}),window.mapboxMap=this.map;var n=new window.mapboxgl.NavigationControl({showCompass:!1});this.map.addControl(n,"top-left"),this.map.on("moveend",this.onMoveend),this.setState({isMapReady:!0})}}handleMobilePinchZoom(e){e.preventDefault(),document.body.style.zoom=.99}handleDoubleClickOnInfoCard(e){e.stopPropagation()}render(){const{id:e,className:t,listings:n,activeListingId:a,infoCardOpen:s,onListingClicked:i,onListingInfoCardClicked:r,createURLToListing:l,mapComponentRefreshToken:c,config:d}=this.props;if(this.map){const e=((e,t,n,a,s)=>x(T(e)).reverse().map((e=>{const i=!!t&&!!e.find((e=>t.uuid===e.id.uuid));if(1===e.length){const t=e[0],o=Array.isArray(n)?n.map((e=>e.id.uuid)):n?[n.id.uuid]:[];if(null!=n&&o.includes(t.id.uuid))return null;const{geolocation:r}=t.attributes,l=t.id.uuid;return{markerId:"price_".concat(l),location:r,type:"price",componentProps:{key:l,isActive:i,className:Se,listing:t,onListingClicked:a,mapComponentRefreshToken:s}}}const o=(0,Q.Me)(e[0]).attributes.geolocation,r=e[0].id.uuid;return{markerId:"group_".concat(r),location:o,type:"group",componentProps:{key:r,isActive:i,className:Se,listings:e,onListingClicked:a,mapComponentRefreshToken:s}}})))(n,a,s,i,c);Z()(this.currentMarkers,e,"markerId").forEach((e=>e.marker.remove()));const t=(e,t)=>new window.mapboxgl.Marker(t,{anchor:"bottom"}).setLngLat([e.location.lng,e.location.lat]).addTo(this.map);if(this.currentMarkers=e.filter((e=>null!=e)).map((e=>{const n=this.currentMarkers.findIndex((t=>e.markerId===t.markerId&&t.marker));if(n>=0){const{marker:t,markerContainer:a,...s}=this.currentMarkers[n];return{...s,...e,markerContainer:a,marker:t}}{const n=document.createElement("div");n.setAttribute("id",e.markerId),n.classList.add(ve);const a=t(e,n);return{...e,markerContainer:n,marker:a}}})),s){const e=((e,t,n,a)=>{const s=Array.isArray(e)?e:[e];if(!e)return null;const i=(0,Q.Me)(s[0]),o=i.id.uuid,r=i.attributes.geolocation;return{markerId:"infoCard_".concat(o),location:r,componentProps:{key:o,mapComponentRefreshToken:a,className:ye,listings:s,onListingInfoCardClicked:t,createURLToListing:n}}})(s,r,l,c),n=document.createElement("div");n.setAttribute("id",e.markerId),n.classList.add(Le),n.addEventListener("dblclick",this.handleDoubleClickOnInfoCard,!1),this.currentInfoCard={...e,markerContainer:n,marker:e?t(e,n):null}}else this.currentInfoCard&&this.currentInfoCard.markerContainer.removeEventListener("dblclick",this.handleDoubleClickOnInfoCard),this.currentInfoCard=null}return o().createElement("div",{id:e,ref:this.onMount,className:g()(t,Me),onClick:this.props.onClick},this.currentMarkers.map((e=>{e.markerContainer.classList.remove(be),a&&a.uuid===e.componentProps.key&&e.markerContainer.classList.add(be);const t=this.map&&e.markerContainer,n=t?document.getElementById(e.markerContainer.id):null;return t&&"price"===e.type?H().createPortal(o().createElement(ee,Object.assign({},e.componentProps,{config:d})),n):t&&"group"===e.type?H().createPortal(o().createElement(fe,e.componentProps),n):null})),this.state.mapContainer&&this.currentInfoCard?H().createPortal(o().createElement(se,Object.assign({},this.currentInfoCard.componentProps,{config:d})),this.currentInfoCard.markerContainer):null)}}Oe.defaultProps={id:"map",center:null,priceLabels:[],infoCard:null,zoom:11,reusableMapHiddenHandle:null};const Te=Oe;var xe=n(7644),Be=n.n(xe),He=n(193);const De="SearchMapWithGoogleMaps_fullArea__91wrm",Ze="SearchMapWithGoogleMaps_activeLabel__MLyXH",We="SearchMapWithGoogleMaps_labelContainer__3HnFL",Ue="SearchMapLabel",ze="SearchMapInfoCard",Qe="overlayMouseTarget",{LatLng:Ve,LatLngBounds:Ke}=z.types,Ge=(e,t,n)=>{const{padding:a}=n,{ne:s,sw:i}=t||{},o=t?{north:s.lat,east:s.lng,south:i.lat,west:i.lng}:null;e&&o&&(null==a?e.fitBounds(o):e.fitBounds(o,a))},je=e=>e?new Ve(e.lat(),e.lng()):null,Xe=e=>{if(!e)return null;const t=e.getNorthEast(),n=e.getSouthWest();return new Ke(new Ve(t.lat(),t.lng()),new Ve(n.lat(),n.lng()))},qe=e=>Xe(e.getBounds()),Ye=e=>je(e.getCenter()),Je=()=>"undefined"!==typeof window&&window.google&&window.google.maps;class $e extends i.Component{constructor(e,t){super(e,t);const n=new window.google.maps.OverlayView;n.onAdd=this.onAdd.bind(this),n.draw=this.draw.bind(this),n.onRemove=this.onRemove.bind(this),this.onPositionElement=this.onPositionElement.bind(this),n.setMap(e.map),this.state={overlayView:n}}onRemove(){this.containerElement.parentNode.removeChild(this.containerElement),o().version.match(/^16/)||H().unmountComponentAtNode(this.containerElement),this.containerElement=null}onAdd(){this.containerElement=document.createElement("div"),this.containerElement.style.position="absolute";const{mapPaneName:e}=this.props;Be()(!!e,"OverlayView requires either props.mapPaneName or props.defaultMapPaneName but got %s",e);this.state.overlayView.getPanes()[e].appendChild(this.containerElement),this.onPositionElement(),this.forceUpdate()}onPositionElement(){const e=this.state.overlayView.getProjection(),t={x:0,y:0,...(0,He.Js)(this.containerElement,this.props)},n=(0,He.Kl)(e,t,this.props);Object.assign(this.containerElement.style,n)}draw(){this.state.overlayView.getPanes()&&this.containerElement&&this.onPositionElement()}render(){return!(!o().version.match(/^16/)||!this.containerElement)&&H().createPortal(o().Children.only(this.props.children),this.containerElement)}}const et=(e,t)=>({x:e/2*-1,y:-1*(t+3)});class tt extends i.Component{shouldComponentUpdate(e){const t=(0,Q.Me)(this.props.listing),n=(0,Q.Me)(e.listing),a=t.id.uuid===n.id.uuid,s=t.attributes.price===n.attributes.price,i=this.props.isActive===e.isActive,o=this.props.mapComponentRefreshToken===e.mapComponentRefreshToken;return!(a&&s&&i&&o)}render(){const{position:e,map:t,mapPaneName:n,isActive:a,className:s,listing:i,onListingClicked:r,mapComponentRefreshToken:l,config:c}=this.props;return o().createElement($e,{position:e,map:t,mapPaneName:n,getPixelPositionOffset:et},o().createElement(ee,{isActive:a,className:s,listing:i,onListingClicked:r,mapComponentRefreshToken:l,config:c}))}}class nt extends i.Component{shouldComponentUpdate(e){const t=e.listings.length===this.props.listings.length,n=this.props.isActive===e.isActive,a=this.props.mapComponentRefreshToken===e.mapComponentRefreshToken;return!(t&&n&&a)}render(){const{position:e,map:t,mapPaneName:n,isActive:a,className:s,listings:i,onListingClicked:r,mapComponentRefreshToken:l}=this.props;return o().createElement($e,{position:e,map:t,mapPaneName:n,getPixelPositionOffset:et},o().createElement(fe,{isActive:a,className:s,listings:i,onListingClicked:r,mapComponentRefreshToken:l}))}}const at=e=>{const{map:t,listings:n,activeListingId:a,infoCardOpen:s,onListingClicked:i,mapComponentRefreshToken:r,config:l}=e;return x(T(n)).reverse().map((e=>{const n=!!a&&!!e.find((e=>a.uuid===e.id.uuid)),c=g()(We,Ue,{[Ze]:n});if(1===e.length){const a=e[0],d=Array.isArray(s)?s.map((e=>e.id.uuid)):[];if(null!=s&&d.includes(a.id.uuid))return null;const{geolocation:p}=a.attributes,h={lat:p.lat,lng:p.lng};return o().createElement(tt,{key:a.id.uuid,position:h,map:t,mapPaneName:Qe,isActive:n,className:c,listing:a,onListingClicked:i,mapComponentRefreshToken:r,config:l})}const d=(0,Q.Me)(e[0]).attributes.geolocation,p={lat:d.lat,lng:d.lng};return o().createElement(nt,{key:e[0].id.uuid,position:p,map:t,mapPaneName:Qe,isActive:n,className:c,listings:e,onListingClicked:i,mapComponentRefreshToken:r})}))},st=e=>{const{map:t,infoCardOpen:n,onListingInfoCardClicked:a,createURLToListing:s,mapComponentRefreshToken:i,config:r}=e,l=Array.isArray(n)?n:[n];if(!n)return null;const c=(0,Q.Me)(l[0]).attributes.geolocation,d={lat:c.lat,lng:c.lng};return o().createElement($e,{key:l[0].id.uuid,position:d,map:t,mapPaneName:"floatPane",getPixelPositionOffset:et,styles:{zIndex:1}},o().createElement(se,{mapComponentRefreshToken:i,className:ze,listings:l,onListingInfoCardClicked:a,createURLToListing:s,config:r}))};class it extends i.Component{constructor(e){super(e),this.map=null,this.viewportBounds=null,this.idleListener=null,this.state={mapContainer:null,isMapReady:!1},this.initializeMap=this.initializeMap.bind(this),this.onMount=this.onMount.bind(this),this.onIdle=this.onIdle.bind(this)}componentDidUpdate(e){if(!U()(e.location,this.props.location)){const{mapSearch:e}=(0,L.Qc)(this.props.location.search,{latlng:["origin"],latlngBounds:["bounds"]});e||(this.viewportBounds=null)}if(this.map){const t=qe(this.map);U()(this.props.bounds,t)||this.viewportBounds||Ge(this.map,this.props.bounds,{padding:0}),e.infoCardOpen!==this.props.infoCardOpen&&this.map.setOptions({disableDoubleClickZoom:!!this.props.infoCardOpen})}!this.map&&this.state.mapContainer?(this.initializeMap(),this.props.onMapLoad(this.map)):e.mapComponentRefreshToken!==this.props.mapComponentRefreshToken&&this.props.onMapLoad(this.map)}componentWillUnmount(){this.idleListener.remove()}initializeMap(){const{offsetHeight:e,offsetWidth:t}=this.state.mapContainer;if(e>0&&t>0){const{bounds:e,center:t,zoom:n}=this.props,a=window.google.maps,s={zoom:1,center:{lat:0,lng:0}},i={mapTypeControl:!1,scrollwheel:!1,fullscreenControl:!1,clickableIcons:!1,streetViewControl:!1,zoomControlOptions:{position:a.ControlPosition.LEFT_TOP},...e||t?{zoom:n,center:t}:s};this.map=new a.Map(this.state.mapContainer,i),this.idleListener=a.event.addListener(this.map,"idle",this.onIdle),this.setState({isMapReady:!0})}}onMount(e){this.setState({mapContainer:e})}onIdle(e){if(this.map){if(!(this.props.reusableMapHiddenHandle&&this.state.mapContainer.parentElement.classList.contains(this.props.reusableMapHiddenHandle))){const e=qe(this.map),t=Ye(this.map),n=e?(0,N.bA)(e,8):null,a=this.viewportBounds&&n&&!(0,N.EQ)(this.viewportBounds,n);this.props.onMapMoveEnd(a,{viewportBounds:n,viewportMapCenter:t}),this.viewportBounds=n}}}render(){const{id:e,className:t,listings:n,activeListingId:a,infoCardOpen:s,onListingClicked:i,mapComponentRefreshToken:r,onListingInfoCardClicked:l,createURLToListing:c,config:d}=this.props;return o().createElement("div",{id:e,ref:this.onMount,className:g()(t,De),onClick:this.props.onClick},this.map?o().createElement(at,{map:this.map,listings:n,activeListingId:a,infoCardOpen:s,onListingClicked:i,mapComponentRefreshToken:r,config:d}):null,this.map?o().createElement(st,{map:this.map,infoCardOpen:s,onListingInfoCardClicked:l,createURLToListing:c,mapComponentRefreshToken:r,config:d}):null)}}it.defaultProps={id:"map",center:new z.types.LatLng(0,0),infoCardOpen:null,listings:[],activeListingId:null,zoom:11,reusableMapHiddenHandle:null};const ot=it,rt="SearchMap_root__lk+X9",lt="SearchMap_reusableMap__NRcS4",ct="SearchMap_defaultMapLayout__IDCze",dt="SearchMap_reusableMapHidden__7id1c";class pt extends o().Component{constructor(e){if(super(e),"undefined"!==typeof window){window.reusableSearchMapElement=window.reusableSearchMapElement||document.createElement("div"),e.className||console.warn("ReusableMapContainer should get className prop which defines its layout");const t=e.className||ct;this.el=window.reusableSearchMapElement,this.el.id="search-map",this.el.classList.add(t)}this.mountNode=null,this.renderSearchMap=this.renderSearchMap.bind(this)}componentDidMount(){this.renderSearchMap()}componentDidUpdate(){this.renderSearchMap()}componentWillUnmount(){this.el.classList.add(dt),this.el.classList.add(this.props.reusableMapHiddenHandle),this.mountNode.removeChild(this.el),document.body.appendChild(this.el)}renderSearchMap(){const e=()=>{const{config:e,messages:t}=this.props,n=o().createElement(C.Pj,{locale:e.localization.locale,messages:t,textComponent:"span"},this.props.children);H().render(n,this.el)};document.getElementById(this.el.id)?(this.el.classList.remove(dt),this.el.classList.remove(this.props.reusableMapHiddenHandle),this.mountNode&&!this.mountNode.firstChild?(document.body.removeChild(this.el),this.mountNode.appendChild(this.el),e(),this.props.onReattach()):e()):(this.mountNode&&!this.mountNode.firstChild?this.mountNode.appendChild(this.el):this.mountNode||document.body.appendChild(this.el),e())}render(){return o().createElement("div",{className:lt,ref:e=>{this.mountNode=e}})}}pt.defaultProps={className:ie.string};const ht=pt,mt="reusableMapHidden",ut=e=>"googleMaps"===e?s:a;class gt extends i.Component{constructor(e){super(e),this.listings=[],this.mapRef=null;let t=0;"undefined"!==typeof window&&(window.mapReattachmentCount?t=window.mapReattachmentCount:window.mapReattachmentCount=0),this.state={infoCardOpen:null,mapReattachmentCount:t},this.createURLToListing=this.createURLToListing.bind(this),this.onListingInfoCardClicked=this.onListingInfoCardClicked.bind(this),this.onListingClicked=this.onListingClicked.bind(this),this.onMapClicked=this.onMapClicked.bind(this),this.onMapLoadHandler=this.onMapLoadHandler.bind(this)}componentWillUnmount(){this.listings=[]}createURLToListing(e){const t=this.props.routeConfiguration,n={id:e.id.uuid,slug:(0,L.qi)(e.attributes.title)};return(0,b.EW)("ListingPage",t,n,{})}onListingClicked(e){this.setState({infoCardOpen:e})}onListingInfoCardClicked(e){this.props.onCloseAsModal&&this.props.onCloseAsModal();this.props.history.push(this.createURLToListing(e))}onMapClicked(e){const t=(e=>{const t=ut(e);return{labelHandle:t.LABEL_HANDLE,infoCardHandle:t.INFO_CARD_HANDLE}})(this.props.config.maps.mapProvider),n=O(e.nativeEvent.target,t.labelHandle),a=O(e.nativeEvent.target,t.infoCardHandle);null==this.state.infoCardOpen||n||a||this.setState({infoCardOpen:null})}onMapLoadHandler(e){if(this.mapRef=e,this.mapRef&&0===this.state.mapReattachmentCount){(t=this.props.config.maps.mapProvider,ut(t).fitMapToBounds)(this.mapRef,this.props.bounds,{padding:0,isAutocompleteSearch:!0})}var t}render(){const{id:e,className:t,rootClassName:n,reusableContainerClassName:a,bounds:s,center:i,location:r,listings:l,onMapMoveEnd:c,zoom:d,config:p,activeListingId:h,messages:m}=this.props,u=g()(n||rt,t),C=l.filter((e=>!!e.attributes.geolocation)),f=p.maps.fuzzy.enabled?((e,t)=>e.map((e=>{const{id:n,attributes:a,...s}=e,i=a.geolocation,o=n?"".concat(n.uuid,"_").concat(i.lat,"_").concat(i.lng):null,r=(0,N.rs)(i,t,o);return{id:n,...s,attributes:{...a,geolocation:r}}})))(C,p.maps.fuzzy.offset):C,M=this.state.infoCardOpen,b=p.maps.mapProvider,v=!!(0,N.yx)(p.maps),L=(e=>ut(e).default)(b);return v&&ut(b).isMapsLibLoaded()?o().createElement(ht,{className:a,reusableMapHiddenHandle:mt,onReattach:()=>{window.mapReattachmentCount+=1,this.setState({mapReattachmentCount:window.mapReattachmentCount})},messages:m,config:p},o().createElement(L,{id:e,className:u,bounds:s,center:i,location:r,infoCardOpen:M,listings:f,activeListingId:h,mapComponentRefreshToken:this.state.mapReattachmentCount,createURLToListing:this.createURLToListing,onClick:this.onMapClicked,onListingClicked:this.onListingClicked,onListingInfoCardClicked:this.onListingInfoCardClicked,onMapLoad:this.onMapLoadHandler,onMapMoveEnd:c,reusableMapHiddenHandle:mt,zoom:d,config:p})):o().createElement("div",{className:g()(u,a||ct)})}}gt.defaultProps={id:"searchMap",className:null,rootClassName:null,mapRootClassName:null,reusableContainerClassName:null,bounds:null,center:null,activeListingId:null,listings:[],onCloseAsModal:null,zoom:11};const Ct=e=>{const t=(0,f.mX)(),n=(0,M.a5)(),a=(0,c.useHistory)();return o().createElement(gt,Object.assign({config:t,routeConfiguration:n,history:a},e))};var ft=n(5678);const Mt="SearchFiltersSecondary_root__+ytb4",bt="SearchFiltersSecondary_filtersWrapper__IuzeY",vt="SearchFiltersSecondary_footer__mbSDF",Lt="SearchFiltersSecondary_resetAllButton__R7ysV SearchFiltersSecondary_filterButton__+PT+V",St="SearchFiltersSecondary_cancelButton__ZecGG SearchFiltersSecondary_filterButton__+PT+V",yt="SearchFiltersSecondary_applyButton__lD1Fq SearchFiltersSecondary_filterButton__+PT+V";class _t extends i.Component{constructor(e){super(e),this.state={currentQueryParams:e.urlQueryParams},this.applyFilters=this.applyFilters.bind(this),this.cancelFilters=this.cancelFilters.bind(this),this.resetAll=this.resetAll.bind(this)}applyFilters(){const{applyFilters:e,onClosePanel:t}=this.props;e&&e(),t()}cancelFilters(){const{cancelFilters:e}=this.props;e&&e(),this.props.onClosePanel()}resetAll(e){const{resetAll:t,onClosePanel:n}=this.props;t&&t(e),n(),e&&e.currentTarget&&e.currentTarget.blur()}render(){const{rootClassName:e,className:t,children:n}=this.props,a=g()(e||Mt,t);return o().createElement("div",{className:a},o().createElement("div",{className:bt},n),o().createElement("div",{className:vt},o().createElement(_.T5,{rootClassName:Lt,onClick:this.resetAll},o().createElement(C._H,{id:"SearchFiltersSecondary.resetAll"})),o().createElement(_.T5,{rootClassName:St,onClick:this.cancelFilters},o().createElement(C._H,{id:"SearchFiltersSecondary.cancel"})),o().createElement(_.T5,{rootClassName:yt,onClick:this.applyFilters},o().createElement(C._H,{id:"SearchFiltersSecondary.apply"}))))}}_t.defaultProps={rootClassName:null,className:null};const wt=_t;var Pt=n(149);const Et="SearchFiltersPrimary_root__2+lFJ",kt="SearchFiltersPrimary_filters__9YqDX",Nt=e=>{const{rootClassName:t,className:n,children:a,isSecondaryFiltersOpen:s,toggleSecondaryFiltersOpen:i,selectedSecondaryFiltersCount:r}=e,l=g()(t||Et,n),c=i?o().createElement(Pt.Z,{isSelected:s||r>0,toggleOpen:()=>{i(!s)}},o().createElement(C._H,{id:"SearchFiltersPrimary.moreFiltersButton",values:{count:r}})):null;return o().createElement("div",{className:l},o().createElement("div",{className:kt},a,c))};Nt.defaultProps={rootClassName:null,className:null,isSecondaryFiltersOpen:!1,toggleSecondaryFiltersOpen:null,selectedSecondaryFiltersCount:0};const It=Nt;var At=n(5876),Ft=n(7803),Rt=n(5391),Ot=n(8351),Tt=n(8681);class xt extends i.Component{constructor(e){super(e),this.state={isSearchMapOpenOnMobile:!1,isMobileModalOpen:!1,currentQueryParams:(0,E.K3)(e),isSecondaryFiltersOpen:!1},this.onMapMoveEnd=p()(this.onMapMoveEnd.bind(this),300),this.onOpenMobileModal=this.onOpenMobileModal.bind(this),this.onCloseMobileModal=this.onCloseMobileModal.bind(this),this.applyFilters=this.applyFilters.bind(this),this.cancelFilters=this.cancelFilters.bind(this),this.resetAll=this.resetAll.bind(this),this.getHandleChangedValueFn=this.getHandleChangedValueFn.bind(this),this.handleSortBy=this.handleSortBy.bind(this)}onMapMoveEnd(e,t){const{viewportBounds:n,viewportCenter:a}=t,s=this.props.routeConfiguration,i=(0,b.XA)("SearchPage",s),o="undefined"!==typeof window&&window.location&&window.location.pathname;if(e&&o===i){const{history:e,location:t,config:i}=this.props,{listingFields:o}=(null===i||void 0===i?void 0:i.listing)||{},{defaultFilters:r}=(null===i||void 0===i?void 0:i.search)||{},{address:l,bounds:c,mapSearch:d,...p}=(0,L.Qc)(t.search,{latlng:["origin"],latlngBounds:["bounds"]}),h=!1,m={address:l,...(0,v.QS)(this.props.config)?{origin:a}:{},bounds:n,mapSearch:!0,...(0,E.ZB)(p,o,r,h)};e.push((0,b.EW)("SearchPage",s,{},m))}}onOpenMobileModal(){this.setState({isMobileModalOpen:!0})}onCloseMobileModal(){this.setState({isMobileModalOpen:!1})}applyFilters(){const{history:e,routeConfiguration:t,config:n}=this.props,{listingFields:a}=(null===n||void 0===n?void 0:n.listing)||{},{defaultFilters:s,sortConfig:i}=(null===n||void 0===n?void 0:n.search)||{},o={...(0,E.K3)(this.props),...this.state.currentQueryParams},r=(0,E.zU)(o,a,s,i);e.push((0,b.EW)("SearchPage",t,{},r))}cancelFilters(){this.setState({currentQueryParams:{}})}resetAll(e){const{history:t,routeConfiguration:n,config:a}=this.props,{listingFields:s}=(null===a||void 0===a?void 0:a.listing)||{},{defaultFilters:i}=(null===a||void 0===a?void 0:a.search)||{},o=(0,E.K3)(this.props),r=(0,v.sU)(s,i);this.setState({currentQueryParams:{}});const l=m()(o,r);t.push((0,b.EW)("SearchPage",n,{},l))}getHandleChangedValueFn(e){const{history:t,routeConfiguration:n,config:a}=this.props,{listingFields:s}=(null===a||void 0===a?void 0:a.listing)||{},{defaultFilters:i,sortConfig:o}=(null===a||void 0===a?void 0:a.search)||{},r=(0,E.K3)(this.props);return l=>{this.setState((e=>{const{address:t,bounds:n,keywords:s}=r,i={...r,...e.currentQueryParams},o=(0,v.Sy)(a)?{keywords:s}:{};return{currentQueryParams:{...i,...l,...o,address:t,bounds:n}}}),(()=>{if(e){const e=this.state.currentQueryParams,a=(0,E.zU)(e,s,i,o);t.push((0,b.EW)("SearchPage",n,{},a))}}))}}handleSortBy(e,t){const{history:n,routeConfiguration:a}=this.props,s=(0,E.K3)(this.props),i=t?{...s,[e]:t}:m()(s,e);n.push((0,b.EW)("SearchPage",a,{},i))}render(){var e;const{intl:t,listings:n,location:a,onManageDisableScrolling:s,pagination:i,scrollingDisabled:r,searchInProgress:l,searchListingsError:c,searchParams:d,activeListingId:p,onActivateListing:h,routeConfiguration:m,config:u}=this.props,{listingFields:f}=(null===u||void 0===u?void 0:u.listing)||{},{defaultFilters:M,sortConfig:b}=(null===u||void 0===u?void 0:u.search)||{},S=null===u||void 0===u||null===(e=u.listing)||void 0===e?void 0:e.listingTypes.map((e=>e.listingType)),y=u.currency,{searchParamsAreInSync:P,urlQueryParams:N,searchParamsInURL:I}=(0,E.uG)(a.search,d,f,M,b,(0,v.QS)(u)),A=(0,E.ZB)(I,f,M,!1),F="undefined"!==typeof window&&window.innerWidth<768,R=!F||F&&this.state.isSearchMapOpenOnMobile,O=(0,v.Sy)(u),T=O?M.filter((e=>"keywords"!==e.key)):M,[x,B]=(0,E.Wo)(f,S),H=[...x,...T],D=[...x,...T,...B],Z=!!(B&&B.length>0),W=(0,E.ZB)(A,f,M),U=Object.keys(W),z=O?U.filter((e=>"keywords"!==e)).length:U.length,Q=null==I.dates||null!=I.dates&&I.dates===W.dates,V=Z?(0,E.ZB)(A,B,[]):{},K=Object.keys(V).length,G=!!Z&&this.state.isSecondaryFiltersOpen,j=Z?{isSecondaryFiltersOpen:this.state.isSecondaryFiltersOpen,toggleSecondaryFiltersOpen:e=>{this.setState({isSecondaryFiltersOpen:e,currentQueryParams:{}})},selectedSecondaryFiltersCount:K}:{},X=!!i&&null!=i.totalItems,q=P&&X?i.totalItems:null!==i&&void 0!==i&&i.paginationUnsupported?n.length:0,Y=!l&&P&&!!(X||null!==i&&void 0!==i&&i.paginationUnsupported),J=(0,v._)(b.conflictingFilters,A,f,M),$=e=>{var t;return b.active?o().createElement(Ft.Z,{sort:A[b.queryParamName],isConflictingFilterActive:!!J,hasConflictingFilters:!!((null===(t=b.conflictingFilters)||void 0===t?void 0:t.length)>0),selectedFilters:W,onSelect:this.handleSortBy,showAsPopup:!0,mode:e,contentPlacementOffset:-14}):null},ee=o().createElement(Ot.Z,{listingsAreLoaded:Y,totalItems:q,location:a,resetAll:this.resetAll}),{bounds:te,origin:ne}=I||{},{title:ae,description:se,schema:ie}=(0,E.A6)(n,I||{},t,m,u),oe=this.state.isMobileModalOpen?g()(Tt.Z.topbarBehindModal,Tt.Z.topbar):Tt.Z.topbar;return o().createElement(_.T3,{scrollingDisabled:r,description:se,title:ae,schema:ie},o().createElement(w.Z,{rootClassName:oe,currentPage:"SearchPage",currentSearchParams:N}),o().createElement("div",{className:Tt.Z.container},o().createElement("div",{className:Tt.Z.searchResultContainer},o().createElement(At.Z,{className:Tt.Z.searchFiltersMobileMap,urlQueryParams:A,sortByComponent:$("mobile"),listingsAreLoaded:Y,resultsCount:q,searchInProgress:l,searchListingsError:c,showAsModalMaxWidth:768,onMapIconClick:()=>this.setState({isSearchMapOpenOnMobile:!0}),onManageDisableScrolling:s,onOpenModal:this.onOpenMobileModal,onCloseModal:this.onCloseMobileModal,resetAll:this.resetAll,selectedFiltersCount:z,noResultsInfo:ee,isMapVariant:!0},D.map((e=>o().createElement(k.Z,{key:"SearchFiltersMobile.".concat(e.scope||"built-in",".").concat(e.key),idPrefix:"SearchFiltersMobile",config:e,marketplaceCurrency:y,urlQueryParams:A,initialValues:(0,E.Sc)(this.props,this.state.currentQueryParams),getHandleChangedValueFn:this.getHandleChangedValueFn,intl:t,liveEdit:!0,showAsPopup:!1})))),o().createElement(ft.Z,{className:Tt.Z.mainPanelMapVariant,sortByComponent:$("desktop"),isSortByActive:b.active,listingsAreLoaded:Y,resultsCount:q,searchInProgress:l,searchListingsError:c,noResultsInfo:ee},o().createElement(It,j,H.map((e=>o().createElement(k.Z,{key:"SearchFiltersPrimary.".concat(e.scope||"built-in",".").concat(e.key),idPrefix:"SearchFiltersPrimary",config:e,marketplaceCurrency:y,urlQueryParams:A,initialValues:(0,E.Sc)(this.props,this.state.currentQueryParams),getHandleChangedValueFn:this.getHandleChangedValueFn,intl:t,showAsPopup:!0,contentPlacementOffset:-14}))))),G?o().createElement("div",{className:g()(Tt.Z.searchFiltersPanel)},o().createElement(wt,{urlQueryParams:A,listingsAreLoaded:Y,applyFilters:this.applyFilters,cancelFilters:this.cancelFilters,resetAll:this.resetAll,onClosePanel:()=>this.setState({isSecondaryFiltersOpen:!1})},B.map((e=>o().createElement(k.Z,{key:"SearchFiltersSecondary.".concat(e.scope||"built-in",".").concat(e.key),idPrefix:"SearchFiltersSecondary",config:e,marketplaceCurrency:y,urlQueryParams:A,initialValues:(0,E.Sc)(this.props,this.state.currentQueryParams),getHandleChangedValueFn:this.getHandleChangedValueFn,intl:t,showAsPopup:!1}))))):o().createElement("div",{className:g()(Tt.Z.listingsForMapVariant,{[Tt.Z.newSearchInProgress]:!(Y||c)})},c?o().createElement(_.H3,{className:Tt.Z.error},o().createElement(C._H,{id:"SearchPage.searchError"})):null,Q?null:o().createElement(_.H5,null,o().createElement(C._H,{id:"SearchPage.invalidDatesFilter"})),o().createElement(Rt.Z,{className:Tt.Z.searchListingsPanel,listings:n,pagination:Y?i:null,search:(0,L.Qc)(a.search),setActiveListing:h,isMapVariant:!0}))),o().createElement(_.sP,{className:Tt.Z.mapPanel,id:"SearchPage.map",isModalOpenOnMobile:this.state.isSearchMapOpenOnMobile,onClose:()=>this.setState({isSearchMapOpenOnMobile:!1}),showAsModalMaxWidth:768,onManageDisableScrolling:s},o().createElement("div",{className:Tt.Z.mapWrapper,"data-testid":"searchMapContainer"},R?o().createElement(Ct,{reusableContainerClassName:Tt.Z.map,activeListingId:p,bounds:te,center:ne,isSearchMapOpenOnMobile:this.state.isSearchMapOpenOnMobile,location:a,listings:n||[],onMapMoveEnd:this.onMapMoveEnd,onCloseAsModal:()=>{s("SearchPage.map",!1)},messages:t.messages}):null))))}}xt.defaultProps={listings:[],pagination:null,searchListingsError:null,searchParams:{},activeListingId:null};const Bt=(0,l.compose)((0,r.connect)((e=>{const{currentPageResultIds:t,pagination:n,searchInProgress:a,searchListingsError:s,searchParams:i,activeListingId:o}=e.SearchPage;return{listings:(0,S.gg)(e,t),pagination:n,scrollingDisabled:(0,y.uS)(e),searchInProgress:a,searchListingsError:s,searchParams:i,activeListingId:o}}),(e=>({onManageDisableScrolling:(t,n)=>e((0,y.R4)(t,n)),onActivateListing:t=>e((0,P.pN)(t))}))))((e=>{const t=(0,f.mX)(),n=(0,M.a5)(),a=(0,C.YB)(),s=(0,c.useHistory)(),i=(0,c.useLocation)();return o().createElement(xt,Object.assign({config:t,routeConfiguration:n,intl:a,history:s,location:i},e))}))},193:(e,t,n)=>{n.d(t,{Js:()=>p,Kl:()=>h,eD:()=>l,ek:()=>c,xX:()=>d});var a=n(6319);const{LatLng:s,LatLngBounds:i}=a.types,o=e=>e&&e.geometry&&e.geometry.location?new s(e.geometry.location.lat(),e.geometry.location.lng()):null,r=e=>{if(e&&e.geometry&&e.geometry.viewport){const t=e.geometry.viewport.getNorthEast(),n=e.geometry.viewport.getSouthWest();return new i(new s(t.lat(),t.lng()),new s(n.lat(),n.lng()))}return null},l=(e,t)=>new Promise(((n,a)=>{const s=window.google.maps.places.PlacesServiceStatus,i=document.createElement("div"),l=new window.google.maps.places.PlacesService(i),c=t?{sessionToken:t}:{};l.getDetails({placeId:e,fields:["address_component","formatted_address","geometry","place_id"],...c},((t,i)=>{i!==s.OK?a(new Error('Could not get details for place id "'.concat(e,'", error status was "').concat(i,'"'))):n({address:t.formatted_address,origin:o(t),bounds:r(t)})}))})),c=(e,t,n)=>new Promise(((a,s)=>{const i=new window.google.maps.places.AutocompleteService,o=t?{sessionToken:t}:{};i.getPlacePredictions({input:e,...o,...n},((t,n)=>{if((e=>{const{OK:t,ZERO_RESULTS:n}=window.google.maps.places.PlacesServiceStatus;return e===t||e===n})(n)){a({search:e,predictions:t||[]})}else s(new Error("Prediction service status not OK: ".concat(n)))}))})),d=(e,t)=>{const n=new window.google.maps.Circle({center:new window.google.maps.LatLng(e.lat,e.lng),radius:t}).getBounds(),a=n.getNorthEast(),o=n.getSouthWest();return new i(new s(a.lat(),a.lng()),new s(o.lat(),o.lng()))},p=(e,t)=>{const{getPixelPositionOffset:n}=t;return"function"===typeof n?n(e.offsetWidth,e.offsetHeight):{}},h=(e,t,n)=>{const a=(e,t)=>new t(e.lat,e.lng),s=(e,t)=>new t(new window.google.maps.LatLng(e.ne.lat,e.ne.lng),new window.google.maps.LatLng(e.sw.lat,e.sw.lng)),i=(e,t,n)=>e instanceof t?e:n(e,t);if(n.bounds){return((e,t,n)=>{const a=e.fromLatLngToDivPixel(n.getNorthEast()),s=e.fromLatLngToDivPixel(n.getSouthWest());return a&&s?{left:"".concat(s.x+t.x,"px"),top:"".concat(a.y+t.y,"px"),width:"".concat(a.x-s.x-t.x,"px"),height:"".concat(s.y-a.y-t.y,"px")}:{left:"-9999px",top:"-9999px"}})(e,t,i(n.bounds,window.google.maps.LatLngBounds,s))}return((e,t,n)=>{const a=e.fromLatLngToDivPixel(n);if(a){const{x:e,y:n}=a;return{left:"".concat(e+t.x,"px"),top:"".concat(n+t.y,"px")}}return{left:"-9999px",top:"-9999px"}})(e,t,i(n.position,window.google.maps.LatLng,a))}}};
//# sourceMappingURL=SearchPageWithMap.6a5d350e.chunk.js.map