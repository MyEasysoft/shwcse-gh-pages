"use strict";exports.id=352,exports.ids=[352],exports.modules={5846:(e,t,a)=>{a.r(t),a.d(t,{default:()=>pe});var i=a(6689),n=a.n(i),r=a(6695),o=a(6022),s=a(4661),l=a(3126),c=a(6639),d=a(6134),u=a(4941),m=a(7285),g=a(6902),p=a(3093),v=a(2790),h=a(9930),y=a(9822),P=a.n(y),E=a(9200),C=a.n(E),_=a(3176),b=a(6319);const{UUID:f,Money:k}=b.types,I=(e,t)=>P()(Object.entries(t),((t,a)=>{let[i,n]=a;return!(!Object.prototype.hasOwnProperty.call(e,i)||!n(e[i]))&&t}),!0),N=(e,t,a,i)=>{if(window&&window.sessionStorage&&t&&e){const n={orderData:e,listing:t,transaction:a,storedAt:new Date},r=function(e,t){return this[e]instanceof Date?{date:t,_serializedType:"SerializableDate"}:this[e]instanceof C()?{decimal:t,_serializedType:"SerializableDecimal"}:b.types.replacer(e,t)},o=JSON.stringify(n,r);window.sessionStorage.setItem(i,o)}},T=e=>{if(window&&window.sessionStorage){const t=window.sessionStorage.getItem(e),a=(e,t)=>t&&"object"===typeof t&&"SerializableDate"===t._serializedType?new Date(t.date):t&&"object"===typeof t&&"SerializableDecimal"===t._serializedType?new(C())(t.decimal):b.types.reviver(e,t),{orderData:i,listing:n,transaction:r,storedAt:o}=t?JSON.parse(t,a):{},s=null===i||void 0===i?void 0:i.bookingDates,l=!s||(e=>I(e,{bookingStart:e=>e instanceof Date,bookingEnd:e=>e instanceof Date}))(s),c=!!o&&(0,_.fT)(o,(0,_.U2)(new Date,1,"days")),d=!r||(e=>{let t=null;try{var a;const i=null===e||void 0===e||null===(a=e.attributes)||void 0===a?void 0:a.processName;t=(0,m.Yt)(i)}catch(i){return console.error("Transaction, found from sessionStorage, was following unsupported transaction process."),!1}return I(e,{id:e=>e instanceof f,type:e=>"transaction"===e,attributes:e=>"object"===typeof e&&Object.values(t.transitions).includes(e.lastTransition)})})(r),u=c&&l&&(e=>I(e,{id:e=>e instanceof f,attributes:e=>"object"===typeof e&&e.price instanceof k}))(n)&&d;if(u)return{orderData:i,listing:n,transaction:r}}return{}};var D=a(1949),M=a(9003),S=a.n(M),w=a(1233);const A={topbar:"CheckoutPage_topbar__k07kt",contentContainer:"CheckoutPage_contentContainer__vNONJ",orderFormContainer:"CheckoutPage_orderFormContainer__0JA45",listingImageMobile:"CheckoutPage_listingImageMobile__rIpgh",rootForImage:"CheckoutPage_rootForImage__Z4MDV",avatarWrapper:"CheckoutPage_avatarWrapper__6JZzu",avatarMobile:"CheckoutPage_avatarMobile__fWjDI",headingContainer:"CheckoutPage_headingContainer__nk7ok",heading:"CheckoutPage_heading__86Q2N",listingDetailsWrapper:"CheckoutPage_listingDetailsWrapper__H8Ooc",detailsHeadingMobile:"CheckoutPage_detailsHeadingMobile__t-UMX",author:"CheckoutPage_author__cTV2f h4",priceBreakdownContainer:"CheckoutPage_priceBreakdownContainer__KqI59",priceBreakdownTitle:"CheckoutPage_priceBreakdownTitle__da8I9",paymentContainer:"CheckoutPage_paymentContainer__cV4tO",orderError:"CheckoutPage_orderError__aJIyS",notFoundError:"CheckoutPage_notFoundError__p2Npf",speculateError:"CheckoutPage_speculateError__ZTokl",paymentForm:"CheckoutPage_paymentForm__vuiwL",detailsContainerDesktop:"CheckoutPage_detailsContainerDesktop__w4SVt",detailsAspectWrapper:"CheckoutPage_detailsAspectWrapper__FjTNJ",detailsHeadings:"CheckoutPage_detailsHeadings__HBcW9",detailsSubtitle:"CheckoutPage_detailsSubtitle__BWgQj h5",orderBreakdownHeader:"CheckoutPage_orderBreakdownHeader__6zbvg",orderBreakdownTitle:"CheckoutPage_orderBreakdownTitle__etMpy",totalDivider:"CheckoutPage_totalDivider__zfy1R",orderBreakdown:"CheckoutPage_orderBreakdown__KkPra",section:"CheckoutPage_section__AyQhE",sectionHeading:"CheckoutPage_sectionHeading__6Sxh3 p",field:"CheckoutPage_field__qx3Wj",fieldInquiryMessage:"CheckoutPage_fieldInquiryMessage__F5tIh",error:"CheckoutPage_error__0BAAg",priceContainer:"CheckoutPage_priceContainer__YuyOj",price:"CheckoutPage_price__boBWI p",perUnit:"CheckoutPage_perUnit__Zs86f p",inquiryPrice:"CheckoutPage_inquiryPrice__yramS p"},H=e=>{const[t,a]=(0,i.useState)(!1);(0,i.useEffect)((()=>{const e=window.matchMedia("(max-width: 767px)");function t(e){a(e.matches)}return a(e.matches),e.addEventListener("change",t),function(){e.removeEventListener("change",t)}}));const{className:r,rootClassName:o,intl:s}=e,l=S()(o||A.topbar,r);return n().createElement("div",{className:l},n().createElement(h.Ux,{layout:t?"mobile":"desktop",alt:s.formatMessage({id:"CheckoutPage.goToLandingPage"})}))};H.defaultProps={className:null,rootClassName:null};const F=H;var O=a(1422),q=a(3665),L=a(5161),U=a(5074),W=a(5198);const R=(e,t,a)=>{const i=a.listing.listingTypes.find((t=>t.listingType===e)),{process:n,alias:r,unitType:o,...s}=(null===i||void 0===i?void 0:i.transactionType)||{};return t?{unitType:t,...s}:{}},B=(e,t)=>{var a;const{name:i,addressLine1:n,addressLine2:r,postal:o,city:s,state:l,country:c}=e,d=n&&o?{address:{city:s,country:c,line1:n,line2:r,postal_code:o,state:l}}:{};return{name:i,email:null===t||void 0===t||null===(a=t.attributes)||void 0===a?void 0:a.email,...d}},z=(e,t)=>{var a,i,n,r;return!!(e&&null!==t&&void 0!==t&&null!==(a=t.stripeCustomer)&&void 0!==a&&null!==(i=a.attributes)&&void 0!==i&&i.stripeCustomerId&&null!==t&&void 0!==t&&null!==(n=t.stripeCustomer)&&void 0!==n&&null!==(r=n.defaultPaymentMethod)&&void 0!==r&&r.id)},Y=(e,t)=>{const a=t.getState(e);return a===t.states.PAYMENT_EXPIRED||a===t.states.PENDING_PAYMENT&&(0,_.wB)(e.attributes.lastTransitionedAt,new Date)>=15},j=(e,t)=>t.hasPassedState(t.states.PENDING_PAYMENT,e),x=(e,t,a,i,n)=>{if(null!==e&&void 0!==e&&e.id){const{orderData:r,listing:o}=t;a(r,o,e,n),i({...t,transaction:e})}};var Q=a(1760);const J=e=>{var t,a;const{listing:i,listingTitle:r,author:o,firstImage:s,layoutListingImageConfig:l,speculateTransactionErrorMessage:c,showPrice:d,processName:u,breakdown:m,intl:g}=e,{price:p,publicData:v}=(null===i||void 0===i?void 0:i.attributes)||{},y=v.unitType||"unknown",{aspectWidth:P=1,aspectHeight:E=1,variantPrefix:C="listing-card"}=l||{},_=s?Object.keys(null===s||void 0===s||null===(t=s.attributes)||void 0===t?void 0:t.variants).filter((e=>e.startsWith(C))):[];return n().createElement("div",{className:A.detailsContainerDesktop},n().createElement(h.Zz,{width:P,height:E,className:A.detailsAspectWrapper},n().createElement(h.t3,{rootClassName:A.rootForImage,alt:r,image:s,variants:_})),n().createElement("div",{className:A.listingDetailsWrapper},n().createElement("div",{className:A.avatarWrapper},n().createElement(h.Jh,{user:o,disableProfileLink:!0})),n().createElement("div",{className:A.detailsHeadings},n().createElement(h.H4,{as:"h2"},n().createElement(h.RC,{name:"ListingPage",params:{id:null===i||void 0===i||null===(a=i.id)||void 0===a?void 0:a.uuid,slug:(0,L.qi)(r)}},r)),d?n().createElement("div",{className:A.priceContainer},n().createElement("p",{className:A.price},(0,W.lb)(g,p)),n().createElement("div",{className:A.perUnit},n().createElement(w._H,{id:"CheckoutPageWithInquiryProcess.perUnit",values:{unitType:y}}))):null),c),m?n().createElement("div",{className:A.orderBreakdownHeader},n().createElement(h.H6,{as:"h3",className:A.orderBreakdownTitle},n().createElement(w._H,{id:"CheckoutPage.".concat(u,".orderBreakdown")})),n().createElement("hr",{className:A.totalDivider})):null,m)};J.defaultProps={speculateTransactionErrorMessage:null,breakdown:null};const K=J,V=e=>{var t;const{listingTitle:a,author:i,firstImage:r,layoutListingImageConfig:o}=e,{aspectWidth:s=1,aspectHeight:l=1,variantPrefix:c="listing-card"}=o||{},d=r?Object.keys(null===r||void 0===r||null===(t=r.attributes)||void 0===t?void 0:t.variants).filter((e=>e.startsWith(c))):[];return n().createElement(n().Fragment,null,n().createElement(h.Zz,{width:s,height:l,className:A.listingImageMobile},n().createElement(h.t3,{rootClassName:A.rootForImage,alt:a,image:r,variants:d})),n().createElement("div",{className:S()(A.avatarWrapper,A.avatarMobile)},n().createElement(h.Jh,{user:i,disableProfileLink:!0})))},Z=e=>{const{breakdown:t,speculateTransactionErrorMessage:a}=e;return n().createElement("div",{className:A.priceBreakdownContainer},a,t)},G=["processing","requires_capture","succeeded"],X="PAY_AND_SAVE_FOR_LATER_USE",$="USE_SAVED_CARD",ee=(e,t,a,i)=>{var n,r,o,s,l,c;const d=null===(n=e.orderData)||void 0===n?void 0:n.quantity,u=d?{quantity:d}:{},m=null===(r=e.orderData)||void 0===r?void 0:r.deliveryMethod,g=m?{deliveryMethod:m}:{},{listingType:p,unitType:v}=(null===e||void 0===e||null===(o=e.listing)||void 0===o||null===(s=o.attributes)||void 0===s?void 0:s.publicData)||{},h={protectedData:{...R(p,v,i),...g,...t}};var y;return{listingId:null===e||void 0===e||null===(l=e.listing)||void 0===l?void 0:l.id,...g,...u,...(y=null===(c=e.orderData)||void 0===c?void 0:c.bookingDates,y?{bookingDates:y}:{}),...h,...a}},te=e=>{let{pageData:t,fetchSpeculatedTransaction:a,fetchStripeCustomer:i,config:n}=e;i();((e,t,a)=>{var i,n,r,o,s;const l=t?t.transaction:null,c=t.listing,d=(null===l||void 0===l||null===(i=l.attributes)||void 0===i?void 0:i.processName)||(null===c||void 0===c||null===(n=c.attributes)||void 0===n||null===(r=n.publicData)||void 0===r||null===(o=r.transactionProcessAlias)||void 0===o?void 0:o.split("/")[0]),u=d?(0,m.Yt)(d):null;if(null!==t&&void 0!==t&&null!==(s=t.listing)&&void 0!==s&&s.id&&t.orderData&&u&&!j(l,u)){var g,p;const i=null===(g=t.listing.attributes.publicData)||void 0===g?void 0:g.transactionProcessAlias,n=l?l.id:null,r=(null===l||void 0===l||null===(p=l.attributes)||void 0===p?void 0:p.lastTransition)===u.transitions.INQUIRE?u.transitions.REQUEST_PAYMENT_AFTER_INQUIRY:u.transitions.REQUEST_PAYMENT;a(e,i,n,r,u.isPrivileged(r))}})(ee(t,{},{},n),t,a)},ae=(e,t,a,i,n,r)=>{var o,s,l;if(n)return;r(!0);const{history:c,config:d,routeConfiguration:m,speculatedTransaction:g,currentUser:p,stripeCustomerFetched:v,paymentIntent:h,dispatch:y,onInitiateOrder:P,onConfirmCardPayment:E,onConfirmPayment:C,onSendMessage:_,onSavePaymentMethod:b,onSubmitCallback:f,pageData:k,setPageData:I,sessionStorageKey:T}=a,{card:D,message:M,paymentMethod:S,formValues:w}=e,{saveAfterOnetimePayment:A}=w,H=((e,t)=>"defaultCard"===e?$:t?X:"ONETIME_PAYMENT")(S,Array.isArray(A)&&A.length>0),F=z(v,p),q=F?null===p||void 0===p||null===(o=p.stripeCustomer)||void 0===o||null===(s=o.defaultPaymentMethod)||void 0===s||null===(l=s.attributes)||void 0===l?void 0:l.stripePaymentMethodId:null,L=h&&G.includes(h.status),U={pageData:k,speculatedTransaction:g,stripe:i,card:D,billingDetails:B(w),message:M,paymentIntent:h,hasPaymentIntentUserActionsDone:L,stripePaymentMethodId:q,process:t,onInitiateOrder:P,onConfirmCardPayment:E,onConfirmPayment:C,onSendMessage:_,onSavePaymentMethod:b,sessionStorageKey:T,stripeCustomer:null===p||void 0===p?void 0:p.stripeCustomer,isPaymentFlowUseSavedCard:H===$,isPaymentFlowPayAndSaveCard:H===X,setPageData:I},W=(e=>{const{saveAfterOnetimePayment:t,recipientName:a,recipientPhoneNumber:i,recipientAddressLine1:n,recipientAddressLine2:r,recipientPostal:o,recipientCity:s,recipientState:l,recipientCountry:c}=e;return a&&n&&o?{shippingDetails:{name:a,phoneNumber:i,address:{city:s,country:c,line1:n,line2:r,postalCode:o,state:l}}}:{}})(w);((e,t)=>{var a,i,n;const{hasPaymentIntentUserActionsDone:r,isPaymentFlowUseSavedCard:o,isPaymentFlowPayAndSaveCard:s,message:l,onConfirmCardPayment:c,onConfirmPayment:d,onInitiateOrder:m,onSavePaymentMethod:g,onSendMessage:p,pageData:v,paymentIntent:h,process:y,setPageData:P,sessionStorageKey:E,stripeCustomer:C,stripePaymentMethodId:_}=t,b=(0,u.G$)(v.transaction),f=(0,u.Cy)(C),k=null===v||void 0===v||null===(a=v.listing)||void 0===a||null===(i=a.attributes)||void 0===i||null===(n=i.publicData)||void 0===n?void 0:n.transactionProcessAlias;let I=null;const T=(e,t)=>e.then(t);return function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return e=>t.reduce(T,Promise.resolve(e))}((e=>{var t,a;const i=null===(t=b.attributes.protectedData)||void 0===t?void 0:t.stripePaymentIntents,n=(null===b||void 0===b||null===(a=b.attributes)||void 0===a?void 0:a.lastTransition)===y.transitions.INQUIRE?y.transitions.REQUEST_PAYMENT_AFTER_INQUIRY:y.transitions.REQUEST_PAYMENT,r=y.isPrivileged(n),o=i?Promise.resolve(b):m(e,k,b.id,n,r);return o.then((e=>{x(e,v,N,P,E)})),o}),(e=>{var a,i;const n=e,s=null===n||void 0===n||null===(a=n.attributes)||void 0===a||null===(i=a.protectedData)||void 0===i?void 0:i.stripePaymentIntents;if(!s)throw new Error("Missing StripePaymentIntents key in transaction's protectedData. Check that your transaction process is configured to use payment intents.");const{stripePaymentIntentClientSecret:l}=s?n.attributes.protectedData.stripePaymentIntents.default:null,{stripe:d,card:u,billingDetails:m,paymentIntent:g}=t,p=o?{}:{card:u},v=o?{payment_method:_}:{payment_method:{billing_details:m,card:u}},h={stripePaymentIntentClientSecret:l,orderId:null===n||void 0===n?void 0:n.id,stripe:d,...p,paymentParams:v};return r?Promise.resolve({transactionId:null===n||void 0===n?void 0:n.id,paymentIntent:g}):c(h)}),(e=>{var t;I=e.paymentIntent;const a=e.transactionId,i=y.transitions.CONFIRM_PAYMENT,n=(null===b||void 0===b||null===(t=b.attributes)||void 0===t?void 0:t.lastTransition)===i?Promise.resolve(b):d(a,i,{});return n.then((e=>{x(e,v,N,P,E)})),n}),(e=>{const t=null===e||void 0===e?void 0:e.id;return p({id:t,message:l})}),(e=>s?g(f,(I||h).payment_method).then((t=>t.errors?{...e,paymentMethodSaved:!1}:{...e,paymentMethodSaved:!0})).catch((t=>({...e,paymentMethodSaved:!1}))):Promise.resolve({...e,paymentMethodSaved:!0})))(e)})(ee(k,W,H===$&&F?{paymentMethod:q}:H===X?{setupPaymentMethodForSaving:!0}:{},d),U).then((e=>{const{orderId:t,messageSuccess:a,paymentMethodSaved:i}=e;r(!1);const n=a?null:t,o=(0,O.XA)("OrderDetailsPage",m,{id:t.uuid});((e,t,a)=>{a((0,O.dI)("OrderDetailsPage",t).setInitialValues(e))})({initialMessageFailedToTransaction:n,savePaymentMethodFailed:!i},m,y),f(),c.push(o)})).catch((e=>{console.error(e),r(!1)}))},ie=e=>{var t,a,r,o,s,l,c,d,g,p,v,y,P,E,C,_,b,f,k,I,N;const[T,D]=(0,i.useState)(!1),[M,S]=(0,i.useState)(null),{scrollingDisabled:H,speculateTransactionError:O,speculatedTransaction:R,initiateOrderError:B,confirmPaymentError:x,intl:J,currentUser:X,confirmCardPaymentError:$,paymentIntent:ee,retrievePaymentIntentError:te,stripeCustomerFetched:ie,pageData:ne,processName:re,listingTitle:oe,title:se,config:le}=e,ce=(0,U.Cw)(O)||(0,U.Cw)(B),{listing:de,transaction:ue,orderData:me}=ne,ge=(0,u.G$)(ue),pe=(0,u.G$)(R,{},null),ve=(null===ge||void 0===ge||null===(t=ge.attributes)||void 0===t||null===(a=t.lineItems)||void 0===a?void 0:a.length)>0?ge:pe,he=null===de||void 0===de||null===(r=de.attributes)||void 0===r||null===(o=r.availabilityPlan)||void 0===o?void 0:o.timezone,ye=null===de||void 0===de||null===(s=de.attributes)||void 0===s||null===(l=s.publicData)||void 0===l?void 0:l.transactionProcessAlias,Pe=null===de||void 0===de||null===(c=de.attributes)||void 0===c||null===(d=c.publicData)||void 0===d?void 0:d.unitType,Ee="line-item/".concat(Pe)===q.PC?q.In:q.FJ,Ce=null!==ve&&void 0!==ve&&null!==(g=ve.booking)&&void 0!==g&&g.id?{booking:ve.booking,dateType:Ee,timeZone:he}:{},_e=ve.id&&(null===(p=ve.attributes.lineItems)||void 0===p?void 0:p.length)>0?n().createElement(h.J0,Object.assign({className:A.orderBreakdown,userRole:"customer",transaction:ve},Ce,{currency:le.currency,marketplaceName:le.marketplaceName})):null,be=(null===ve||void 0===ve||null===(v=ve.attributes)||void 0===v||null===(y=v.lineItems)||void 0===y?void 0:y.length)>0?((e,t)=>{const a=e.attributes.payinTotal;return(0,W.lb)(t,a)})(ve,J):null,fe=re?(0,m.Yt)(re):null,ke=fe.transitions,Ie=Y(ge,fe),Ne=!(!X||ce||B||O||te||Ie),Te=(null===de||void 0===de||null===(P=de.images)||void 0===P?void 0:P.length)>0?de.images[0]:null,De=((e,t,a,i,r,o)=>{let s=null,l=null,c=null;const d=(0,U.N2)(t),u=(0,U.Wq)(t),m=(0,U.gu)(t);if(e)s=n().createElement(w._H,{id:"CheckoutPage.listingNotFoundError"});else if(d)l=n().createElement(w._H,{id:"CheckoutPage.initiateOrderAmountTooLow"});else if((0,U.cJ)(t))l=n().createElement(w._H,{id:"CheckoutPage.bookingTimeNotAvailableMessage"});else if((0,U.IK)(t))l=n().createElement(w._H,{id:"CheckoutPage.correctQuantityInformationMissing"});else if((0,U.Z2)(t))l=n().createElement(w._H,{id:"CheckoutPage.notEnoughStockMessage"});else if(u)l=n().createElement(w._H,{id:"CheckoutPage.chargeDisabledMessage"});else if(m&&m.length>0){const e="Your destination account needs to have at least one of the following capabilities enabled";if(1===m.length&&m[0].indexOf(e)>-1)l=n().createElement(w._H,{id:"CheckoutPage.destinationAccountNotCompleteStripeError"});else{const e=m.join(", ");l=n().createElement(w._H,{id:"CheckoutPage.initiateOrderStripeError",values:{stripeErrors:e}})}}else(0,U.VR)(t)?l=n().createElement(w._H,{id:"CheckoutPage.tooManyRequestsError"}):t&&(l=n().createElement(w._H,{id:"CheckoutPage.initiateOrderError",values:{listingLink:o}}));(0,U.Eo)(r)?c=n().createElement(w._H,{id:"CheckoutPage.providerStripeAccountMissingError"}):(0,U.cJ)(r)?c=n().createElement(w._H,{id:"CheckoutPage.bookingTimeNotAvailableMessage"}):(0,U.Z2)(r)?c=n().createElement(w._H,{id:"CheckoutPage.notEnoughStockMessage"}):(0,U.ce)(r)?c=n().createElement(w._H,{id:"CheckoutPage.initiateOrderAmountTooLow"}):(0,U.IK)(r)?c=n().createElement(w._H,{id:"CheckoutPage.correctQuantityInformationMissing"}):r&&(c=n().createElement(w._H,{id:"CheckoutPage.speculateFailedMessage"}));const g=s?n().createElement("p",{className:A.notFoundError},s):null,p=l?n().createElement("p",{className:A.orderError},l):null,v=c?n().createElement("p",{className:A.orderError},c):null,h=r&&!(0,U.Eo)(r)?n().createElement("p",{className:A.speculateError},n().createElement(w._H,{id:"CheckoutPage.speculateTransactionError"})):null,y=i?n().createElement("p",{className:A.orderError},n().createElement(w._H,{id:"CheckoutPage.retrievingStripePaymentIntentFailed",values:{listingLink:o}})):null;return{listingNotFoundErrorMessage:g,initiateOrderErrorMessage:p,paymentExpiredMessage:a?n().createElement("p",{className:A.orderError},n().createElement(w._H,{id:"CheckoutPage.paymentExpiredMessage",values:{listingLink:o}})):null,retrievePaymentIntentErrorMessage:y,speculateErrorMessage:v,speculateTransactionErrorMessage:h}})(ce,B,Ie,te,O,n().createElement(h.RC,{name:"ListingPage",params:{id:null===de||void 0===de||null===(E=de.id)||void 0===E?void 0:E.uuid,slug:(0,L.qi)(oe)}},n().createElement(w._H,{id:"CheckoutPage.errorlistingLinkText"}))),Me=!((null===ge||void 0===ge||null===(C=ge.attributes)||void 0===C?void 0:C.transitions)||[]).find((e=>e.transition===ke.INQUIRE)),Se=null!==X&&void 0!==X&&null!==(_=X.attributes)&&void 0!==_&&_.profile?"".concat(X.attributes.profile.firstName," ").concat(X.attributes.profile.lastName):null,we=ee&&G.includes(ee.status),Ae={name:Se,recipientName:Se},He="shipping"===(null===me||void 0===me?void 0:me.deliveryMethod)&&!j(ge,fe);return n().createElement(h.T3,{title:se,scrollingDisabled:H},n().createElement(F,{intl:J}),n().createElement("div",{className:A.contentContainer},n().createElement(V,{listingTitle:oe,author:null===de||void 0===de?void 0:de.author,firstImage:Te,layoutListingImageConfig:le.layout.listingImage}),n().createElement("div",{className:A.orderFormContainer},n().createElement("div",{className:A.headingContainer},n().createElement(h.H3,{as:"h1",className:A.heading},se),n().createElement(h.H4,{as:"h2",className:A.detailsHeadingMobile},n().createElement(w._H,{id:"CheckoutPage.listingTitle",values:{listingTitle:oe}}))),n().createElement(Z,{speculateTransactionErrorMessage:De.speculateTransactionErrorMessage,breakdown:_e}),n().createElement("section",{className:A.paymentContainer},De.initiateOrderErrorMessage,De.listingNotFoundErrorMessage,De.speculateErrorMessage,De.retrievePaymentIntentErrorMessage,De.paymentExpiredMessage,Ne?n().createElement(Q.Z,{className:A.paymentForm,onSubmit:t=>ae(t,fe,e,M,T,D),inProgress:T,formId:"CheckoutPagePaymentForm",authorDisplayName:null===de||void 0===de||null===(b=de.author)||void 0===b||null===(f=b.attributes)||void 0===f||null===(k=f.profile)||void 0===k?void 0:k.displayName,showInitialMessageInput:Me,initialValues:Ae,initiateOrderError:B,confirmCardPaymentError:$,confirmPaymentError:x,hasHandledCardPayment:we,loadingData:!ie,defaultPaymentMethod:z(ie,X)?X.stripeCustomer.defaultPaymentMethod:null,paymentIntent:ee,onStripeInitialized:t=>(S(t),((e,t,a)=>{const{paymentIntent:i,onRetrievePaymentIntent:n,pageData:r}=a,o=(null===r||void 0===r?void 0:r.transaction)||null;if(e&&!i&&(null===o||void 0===o?void 0:o.id)&&(null===t||void 0===t?void 0:t.getState(o))===(null===t||void 0===t?void 0:t.states.PENDING_PAYMENT)&&!Y(o,t)){var s,l;const{stripePaymentIntentClientSecret:t}=(null===(s=o.attributes.protectedData)||void 0===s||null===(l=s.stripePaymentIntents)||void 0===l?void 0:l.default)||{};n({stripe:e,stripePaymentIntentClientSecret:t})}})(t,fe,e)),askShippingDetails:He,showPickUplocation:"pickup"===(null===me||void 0===me?void 0:me.deliveryMethod),listingLocation:null===de||void 0===de||null===(I=de.attributes)||void 0===I||null===(N=I.publicData)||void 0===N?void 0:N.location,totalPrice:be,locale:le.localization.locale,stripePublishableKey:le.stripe.publishableKey,marketplaceName:le.marketplaceName,isBooking:(0,m.Ll)(ye),isFuzzyLocation:le.maps.fuzzy.enabled}):null)),n().createElement(K,{listing:de,listingTitle:oe,author:null===de||void 0===de?void 0:de.author,firstImage:Te,layoutListingImageConfig:le.layout.listingImage,speculateTransactionErrorMessage:De.speculateTransactionErrorMessage,isInquiryProcess:!1,processName:re,breakdown:_e,intl:J})))};ie.defaultProps={initiateOrderError:null,confirmPaymentError:null,listing:null,orderData:{},speculateTransactionError:null,speculatedTransaction:null,transaction:null,currentUser:null,paymentIntent:null};const ne=ie;var re=a(2411),oe=a(2887),se=a(1341);const le=e=>{const{error:t}=e,a=(0,U.Cw)(t),i="No transaction process attached to listing"===(null===t||void 0===t?void 0:t.message);return t?n().createElement("p",{className:A.error},a?n().createElement(w._H,{id:"CheckoutPage.listingNotFoundError"}):i?n().createElement(w._H,{id:"CheckoutPageWithInquiryProcess.initiateInquiryErrorNoProcess"}):n().createElement(w._H,{id:"CheckoutPageWithInquiryProcess.initiateInquiryError"})):null},ce=e=>{var t,a;const[r,o]=(0,i.useState)(!1),{scrollingDisabled:s,intl:l,config:c,processName:d,pageData:u,listingTitle:g,title:p,initiateInquiryError:v}=e,y=((e,t,a)=>i=>{var n,r,o;if(e)return;t(!0);const{history:s,config:l,routeConfiguration:c,pageData:d,processName:u,onInquiryWithoutPayment:g,onSubmitCallback:p}=a,{inquiryMessage:v}=i,{listingType:h,transactionProcessAlias:y,unitType:P}=(null===d||void 0===d||null===(n=d.listing)||void 0===n||null===(r=n.attributes)||void 0===r?void 0:r.publicData)||{},E=(u?(0,m.Yt)(u):null).transitions.INQUIRE_WITHOUT_PAYMENT;g({listingId:null===d||void 0===d||null===(o=d.listing)||void 0===o?void 0:o.id,protectedData:{inquiryMessage:v,...R(h,P,l)}},y,E).then((e=>{t(!1),p();const a=(0,O.XA)("OrderDetailsPage",c,{id:e.uuid});s.push(a)})).catch((e=>{console.error(e),t(!1)}))})(r,o,e),{listing:P}=u,{price:E,publicData:C}=(null===P||void 0===P?void 0:P.attributes)||{},_=(null===P||void 0===P||null===(t=P.images)||void 0===t?void 0:t.length)>0?P.images[0]:null,b=n().createElement(h.RC,{name:"ListingPage",params:{id:null===P||void 0===P||null===(a=P.id)||void 0===a?void 0:a.uuid,slug:(0,L.qi)(g)}},g),f=null===C||void 0===C?void 0:C.listingType,k=c.listing.listingTypes.find((e=>e.listingType===f)),I=(0,oe.ED)(k);return n().createElement(h.T3,{title:p,scrollingDisabled:s},n().createElement(F,{intl:l}),n().createElement("div",{className:A.contentContainer},n().createElement(V,{listingTitle:g,author:null===P||void 0===P?void 0:P.author,firstImage:_,layoutListingImageConfig:c.layout.listingImage}),n().createElement("div",{className:A.orderFormContainer},n().createElement("div",{className:A.headingContainer},n().createElement(h.H3,{as:"h1",className:A.heading},p),n().createElement(h.H4,{as:"h2",className:A.detailsHeadingMobile},n().createElement(w._H,{id:"CheckoutPage.listingTitle",values:{listingTitle:b}}),I&&E?n().createElement(n().Fragment,null,n().createElement("br",null),n().createElement("span",{className:A.inquiryPrice},(0,W.lb)(l,E))):null)),n().createElement("section",{className:A.paymentContainer},n().createElement(re.Form,{onSubmit:y,render:e=>{const{rootClassName:t,className:a,submitButtonWrapperClassName:i,formId:r,handleSubmit:o,inProgress:s,authorDisplayName:c}=e,d=S()(t||A.root,a),u=s,m=u;return n().createElement(h.l0,{className:d,onSubmit:o,enforcePagePreloadFor:"OrderDetailsPage"},n().createElement("div",{className:A.section},n().createElement(h.X6,{as:"h4",rootClassName:A.sectionHeading},n().createElement(w._H,{id:"CheckoutPageWithInquiryProcess.messageLabel",values:{authorDisplayName:c}})),n().createElement(h.gC,{className:A.fieldInquiryMessage,type:"textarea",name:"inquiryMessage",id:r?"".concat(r,".message"):"message",placeholder:l.formatMessage({id:"CheckoutPageWithInquiryProcess.messagePlaceholder"},{authorDisplayName:c}),validate:se.kz(l.formatMessage({id:"CheckoutPageWithInquiryProcess.messageRequired"}))})),n().createElement("div",{className:i},n().createElement(le,{error:v}),n().createElement(h.KM,{type:"submit",inProgress:u,disabled:m},n().createElement(w._H,{id:"CheckoutPageWithInquiryProcess.submitButtonText"}))))}}))),n().createElement(K,{listing:P,listingTitle:g,author:null===P||void 0===P?void 0:P.author,firstImage:_,layoutListingImageConfig:c.layout.listingImage,processName:d,showPrice:I&&!!E,intl:l})))},de="CheckoutPage",ue=()=>{var e;e=de,window&&window.sessionStorage&&window.sessionStorage.removeItem(e)},me=e=>{var t,a,i,n;const{transaction:r,listing:o}=e||{},s=null!==r&&void 0!==r&&r.id?null===r||void 0===r||null===(t=r.attributes)||void 0===t?void 0:t.processName:null!==o&&void 0!==o&&o.id?null===o||void 0===o||null===(a=o.attributes)||void 0===a||null===(i=a.publicData)||void 0===i||null===(n=i.transactionProcessAlias)||void 0===n?void 0:n.split("/")[0]:null;return(0,m.b$)(s)},ge=(0,r.compose)((0,o.connect)((e=>{const{listing:t,orderData:a,stripeCustomerFetched:i,speculateTransactionInProgress:n,speculateTransactionError:r,speculatedTransaction:o,transaction:s,initiateInquiryError:l,initiateOrderError:c,confirmPaymentError:d}=e.CheckoutPage,{currentUser:u}=e.user,{confirmCardPaymentError:m,paymentIntent:p,retrievePaymentIntentError:v}=e.stripe;return{scrollingDisabled:(0,g.uS)(e),currentUser:u,stripeCustomerFetched:i,orderData:a,speculateTransactionInProgress:n,speculateTransactionError:r,speculatedTransaction:o,transaction:s,listing:t,initiateInquiryError:l,initiateOrderError:c,confirmCardPaymentError:m,confirmPaymentError:d,paymentIntent:p,retrievePaymentIntentError:v}}),(e=>({dispatch:e,fetchSpeculatedTransaction:(t,a,i,n,r)=>e((0,D.ZI)(t,a,i,n,r)),fetchStripeCustomer:()=>e((0,D.sz)()),onInquiryWithoutPayment:(t,a,i)=>e((0,D.v4)(t,a,i)),onInitiateOrder:(t,a,i,n,r)=>e((0,D.GD)(t,a,i,n,r)),onRetrievePaymentIntent:t=>e((0,p.wI)(t)),onConfirmCardPayment:t=>e((0,p.LW)(t)),onConfirmPayment:(t,a,i)=>e((0,D.B1)(t,a,i)),onSendMessage:t=>e((0,D.bG)(t)),onSavePaymentMethod:(t,a)=>e((0,v.BX)(t,a))}))))((e=>{var t,a,r,o,g;const[p,v]=(0,i.useState)({}),[y,P]=(0,i.useState)(!1),E=(0,c.mX)(),C=(0,d.a5)(),_=(0,l.useIntl)(),b=(0,s.useHistory)();(0,i.useEffect)((()=>{const{orderData:t,listing:a,transaction:i,fetchSpeculatedTransaction:n,fetchStripeCustomer:r}=e,o=((e,t,a)=>{let{orderData:i,listing:n,transaction:r}=e;const o="PUSH"===a.action||"REPLACE"===a.action,s=!!(i&&n&&o);return s&&N(i,n,r,t),s?{orderData:i,listing:n,transaction:r}:T(t)})({orderData:t,listing:a,transaction:i},de,b);v(o||{}),P(!0),me(o)!==m.N5&&te({pageData:o||{},fetchSpeculatedTransaction:n,fetchStripeCustomer:r,config:E})}),[]);const{currentUser:f,params:k,scrollingDisabled:I,speculateTransactionInProgress:D,onInquiryWithoutPayment:M}=e,S=me(p),w=S===m.N5,A=null===p||void 0===p?void 0:p.listing,H=(null===f||void 0===f?void 0:f.id)&&(null===A||void 0===A||null===(t=A.author)||void 0===t||null===(a=t.id)||void 0===a?void 0:a.uuid)===(null===f||void 0===f||null===(r=f.id)||void 0===r?void 0:r.uuid),O=!!(null!==A&&void 0!==A&&A.id&&null!==A&&void 0!==A&&null!==(o=A.author)&&void 0!==o&&o.id&&S);if(y&&!(O&&!H))return console.error("Missing or invalid data for checkout, redirecting back to listing page.",{listing:A}),n().createElement(h.d9,{name:"ListingPage",params:k});const q=null===A||void 0===A||null===(g=A.attributes)||void 0===g?void 0:g.title,L=(0,u.d8)(null===A||void 0===A?void 0:A.author,""),U=S?_.formatMessage({id:"CheckoutPage.".concat(S,".title")},{listingTitle:q,authorDisplayName:L}):"Checkout page is loading data";return S&&w?n().createElement(ce,Object.assign({config:E,routeConfiguration:C,intl:_,history:b,processName:S,pageData:p,listingTitle:q,title:U,onInquiryWithoutPayment:M,onSubmitCallback:ue},e)):!S||w||D?n().createElement(h.T3,{title:U,scrollingDisabled:I},n().createElement(F,{intl:_})):n().createElement(ne,Object.assign({config:E,routeConfiguration:C,intl:_,history:b,processName:S,sessionStorageKey:de,pageData:p,setPageData:v,listingTitle:q,title:U,onSubmitCallback:ue},e))}));ge.setInitialValues=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){const{listing:t,orderData:a}=e;N(a,t,null,de)}return(0,D.LA)(e)},ge.displayName="CheckoutPage";const pe=ge}};
//# sourceMappingURL=CheckoutPage.e3ae9229.chunk.js.map