"use strict";exports.id=173,exports.ids=[173],exports.modules={3008:(e,t,a)=>{a.r(t),a.d(t,{TransactionPageComponent:()=>ke,default:()=>Fe});var s=a(6689),n=a.n(s),i=a(6695),o=a(6022),l=a(4661),r=a(9003),d=a.n(r),c=a(6639),m=a(6134),u=a(1233),g=a(1422),v=a(3665),p=a(3176),E=a(5161),h=a(7285),M=a(5863),N=a(6902),P=a(3093),b=a(9930),T=a(2745),I=a(7600),_=a(5470),w=a(8315),S=a(2411),D=a(1341);const y="DisputeModal_root__fYhdZ marketplaceModalBaseStyles",C="DisputeModal_modalContent__K900t",f="DisputeModal_modalIcon__3lXfI marketplaceModalIconStyles",k="DisputeModal_modalTitle__zcpYJ marketplaceModalTitleStyles",F="DisputeModal_modalMessage__LihTB marketplaceModalParagraphStyles",R="DisputeModal_formRoot__kyVhn",Z="DisputeModal_errorPlaceholder__tGpUX",B="DisputeModal_disputeMessage__hzvM5",H="DisputeModal_submitButton__U5hSU",O=e=>n().createElement(S.Form,Object.assign({},e,{render:e=>{const{className:t,rootClassName:a,disabled:s,handleSubmit:i,intl:o,formId:l,invalid:r,disputeSubmitted:c,disputeError:m,disputeInProgress:g}=e,v=m?n().createElement(u._H,{id:"DisputeModal.disputeSubmitFailed"}):null,p=d()(a||R,t),E=r||s||g||c;return n().createElement(b.l0,{className:p,onSubmit:i},n().createElement(b.gC,{className:B,type:"textarea",id:l?"".concat(l,".disputeReason"):"disputeReason",name:"disputeReason",label:o.formatMessage({id:"DisputeModal.label"}),placeholder:o.formatMessage({id:"DisputeModal.disputePlaceholder"}),validate:(0,D.C1)(o.formatMessage({id:"DisputeModal.disputeReasonRequired"}))}),n().createElement("p",{className:Z},v),n().createElement(b.KM,{className:H,type:"submit",inProgress:g,disabled:E,ready:c},o.formatMessage({id:"DisputeModal.submit"})))}})),L=e=>{const t=(0,c.mX)().marketplaceName;return n().createElement(n().Fragment,null,n().createElement("p",{className:k},n().createElement(u._H,{id:"DisputeModal.title"})),n().createElement("p",{className:F},n().createElement(u._H,{id:"DisputeModal.description",values:{marketplaceName:t}})),n().createElement(O,{onSubmit:e.onDisputeOrder,disputeSubmitted:e.disputeSubmitted,disputeInProgress:e.disputeInProgress,disputeError:e.disputeError,intl:e.intl}))},A=e=>n().createElement(n().Fragment,null,n().createElement("p",{className:k},n().createElement(u._H,{id:"DisputeModal.sentTitle"})),n().createElement("p",{className:F},n().createElement(u._H,{id:"DisputeModal.sentMessage"})),n().createElement("p",{className:F},n().createElement(u._H,{id:"DisputeModal.sentNextStep"}))),W=e=>{const{className:t,rootClassName:a,id:s,intl:i,isOpen:o,onCloseModal:l,onManageDisableScrolling:r,onDisputeOrder:c,disputeSubmitted:m,disputeInProgress:u,disputeError:g}=e,v=d()(a||y,t);return n().createElement(b.u_,{id:s,containerClassName:v,contentClassName:C,isOpen:o,onClose:l,onManageDisableScrolling:r,usePortal:!0,closeButtonMessage:i.formatMessage({id:"DisputeModal.close"})},n().createElement(b.qm,{className:f}),m?n().createElement(A,null):n().createElement(L,{onDisputeOrder:c,disputeSubmitted:m,disputeInProgress:u,disputeError:g,intl:i}))};W.defaultProps={className:null,rootClassName:null,isOpen:!1,disputeSubmitted:!1,disputeInProgress:!1,disputeError:null};const U=(0,u.XN)(W);var q=a(580),x=a.n(q),V=a(9523);const X="ReviewModal_root__fIlBS marketplaceModalBaseStyles",Y="ReviewModal_modalContent__db5Iu",z="ReviewModal_modalIcon__mOvmv marketplaceModalIconStyles",G="ReviewModal_modalTitle__pDkDS marketplaceModalTitleStyles",J="ReviewModal_reviewee__4Vr8h",j="ReviewModal_modalMessage__outW6 marketplaceModalParagraphStyles",K=e=>{const{className:t,rootClassName:a,id:s,marketplaceName:i,intl:o,isOpen:l,onCloseModal:r,onManageDisableScrolling:c,onSubmitReview:m,revieweeName:g,reviewSent:v,sendReviewInProgress:p,sendReviewError:E}=e,h=d()(a||X,t),M=o.formatMessage({id:"ReviewModal.later"}),N=n().createElement("span",{className:J},g);return n().createElement(b.u_,{id:s,containerClassName:h,contentClassName:Y,isOpen:l,onClose:r,onManageDisableScrolling:c,usePortal:!0,closeButtonMessage:M},n().createElement(b.sX,{className:z}),n().createElement("p",{className:G},n().createElement(u._H,{id:"ReviewModal.title",values:{revieweeName:N}})),n().createElement("p",{className:j},n().createElement(u._H,{id:"ReviewModal.description",values:{marketplaceName:i}})),n().createElement(V.Z,{onSubmit:m,reviewSent:v,sendReviewInProgress:p,sendReviewError:E}))},{bool:Q,string:$}=x();K.defaultProps={className:null,rootClassName:null,reviewSent:!1,sendReviewInProgress:!1,sendReviewError:null};const ee=(0,u.XN)(K);var te=a(2887),ae=a(4941);var se=a(9654),ne=a(8413);const ie=e=>{const{className:t,rootClassName:a,orderBreakdown:s,processName:i}=e,o=d()(a||ne.Z.breakdownMaybe,t);return s?n().createElement("div",{className:o},n().createElement(b.H6,{as:"h3",className:ne.Z.orderBreakdownTitle},n().createElement(u._H,{id:"TransactionPanel.".concat(i,".orderBreakdownTitle")})),n().createElement("hr",{className:ne.Z.totalDivider}),s):null};var oe=a(5198);const le=e=>{const{showDetailCardHeadings:t,listingTitle:a,subTitle:s,showPrice:i,price:o,intl:l}=e;return t?n().createElement("div",{className:ne.Z.detailCardHeadings},n().createElement(b.H4,{as:"h2",className:ne.Z.detailCardTitle},a,i&&o?n().createElement(n().Fragment,null,n().createElement("br",null),n().createElement("span",{className:ne.Z.inquiryPrice},(0,oe.lb)(l,o))):null),s?n().createElement("p",{className:ne.Z.detailCardSubtitle},s):null):null},re=e=>{var t;const{className:a,rootClassName:s,avatarWrapperClassName:i,listingTitle:o,image:l,provider:r,isCustomer:c,listingImageConfig:m}=e,u=d()(s||ne.Z.detailCardImageWrapper,a),{aspectWidth:g=1,aspectHeight:v=1,variantPrefix:p="listing-card"}=m,E=l?Object.keys(null===l||void 0===l||null===(t=l.attributes)||void 0===t?void 0:t.variants).filter((e=>e.startsWith(p))):[];return n().createElement(n().Fragment,null,n().createElement(b.Zz,{width:g,height:v,className:u},n().createElement(b.t3,{rootClassName:ne.Z.rootForImage,alt:o,image:l,variants:E})),c?n().createElement("div",{className:i||ne.Z.avatarWrapper},n().createElement(b.Jh,{user:r})):null)};var de=a(775);const ce=e=>{const{className:t,rootClassName:a,linkRootClassName:s,location:i,geolocation:o,showAddress:l}=e,{address:r,building:c}=i||{},{lat:m,lng:g}=o||{},v=o?"https://maps.google.com/?q=".concat(m,",").concat(g):r?"https://maps.google.com/?q=".concat(encodeURIComponent(r)):null,p="string"===typeof c&&c.length>0?"".concat(c,", ").concat(r):r,E=d()(a||ne.Z.address,t);return l&&v?n().createElement("p",{className:E},p," ",n().createElement("br",null),n().createElement("span",{className:ne.Z.viewOnGoogleMapsWrapper},n().createElement(b.dL,{className:s,href:v},n().createElement(u._H,{id:"AddressLinkMaybe.viewOnGoogleMaps"})))):null},me=e=>{const{className:t,rootClassName:a,protectedData:s,listing:i,locale:o}=e,l=d()(a||ne.Z.deliveryInfoContainer,t),r=null===s||void 0===s?void 0:s.deliveryMethod,c="shipping"===r;if("pickup"===r){var m,g,v;const e=(null===i||void 0===i||null===(m=i.attributes)||void 0===m||null===(g=m.publicData)||void 0===g?void 0:g.location)||{};return n().createElement("div",{className:l},n().createElement(b.X6,{as:"h3",rootClassName:ne.Z.sectionHeading},n().createElement(u._H,{id:"TransactionPanel.pickupInfoHeading"})),n().createElement("div",{className:ne.Z.pickupInfoContent},n().createElement(ce,{linkRootClassName:ne.Z.pickupAddress,location:e,geolocation:null===i||void 0===i||null===(v=i.attributes)||void 0===v?void 0:v.geolocation,showAddress:!0})))}if(c){const{name:e,phoneNumber:t,address:a}=(null===s||void 0===s?void 0:s.shippingDetails)||{},{line1:i,line2:r,city:d,postalCode:c,state:m,country:g}=a||{},v=t?n().createElement(n().Fragment,null,t,n().createElement("br",null)):null,p=(0,de.Z)(o).find((e=>e.code===g)),E=null===p||void 0===p?void 0:p.name;return n().createElement("div",{className:l},n().createElement(b.X6,{as:"h3",rootClassName:ne.Z.sectionHeading},n().createElement(u._H,{id:"TransactionPanel.shippingInfoHeading"})),n().createElement("div",{className:ne.Z.shippingInfoContent},e,n().createElement("br",null),v,i,r?", ".concat(r):"",n().createElement("br",null),c,", ",d,n().createElement("br",null),m?"".concat(m,", "):"",E,n().createElement("br",null)))}return null},ue=e=>{const{className:t,rootClassName:a,listing:s,showBookingLocation:i}=e,o=d()(a||ne.Z.bookingLocationContainer,t);if(i){var l,r,c;const e=(null===s||void 0===s||null===(l=s.attributes)||void 0===l||null===(r=l.publicData)||void 0===r?void 0:r.location)||{};return n().createElement("div",{className:o},n().createElement(b.X6,{as:"h3",rootClassName:ne.Z.sectionHeading},n().createElement(u._H,{id:"TransactionPanel.bookingLocationHeading"})),n().createElement("div",{className:ne.Z.bookingLocationContent},n().createElement(ce,{linkRootClassName:ne.Z.bookingLocationAddress,location:e,geolocation:null===s||void 0===s||null===(c=s.attributes)||void 0===c?void 0:c.geolocation,showAddress:!0})))}return null},ge=e=>{const{className:t,rootClassName:a,protectedData:s,showInquiryMessage:i,isCustomer:o}=e,l=d()(a||ne.Z.deliveryInfoContainer,t),r=o?ne.Z.ownInquiryMessage:ne.Z.inquiryMessage;return i?n().createElement("div",{className:l},n().createElement(b.X6,{as:"h3",rootClassName:ne.Z.sectionHeading},n().createElement(u._H,{id:"TransactionPanel.inquiryMessageHeading"})),n().createElement("p",{className:r},null===s||void 0===s?void 0:s.inquiryMessage)):null},ve=e=>{const{className:t,rootClassName:a,activityFeed:s,hasTransitions:i,fetchMessagesError:o,initialMessageFailed:l,hasMessages:r,isConversation:c}=e,m=r||i||l||o,g=d()(a||ne.Z.feedContainer,t);return m?n().createElement("div",{className:g},n().createElement(b.X6,{as:"h3",rootClassName:ne.Z.sectionHeading},c?n().createElement(u._H,{id:"TransactionPanel.conversationHeading"}):n().createElement(u._H,{id:"TransactionPanel.activityHeading"})),l?n().createElement("p",{className:ne.Z.messageError},n().createElement(u._H,{id:"TransactionPanel.initialMessageFailed"})):null,o?n().createElement("p",{className:ne.Z.messageError},n().createElement(u._H,{id:"TransactionPanel.messageLoadingFailed"})):null,n().createElement("div",{className:ne.Z.feedContent},s)):null},pe=e=>{const{className:t,rootClassName:a,showButtons:s,primaryButtonProps:i,secondaryButtonProps:o,isListingDeleted:l,isProvider:r}=e;if(l&&r)return null;const c=(null===i||void 0===i?void 0:i.inProgress)||(null===o||void 0===o?void 0:o.inProgress),m=i?n().createElement(b.KM,{inProgress:i.inProgress,disabled:c,onClick:i.onAction},i.buttonText):null,u=null!==i&&void 0!==i&&i.error?n().createElement("p",{className:ne.Z.actionError},null===i||void 0===i?void 0:i.errorText):null,g=o?n().createElement(b.kq,{inProgress:null===o||void 0===o?void 0:o.inProgress,disabled:c,onClick:o.onAction},o.buttonText):null,v=null!==o&&void 0!==o&&o.error?n().createElement("p",{className:ne.Z.actionError},null===o||void 0===o?void 0:o.errorText):null,p=d()(a||ne.Z.actionButtons,t);return s?n().createElement("div",{className:p},n().createElement("div",{className:ne.Z.actionErrors},u,v),n().createElement("div",{className:ne.Z.actionButtonWrapper},g,m)):null},Ee=e=>{const{className:t,rootClassName:a,showDispute:s,onOpenDisputeModal:i}=e,o=i?n().createElement(b.T5,{className:ne.Z.diminishedActionButton,onClick:i},n().createElement(u._H,{id:"TransactionPanel.disputeOrder"})):null,l=d()(a||ne.Z.diminishedActionButtonRoot,t);return s?n().createElement("div",{className:l},o):null};var he=a(5746);class Me extends s.Component{constructor(e){super(e),this.state={sendMessageFormFocused:!1},this.isMobSaf=!1,this.sendMessageFormName="TransactionPanel.SendMessageForm",this.onSendMessageFormFocus=this.onSendMessageFormFocus.bind(this),this.onSendMessageFormBlur=this.onSendMessageFormBlur.bind(this),this.onMessageSubmit=this.onMessageSubmit.bind(this),this.scrollToMessage=this.scrollToMessage.bind(this)}componentDidMount(){this.isMobSaf=(()=>{if(!window)return!1;const e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),a=!!e.match(/WebKit/i);return t&&a})()}onSendMessageFormFocus(){this.setState({sendMessageFormFocused:!0}),this.isMobSaf&&window.scroll({top:document.body.scrollHeight,left:0,behavior:"smooth"})}onSendMessageFormBlur(){this.setState({sendMessageFormFocused:!1})}onMessageSubmit(e,t){const a=e.message?e.message.trim():null,{transactionId:s,onSendMessage:n,config:i}=this.props;a&&n(s,a,i).then((e=>{t.reset(),this.scrollToMessage(e)})).catch((e=>{}))}scrollToMessage(e){const t="#msg-".concat(e.uuid),a=document.querySelector(t);a&&a.scrollIntoView({block:"start",behavior:"smooth"})}render(){var e,t,a,s,i,o,l,r,c,m,g,v,p;const{rootClassName:h,className:M,currentUser:N,transactionRole:P,listing:T,customer:I,provider:_,hasTransitions:w,protectedData:S,messages:D,initialMessageFailed:y,savePaymentMethodFailed:C,fetchMessagesError:f,sendMessageInProgress:k,sendMessageError:F,onOpenDisputeModal:R,intl:Z,stateData:B,showBookingLocation:H,activityFeed:O,isInquiryProcess:L,orderBreakdown:A,orderPanel:W,config:U}=this.props,q="customer"===P,x="provider"===P,V=!(null===T||void 0===T||null===(e=T.attributes)||void 0===e||!e.deleted),X=!(null===I||void 0===I||null===(t=I.attributes)||void 0===t||!t.banned),Y=!(null===I||void 0===I||null===(a=I.attributes)||void 0===a||!a.deleted),z=!(null===_||void 0===_||null===(s=_.attributes)||void 0===s||!s.banned),G=!(null===_||void 0===_||null===(i=_.attributes)||void 0===i||!i.deleted),{authorDisplayName:J,customerDisplayName:j,otherUserDisplayNameString:K}=((e,t,a,s)=>{var i,o;const l=n().createElement(b.GI,{user:t,intl:s}),r=n().createElement(b.GI,{user:a,intl:s});let d="",c="";const m=e.id&&(null===a||void 0===a?void 0:a.id)&&e.id.uuid===(null===a||void 0===a||null===(i=a.id)||void 0===i?void 0:i.uuid),u=e.id&&(null===t||void 0===t?void 0:t.id)&&e.id.uuid===(null===t||void 0===t||null===(o=t.id)||void 0===o?void 0:o.uuid);return m?(d=l,c=(0,ae.d8)(t,"")):u&&(d=r,c=(0,ae.d8)(a,"")),{authorDisplayName:l,customerDisplayName:r,otherUserDisplayName:d,otherUserDisplayNameString:c}})(N,_,I,Z),Q=Z.formatMessage({id:"TransactionPanel.deletedListingTitle"}),$=V?Q:null===T||void 0===T||null===(o=T.attributes)||void 0===o?void 0:o.title,ee=(null===T||void 0===T||null===(l=T.images)||void 0===l?void 0:l.length)>0?null===T||void 0===T?void 0:T.images[0]:null,oe=n().createElement(pe,{showButtons:B.showActionButtons,primaryButtonProps:null===B||void 0===B?void 0:B.primaryButtonProps,secondaryButtonProps:null===B||void 0===B?void 0:B.secondaryButtonProps,isListingDeleted:V,isProvider:x}),de=null===T||void 0===T||null===(r=T.attributes)||void 0===r||null===(c=r.publicData)||void 0===c?void 0:c.listingType,ce=U.listing.listingTypes.find((e=>e.listingType===de)),Me=L&&(0,te.ED)(ce),Ne=!X&&!Y&&!z&&!G,Pe=(null===S||void 0===S?void 0:S.deliveryMethod)||"none",be=d()(h||ne.Z.root,M);return n().createElement("div",{className:be},n().createElement("div",{className:ne.Z.container},n().createElement("div",{className:ne.Z.txInfo},n().createElement(re,{rootClassName:ne.Z.imageWrapperMobile,avatarWrapperClassName:ne.Z.avatarWrapperMobile,listingTitle:$,image:ee,provider:_,isCustomer:q,listingImageConfig:U.layout.listingImage}),x?n().createElement("div",{className:ne.Z.avatarWrapperProviderDesktop},n().createElement(b.Vt,{user:I,className:ne.Z.avatarDesktop})):null,n().createElement(he.Z,{processName:B.processName,processState:B.processState,showExtraInfo:B.showExtraInfo,showPriceOnMobile:Me,price:null===T||void 0===T||null===(m=T.attributes)||void 0===m?void 0:m.price,intl:Z,deliveryMethod:Pe,isPendingPayment:!!B.isPendingPayment,transactionRole:P,providerName:J,customerName:j,isCustomerBanned:X,listingId:null===T||void 0===T||null===(g=T.id)||void 0===g?void 0:g.uuid,listingTitle:$,listingDeleted:V}),n().createElement(ge,{protectedData:S,showInquiryMessage:L,isCustomer:q}),L?null:n().createElement("div",{className:ne.Z.orderDetails},n().createElement("div",{className:ne.Z.orderDetailsMobileSection},n().createElement(ie,{orderBreakdown:A,processName:B.processName}),n().createElement(Ee,{showDispute:B.showDispute,onOpenDisputeModal:R})),C?n().createElement("p",{className:ne.Z.genericError},n().createElement(u._H,{id:"TransactionPanel.savePaymentMethodFailed",values:{paymentMethodsPageLink:n().createElement(b.RC,{name:"PaymentMethodsPage"},n().createElement(u._H,{id:"TransactionPanel.paymentMethodsPageLink"}))}})):null,n().createElement(me,{className:ne.Z.deliveryInfoSection,protectedData:S,listing:T,locale:U.localization.locale}),n().createElement(ue,{className:ne.Z.deliveryInfoSection,listing:T,showBookingLocation:H})),n().createElement(ve,{rootClassName:ne.Z.feedContainer,hasMessages:D.length>0,hasTransitions:w,fetchMessagesError:f,initialMessageFailed:y,activityFeed:O,isConversation:L}),Ne?n().createElement(se.Z,{formId:this.sendMessageFormName,rootClassName:ne.Z.sendMessageForm,messagePlaceholder:Z.formatMessage({id:"TransactionPanel.sendMessagePlaceholder"},{name:K}),inProgress:k,sendMessageError:F,onFocus:this.onSendMessageFormFocus,onBlur:this.onSendMessageFormBlur,onSubmit:this.onMessageSubmit}):n().createElement("div",{className:ne.Z.sendingMessageNotAllowed},n().createElement(u._H,{id:"TransactionPanel.sendingMessageNotAllowed"})),B.showActionButtons?n().createElement(n().Fragment,null,n().createElement("div",{className:ne.Z.mobileActionButtonSpacer}),n().createElement("div",{className:ne.Z.mobileActionButtons},oe)):null),n().createElement("div",{className:ne.Z.asideDesktop},n().createElement("div",{className:ne.Z.stickySection},n().createElement("div",{className:ne.Z.detailCard},n().createElement(re,{avatarWrapperClassName:ne.Z.avatarWrapperDesktop,listingTitle:$,image:ee,provider:_,isCustomer:q,listingImageConfig:U.layout.listingImage}),n().createElement(le,{showDetailCardHeadings:B.showDetailCardHeadings,listingTitle:V?$:n().createElement(b.RC,{name:"ListingPage",params:{id:null===(v=T.id)||void 0===v?void 0:v.uuid,slug:(0,E.qi)($)}},$),showPrice:Me,price:null===T||void 0===T||null===(p=T.attributes)||void 0===p?void 0:p.price,intl:Z}),B.showOrderPanel?W:null,n().createElement(ie,{className:ne.Z.breakdownContainer,orderBreakdown:A,processName:B.processName}),B.showActionButtons?n().createElement("div",{className:ne.Z.desktopActionButtons},oe):null),n().createElement(Ee,{showDispute:B.showDispute,onOpenDisputeModal:R})))))}}Me.defaultProps={rootClassName:null,className:null,currentUser:null,listing:null,customer:null,provider:null,hasTransitions:!1,fetchMessagesError:null,initialMessageFailed:!1,savePaymentMethodFailed:!1,sendMessageError:null,sendReviewError:null,stateData:{},activityFeed:null,showBookingLocation:!1,orderBreakdown:null,orderPanel:null};const Ne=(0,u.XN)(Me);var Pe=a(4594);const be="TransactionPage_root__pFunE",Te="TransactionPage_loading__wApW9",Ie="TransactionPage_error__z8nzA TransactionPage_loading__wApW9",_e="TransactionPage_tabContent__vhSQp",we="TransactionPage_tabContentVisible__UWgq+",Se="TransactionPage_breakdown__21PAc",De="TransactionPage_orderPanel__JuHgu",ye="TransactionPage_orderTitle__3FPJd",Ce="TransactionPage_orderPanelTitle__LWkWH",fe=(e,t,a,s)=>n=>{const{disputeReason:i}=n;a(e,t,i?{protectedData:{disputeReason:i}}:{}).then((e=>s(!0))).catch((e=>{}))},ke=e=>{var t,a,i,o,l,r,M,N,P,S,D,y,C,f,k,F,R,Z,B,H,O,L;const[A,W]=(0,s.useState)(!1),[q,x]=(0,s.useState)(!1),[V,X]=(0,s.useState)(!1),[Y,z]=(0,s.useState)(!1),G=(0,c.mX)(),J=(0,m.a5)(),{currentUser:j,initialMessageFailedToTransaction:K,savePaymentMethodFailed:Q,fetchMessagesError:$,fetchMessagesInProgress:te,totalMessagePages:ae,oldestMessagePageFetched:se,fetchTransactionError:ne,history:ie,intl:oe,messages:le,onManageDisableScrolling:re,onSendMessage:de,onSendReview:ce,onShowMoreMessages:me,params:ue,scrollingDisabled:ge,sendMessageError:ve,sendMessageInProgress:pe,sendReviewError:Ee,sendReviewInProgress:he,transaction:Me,transactionRole:Pe,transitionInProgress:ke,transitionError:Fe,onTransition:Re,monthlyTimeSlots:Ze,onFetchTimeSlots:Be,nextTransitions:He,callSetInitialValues:Oe,onInitializeCardPaymentData:Le,onFetchTransactionLineItems:Ae,lineItems:We,fetchLineItemsInProgress:Ue,fetchLineItemsError:qe}=e,{listing:xe,provider:Ve,customer:Xe,booking:Ye}=Me||{},ze=(null===Me||void 0===Me||null===(t=Me.attributes)||void 0===t?void 0:t.transitions)||[],Ge=Pe===h.Q,Je=Pe===h.AL,je=(0,h.b$)(null===Me||void 0===Me||null===(a=Me.attributes)||void 0===a?void 0:a.processName);let Ke=null;try{Ke=je?(0,h.Yt)(je):null}catch(It){}const Qe=(e,t)=>{const{setInitialValues:a}=(0,g.dI)("CheckoutPage",J);Oe(a,e),Le(),ie.push((0,g.EW)("CheckoutPage",J,{id:t.id.uuid,slug:(0,E.qi)(t.attributes.title)},{}))};if(null!==Me&&void 0!==Me&&Me.id&&($e=Me,Ke&&Ke.getState($e)===Ke.states.PENDING_PAYMENT)&&Je&&Me.attributes.lineItems){Qe({listing:xe,transaction:Me,orderData:{}},xe)}var $e;const et=()=>{X(!0)},tt=oe.formatMessage({id:"TransactionPage.deletedListing"}),at=null===xe||void 0===xe||null===(i=xe.attributes)||void 0===i?void 0:i.deleted,st=at?tt:null===xe||void 0===xe||null===(o=xe.attributes)||void 0===o?void 0:o.title,nt=Ke&&j&&(null===Me||void 0===Me?void 0:Me.id)&&(null===Me||void 0===Me||null===(l=Me.id)||void 0===l?void 0:l.uuid)===ue.id&&(null===Me||void 0===Me||null===(r=Me.attributes)||void 0===r?void 0:r.lineItems)&&Me.customer&&Me.provider&&!ne,it=nt&&Ge&&j.id.uuid===(null===Ve||void 0===Ve||null===(M=Ve.id)||void 0===M?void 0:M.uuid),ot=nt&&Je&&j.id.uuid===(null===Xe||void 0===Xe||null===(N=Xe.id)||void 0===N?void 0:N.uuid);if(nt&&Ge&&!it)return console.error("Tried to access a sale that was not owned by the current user"),n().createElement(b.d9,{name:"InboxPage",params:{tab:"sales"}});if(nt&&Je&&!ot)return console.error("Tried to access an order that was not owned by the current user"),n().createElement(b.d9,{name:"InboxPage",params:{tab:"orders"}});const lt=d()(_e,we),rt=Je?"TransactionPage.fetchOrderFailed":"TransactionPage.fetchSaleFailed",dt=Je?"TransactionPage.loadingOrderData":"TransactionPage.loadingSaleData",ct=ne?n().createElement("p",{className:Ie},n().createElement(u._H,{id:"".concat(rt)})):Me&&!Ke?n().createElement("div",{className:Ie},n().createElement(u._H,{id:"TransactionPage.unknownTransactionProcess"})):n().createElement("div",{className:Te},n().createElement(u._H,{id:"".concat(dt)}),n().createElement(b.vM,null)),mt=!(!K||K.uuid!==(null===Me||void 0===Me||null===(P=Me.id)||void 0===P?void 0:P.uuid)),ut=ot?n().createElement(b.GI,{user:Ve,intl:oe}):n().createElement(b.GI,{user:Xe,intl:oe}),gt=nt?(0,_.O)({transaction:Me,transactionRole:Pe,nextTransitions:He,transitionInProgress:ke,transitionError:Fe,sendReviewInProgress:he,sendReviewError:Ee,onTransition:Re,onOpenReviewModal:et,intl:oe},Ke):{},vt=(null===Me||void 0===Me||null===(S=Me.attributes)||void 0===S||null===(D=S.lineItems)||void 0===D?void 0:D.length)>0,pt=vt?null===(y=Me.attributes)||void 0===y||null===(C=y.lineItems)||void 0===C?void 0:C.find((e=>v.Y8.includes(e.code)&&!e.reversal)):null,Et=pt?pt.code:nt?((e,t)=>{var a,s,n,i;const o=null===e||void 0===e||null===(a=e.attributes)||void 0===a||null===(s=a.protectedData)||void 0===s?void 0:s.unitType,l=null===t||void 0===t||null===(n=t.attributes)||void 0===n||null===(i=n.publicData)||void 0===i?void 0:i.unitType;return"line-item/".concat(o||l)})(Me,xe):null,ht=null===xe||void 0===xe||null===(f=xe.attributes)||void 0===f||null===(k=f.availabilityPlan)||void 0===k?void 0:k.timezone,Mt=Et===v.PC?v.In:v.FJ,Nt=null!==Ye&&void 0!==Ye&&Ye.id?{booking:Ye,dateType:Mt,timeZone:ht}:{},Pt=vt?{orderBreakdown:n().createElement(b.J0,Object.assign({className:Se,userRole:Pe,transaction:Me},Nt,{currency:G.currency,marketplaceName:G.marketplaceName}))}:{},bt=(0,h.YL)(gt.processName)&&(null===(F=Ke)||void 0===F?void 0:F.hasPassedState(null===(R=Ke)||void 0===R||null===(Z=R.states)||void 0===Z?void 0:Z.ACCEPTED,Me)),Tt=nt?n().createElement(Ne,Object.assign({className:lt,currentUser:j,transactionId:null===Me||void 0===Me?void 0:Me.id,listing:xe,customer:Xe,provider:Ve,hasTransitions:ze.length>0,protectedData:null===Me||void 0===Me||null===(B=Me.attributes)||void 0===B?void 0:B.protectedData,messages:le,initialMessageFailed:mt,savePaymentMethodFailed:Q,fetchMessagesError:$,sendMessageInProgress:pe,sendMessageError:ve,onSendMessage:de,onOpenDisputeModal:()=>{W(!0)},stateData:gt,transactionRole:Pe,showBookingLocation:bt,activityFeed:n().createElement(w.Z,{messages:le,transaction:Me,stateData:gt,intl:oe,currentUser:j,hasOlderMessages:ae>se&&!te,onOpenReviewModal:et,onShowOlderMessages:()=>me(Me.id,G),fetchMessagesInProgress:te}),isInquiryProcess:je===h.N5,config:G},Pt,{orderPanel:n().createElement(b.el,{className:De,titleClassName:ye,listing:xe,isOwnListing:it,lineItemUnitType:Et,title:st,titleDesktop:n().createElement(b.H4,{as:"h2",className:Ce},at?st:n().createElement(b.RC,{name:"ListingPage",params:{id:null===(H=xe.id)||void 0===H?void 0:H.uuid,slug:(0,E.qi)(st)}},st)),author:Ve,onSubmit:e=>{const{bookingDates:t,bookingStartTime:a,bookingEndTime:s,quantity:n,deliveryMethod:i,...o}=e,l=t?{bookingDates:{bookingStart:t.startDate,bookingEnd:t.endDate}}:a&&s?{bookingDates:{bookingStart:(0,p.Ft)(a),bookingEnd:(0,p.Ft)(s)}}:{},r=Number.parseInt(n,10),d=Number.isInteger(r)?{quantity:r}:{},c={listing:xe,transaction:Me,orderData:{...l,...d,...i?{deliveryMethod:i}:{},...o},confirmPaymentError:null};Qe(c,xe)},onManageDisableScrolling:re,onFetchTimeSlots:Be,monthlyTimeSlots:Ze,onFetchTransactionLineItems:Ae,lineItems:We,fetchLineItemsInProgress:Ue,fetchLineItemsError:qe,validListingTypes:G.listing.listingTypes,marketplaceCurrency:G.currency,dayCountAvailableForBooking:G.stripe.dayCountAvailableForBooking,marketplaceName:G.marketplaceName})})):ct;return n().createElement(b.T3,{title:oe.formatMessage({id:"TransactionPage.schemaTitle"},{title:st}),scrollingDisabled:ge},n().createElement(b.ip,{topbar:n().createElement(T.Z,null),footer:n().createElement(I.Z,null)},n().createElement("div",{className:be},Tt),n().createElement(ee,{id:"ReviewOrderModal",isOpen:V,onCloseModal:()=>X(!1),onManageDisableScrolling:re,onSubmitReview:e=>{const{reviewRating:t,reviewContent:a}=e,s=Number.parseInt(t,10),{states:n,transitions:i}=Ke,o=Pe===h.AL?{reviewAsFirst:i.REVIEW_1_BY_CUSTOMER,reviewAsSecond:i.REVIEW_2_BY_CUSTOMER,hasOtherPartyReviewedFirst:Ke.getTransitionsToStates([n.REVIEWED_BY_PROVIDER]).includes(Me.attributes.lastTransition)}:{reviewAsFirst:i.REVIEW_1_BY_PROVIDER,reviewAsSecond:i.REVIEW_2_BY_PROVIDER,hasOtherPartyReviewedFirst:Ke.getTransitionsToStates([n.REVIEWED_BY_CUSTOMER]).includes(Me.attributes.lastTransition)};ce(Me,o,{reviewRating:s,reviewContent:a},G).then((e=>{X(!1),z(!0)})).catch((e=>{}))},revieweeName:ut,reviewSent:Y,sendReviewInProgress:he,sendReviewError:Ee,marketplaceName:G.marketplaceName}),null!==(O=Ke)&&void 0!==O&&null!==(L=O.transitions)&&void 0!==L&&L.DISPUTE?n().createElement(U,{id:"DisputeOrderModal",isOpen:A,onCloseModal:()=>W(!1),onManageDisableScrolling:re,onDisputeOrder:fe(null===Me||void 0===Me?void 0:Me.id,Ke.transitions.DISPUTE,Re,x),disputeSubmitted:q,disputeInProgress:ke===Ke.transitions.DISPUTE,disputeError:Fe}):null))};ke.defaultProps={currentUser:null,fetchTransactionError:null,transitionInProgress:null,transitionError:null,transaction:null,fetchMessagesError:null,initialMessageFailedToTransaction:null,savePaymentMethodFailed:!1,sendMessageError:null,monthlyTimeSlots:null,fetchTimeSlotsError:null,lineItems:null,fetchLineItemsError:null};const Fe=(0,i.compose)(l.withRouter,(0,o.connect)((e=>{const{fetchTransactionError:t,transitionInProgress:a,transitionError:s,transactionRef:n,fetchMessagesInProgress:i,fetchMessagesError:o,totalMessagePages:l,oldestMessagePageFetched:r,messages:d,initialMessageFailedToTransaction:c,savePaymentMethodFailed:m,sendMessageInProgress:u,sendMessageError:g,sendReviewInProgress:v,sendReviewError:p,monthlyTimeSlots:E,processTransitions:h,lineItems:P,fetchLineItemsInProgress:b,fetchLineItemsError:T}=e.TransactionPage,{currentUser:I}=e.user,_=(0,M.EV)(e,n?[n]:[]),w=_.length>0?_[0]:null;return{currentUser:I,fetchTransactionError:t,transitionInProgress:a,transitionError:s,scrollingDisabled:(0,N.uS)(e),transaction:w,fetchMessagesInProgress:i,fetchMessagesError:o,totalMessagePages:l,oldestMessagePageFetched:r,messages:d,initialMessageFailedToTransaction:c,savePaymentMethodFailed:m,sendMessageInProgress:u,sendMessageError:g,sendReviewInProgress:v,sendReviewError:p,monthlyTimeSlots:E,nextTransitions:h,lineItems:P,fetchLineItemsInProgress:b,fetchLineItemsError:T}}),(e=>({onTransition:(t,a,s)=>e((0,Pe.Vr)(t,a,s)),onShowMoreMessages:(t,a)=>e((0,Pe.EP)(t,a)),onSendMessage:(t,a,s)=>e((0,Pe.bG)(t,a,s)),onManageDisableScrolling:(t,a)=>e((0,N.R4)(t,a)),onSendReview:(t,a,s,n)=>e((0,Pe.se)(t,a,s,n)),callSetInitialValues:(t,a)=>e(t(a)),onInitializeCardPaymentData:()=>e((0,P.aw)()),onFetchTransactionLineItems:(t,a,s)=>e((0,Pe.An)(t,a,s)),onFetchTimeSlots:(t,a,s,n)=>e((0,Pe.HA)(t,a,s,n))}))),u.XN)(ke)}};
//# sourceMappingURL=TransactionPage.2f8fc762.chunk.js.map