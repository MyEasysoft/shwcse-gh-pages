"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[4697],{50973:(e,t,r)=>{r.r(t),r.d(t,{default:()=>I});var a=r(72791),n=r(42789),s=r(47375),o=r(80948),l=r(10314),i=(r(73665),r(12790)),m=r(43093),d=r(46902),c=r(81301),h=r(52745),u=r(67600),p=r(55269),y=r(41418),P=r.n(y),g=r(6639);const _={root:"PaymentMethodsForm_root__IjHRq",card:"PaymentMethodsForm_card__piZp1 marketplaceInputStyles",cardError:"PaymentMethodsForm_cardError__3uteV",error:"PaymentMethodsForm_error__L9do+",errorMessage:"PaymentMethodsForm_errorMessage__Zq0Am",paymentHeading:"PaymentMethodsForm_paymentHeading__P1KfT",messageHeading:"PaymentMethodsForm_messageHeading__3ZLXi",messageLabel:"PaymentMethodsForm_messageLabel__qIBFX",messageOptional:"PaymentMethodsForm_messageOptional__44RXZ",message:"PaymentMethodsForm_message__ok9Pb",submitContainer:"PaymentMethodsForm_submitContainer__9szIN",infoText:"PaymentMethodsForm_infoText__Wunwb h5",submitButton:"PaymentMethodsForm_submitButton__ltWAh",missingStripeKey:"PaymentMethodsForm_missingStripeKey__5o2CU",paymentAddressField:"PaymentMethodsForm_paymentAddressField__jgaak",formRow:"PaymentMethodsForm_formRow__TODWa",postalCode:"PaymentMethodsForm_postalCode__4wOQC",city:"PaymentMethodsForm_city__iz67K",field:"PaymentMethodsForm_field__lXCiE"},M=(e,t)=>{const{message:r,code:a,type:n}=t;if(!a||!n)return e.formatMessage({id:"PaymentMethodsForm.genericError"});const s="validation_error"===n?"PaymentMethodsForm.stripe.validation_error.".concat(a):"PaymentMethodsForm.stripe.".concat(n);return e.formatMessage({id:s,defaultMessage:r})},E={fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Inter"}]},b={base:{fontFamily:'-apple-system, BlinkMacSystemFont, "Inter var", Helvetica, Arial, sans-serif',fontSize:"undefined"!==typeof window&&window.innerWidth<768?"14px":"16px",fontSmoothing:"antialiased",lineHeight:"24px",letterSpacing:"-0.1px",color:"#4A4A4A","::placeholder":{color:"#B2B2B2"}}},f={error:null,cardValueValid:!1};class C extends a.Component{constructor(e){super(e),this.state=f,this.handleCardValueChange=this.handleCardValueChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.paymentForm=this.paymentForm.bind(this),this.finalFormAPI=null,this.stripe=null}componentDidMount(){var e,t;if(!window.Stripe)throw new Error("Stripe must be loaded for PaymentMethodsForm");const r=null===(e=this.props.config)||void 0===e||null===(t=e.stripe)||void 0===t?void 0:t.publishableKey;if(r){this.stripe=window.Stripe(r);const e=this.stripe.elements(E);this.card=e.create("card",{style:b}),this.card.mount(this.cardContainer),this.card.addEventListener("change",this.handleCardValueChange),window.addEventListener("resize",(()=>{window.innerWidth<768?this.card.update({style:{base:{fontSize:"14px",lineHeight:"24px"}}}):this.card.update({style:{base:{fontSize:"18px",lineHeight:"24px"}}})}))}}componentWillUnmount(){this.card&&(this.card.removeEventListener("change",this.handleCardValueChange),this.card.unmount())}handleCardValueChange(e){const{intl:t}=this.props,{error:r,complete:a}=e,n=e.value.postalCode;this.finalFormAPI&&this.finalFormAPI.change("postal",n),this.setState((e=>({error:r?M(t,r):null,cardValueValid:a})))}handleSubmit(e){const{onSubmit:t,inProgress:r,formId:a}=this.props,n=!this.state.cardValueValid;if(r||n)return;t({stripe:this.stripe,card:this.card,formId:a,formValues:e})}paymentForm(e){const{className:t,rootClassName:r,inProgress:n,formId:s,intl:l,invalid:i,handleSubmit:m,addPaymentMethodError:d,deletePaymentMethodError:h,createStripeCustomerError:u,handleCardSetupError:p,form:y,config:g}=e;this.finalFormAPI=y;const M=!this.state.cardValueValid,E=i||M||n,b=this.state.error&&!n,f=P()(r||_.root,t),C=P()(_.card,{[_.cardSuccess]:this.state.cardValueValid,[_.cardError]:b}),S=d||h||u||p,F=l.formatMessage({id:"PaymentMethodsForm.genericError"}),N=l.formatMessage({id:"PaymentMethodsForm.billingDetailsNameLabel"}),v=l.formatMessage({id:"PaymentMethodsForm.billingDetailsNamePlaceholder"}),I=l.formatMessage({id:"PaymentMethodsForm.infoText"},{marketplaceName:g.marketplaceName}),D=a.createElement(c.hy,{intl:l,form:y,fieldId:s,card:this.card,locale:g.localization.locale});return g.stripe.publishableKey?a.createElement(c.l0,{className:f,onSubmit:m},a.createElement("label",{className:_.paymentLabel,htmlFor:"".concat(s,"-card")},a.createElement(o._H,{id:"PaymentMethodsForm.paymentCardDetails"})),a.createElement("div",{className:C,id:"".concat(s,"-card"),ref:e=>{this.cardContainer=e}}),a.createElement("div",{className:_.infoText},I),b?a.createElement("span",{className:_.error},this.state.error):null,a.createElement("div",{className:_.paymentAddressField},a.createElement(c.H4,{as:"h3"},a.createElement(o._H,{id:"PaymentMethodsForm.billingDetails"})),a.createElement(c.gC,{className:_.field,type:"text",id:"name",name:"name",autoComplete:"cc-name",label:N,placeholder:v}),D),a.createElement("div",{className:_.submitContainer},S?a.createElement("span",{className:_.errorMessage},S.message?S.message:F):null,a.createElement(c.KM,{className:_.submitButton,type:"submit",inProgress:n,disabled:E},a.createElement(o._H,{id:"PaymentMethodsForm.submitPaymentInfo"})))):a.createElement("div",{className:_.missingStripeKey},a.createElement(o._H,{id:"PaymentMethodsForm.missingStripeKey"}))}render(){const{onSubmit:e,...t}=this.props;return a.createElement(p.l0,Object.assign({onSubmit:this.handleSubmit},t,{render:this.paymentForm}))}}C.defaultProps={className:null,rootClassName:null,inProgress:!1,onSubmit:null,addPaymentMethodError:null,deletePaymentMethodError:null,createStripeCustomerError:null,handleCardSetupError:null,form:null};const S=e=>{const t=(0,g.mX)(),r=(0,o.YB)();return a.createElement(C,Object.assign({config:t,intl:r},e))};var F=r(51465);const N={content:"PaymentMethodsPage_content__3X1Dt",desktopTopbar:"PaymentMethodsPage_desktopTopbar__W5r3o",mobileTopbar:"PaymentMethodsPage_mobileTopbar__9YjSm"},v=e=>{const[t,r]=(0,a.useState)(!1),[n,s]=(0,a.useState)(null),{currentUser:i,addPaymentMethodError:m,deletePaymentMethodError:d,createStripeCustomerError:p,handleCardSetupError:y,deletePaymentMethodInProgress:P,onCreateSetupIntent:g,onHandleCardSetup:_,onSavePaymentMethod:M,onDeletePaymentMethod:E,fetchStripeCustomer:b,scrollingDisabled:f,onManageDisableScrolling:C,intl:F,stripeCustomerFetched:v}=e,I=e=>e&&e.attributes?e.attributes.clientSecret:null,D=(e,t)=>{const{name:r,addressLine1:a,addressLine2:n,postal:s,state:o,city:i,country:m}=t,d=a&&s?{address:{city:i,country:m,line1:a,line2:n,postal_code:s,state:o}}:{};return{payment_method_data:{billing_details:{name:r,email:(0,l.j0)(e).attributes.email,...d}}}},A=()=>{E().then((()=>{b()}))},H=F.formatMessage({id:"PaymentMethodsPage.title"}),w=(0,l.j0)(i),V=!!w.id,L=i&&(0,l.Cy)(i.stripeCustomer).attributes.stripeCustomerId&&(0,l.S2)(i.stripeCustomer.defaultPaymentMethod).id,x={name:V?"".concat(w.attributes.profile.firstName," ").concat(w.attributes.profile.lastName):null},T=L?(0,l.S2)(i.stripeCustomer.defaultPaymentMethod).attributes.card:null,B="replaceCard"===n||!L,K=!!L;return a.createElement(c.T3,{title:H,scrollingDisabled:f},a.createElement(c.i_,{topbar:a.createElement(a.Fragment,null,a.createElement(h.Z,{currentPage:"PaymentMethodsPage",desktopClassName:N.desktopTopbar,mobileClassName:N.mobileTopbar}),a.createElement(c.Tb,{currentPage:"PaymentMethodsPage"})),sideNav:null,useAccountSettingsNav:!0,currentPage:"PaymentMethodsPage",footer:a.createElement(u.Z,null)},a.createElement("div",{className:N.content},a.createElement(c.H3,{as:"h1"},a.createElement(o._H,{id:"PaymentMethodsPage.heading"})),v?a.createElement(a.Fragment,null,K?a.createElement(c.Me,{card:T,onManageDisableScrolling:C,onChange:s,onDeleteCard:A,deletePaymentMethodInProgress:P}):null,B?a.createElement(S,{className:N.paymentForm,formId:"PaymentMethodsForm",initialValues:x,onSubmit:e=>{r(!0);const t=(0,l.j0)(i).stripeCustomer,{stripe:a,card:n,formValues:o}=e;g().then((e=>{const t={stripe:a,card:n,setupIntentClientSecret:I(e),paymentParams:D(i,o)};return _(t)})).then((e=>{const r=e.setupIntent.payment_method;return M(t,r)})).then((()=>{b(),r(!1),s("default")})).catch((e=>{console.error(e),r(!1)}))},handleRemovePaymentMethod:A,hasDefaultPaymentMethod:L,addPaymentMethodError:m,deletePaymentMethodError:d,createStripeCustomerError:p,handleCardSetupError:y,inProgress:t}):null):null)))};v.defaultProps={currentUser:null,addPaymentMethodError:null,deletePaymentMethodError:null,createStripeCustomerError:null,handleCardSetupError:null};const I=(0,n.qC)((0,s.$j)((e=>{const{currentUser:t}=e.user,{deletePaymentMethodInProgress:r,addPaymentMethodError:a,deletePaymentMethodError:n,createStripeCustomerError:s}=e.paymentMethods,{stripeCustomerFetched:o}=e.PaymentMethodsPage,{handleCardSetupError:l}=e.stripe;return{currentUser:t,scrollingDisabled:(0,d.uS)(e),deletePaymentMethodInProgress:r,addPaymentMethodError:a,deletePaymentMethodError:n,createStripeCustomerError:s,handleCardSetupError:l,stripeCustomerFetched:o}}),(e=>({onManageDisableScrolling:(t,r)=>e((0,d.R4)(t,r)),fetchStripeCustomer:()=>e((0,F.sz)()),onHandleCardSetup:t=>e((0,m.c8)(t)),onCreateSetupIntent:t=>e((0,F.zw)(t)),onSavePaymentMethod:(t,r)=>e((0,i.BX)(t,r)),onDeletePaymentMethod:t=>e((0,i.gp)(t))}))),o.XN)(v)}}]);
//# sourceMappingURL=PaymentMethodsPage.ced90ce7.chunk.js.map