"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[1352],{75846:(e,t,a)=>{a.r(t),a.d(t,{default:()=>me});var i=a(72791),n=a(42789),r=a(47375),o=a(58272),s=a(93539),l=a(6639),c=a(86134),d=a(10314),u=a(7285),m=a(46902),g=a(43093),p=a(12790),v=a(81301),h=a(25080),y=a.n(h),E=a(55950),P=a(53176),C=a(66319);const{UUID:_,Money:b}=C.types,f=(e,t)=>y()(Object.entries(t),((t,a)=>{let[i,n]=a;return!(!Object.prototype.hasOwnProperty.call(e,i)||!n(e[i]))&&t}),!0),k=(e,t,a,i)=>{if(window&&window.sessionStorage&&t&&e){const n={orderData:e,listing:t,transaction:a,storedAt:new Date},r=function(e,t){return this[e]instanceof Date?{date:t,_serializedType:"SerializableDate"}:this[e]instanceof E.Z?{decimal:t,_serializedType:"SerializableDecimal"}:C.types.replacer(e,t)},o=JSON.stringify(n,r);window.sessionStorage.setItem(i,o)}},I=e=>{if(window&&window.sessionStorage){const t=window.sessionStorage.getItem(e),a=(e,t)=>t&&"object"===typeof t&&"SerializableDate"===t._serializedType?new Date(t.date):t&&"object"===typeof t&&"SerializableDecimal"===t._serializedType?new E.Z(t.decimal):C.types.reviver(e,t),{orderData:i,listing:n,transaction:r,storedAt:o}=t?JSON.parse(t,a):{},s=null===i||void 0===i?void 0:i.bookingDates,l=!s||(e=>f(e,{bookingStart:e=>e instanceof Date,bookingEnd:e=>e instanceof Date}))(s),c=!!o&&(0,P.fT)(o,(0,P.U2)(new Date,1,"days")),d=!r||(e=>{let t=null;try{var a;const i=null===e||void 0===e||null===(a=e.attributes)||void 0===a?void 0:a.processName;t=(0,u.Yt)(i)}catch(i){return console.error("Transaction, found from sessionStorage, was following unsupported transaction process."),!1}return f(e,{id:e=>e instanceof _,type:e=>"transaction"===e,attributes:e=>"object"===typeof e&&Object.values(t.transitions).includes(e.lastTransition)})})(r),m=c&&l&&(e=>f(e,{id:e=>e instanceof _,attributes:e=>"object"===typeof e&&e.price instanceof b}))(n)&&d;if(m)return{orderData:i,listing:n,transaction:r}}return{}};var N=a(91949),D=a(41418),T=a.n(D),M=a(80948);const S={topbar:"CheckoutPage_topbar__k07kt",contentContainer:"CheckoutPage_contentContainer__vNONJ",orderFormContainer:"CheckoutPage_orderFormContainer__0JA45",listingImageMobile:"CheckoutPage_listingImageMobile__rIpgh",rootForImage:"CheckoutPage_rootForImage__Z4MDV",avatarWrapper:"CheckoutPage_avatarWrapper__6JZzu",avatarMobile:"CheckoutPage_avatarMobile__fWjDI",headingContainer:"CheckoutPage_headingContainer__nk7ok",heading:"CheckoutPage_heading__86Q2N",listingDetailsWrapper:"CheckoutPage_listingDetailsWrapper__H8Ooc",detailsHeadingMobile:"CheckoutPage_detailsHeadingMobile__t-UMX",author:"CheckoutPage_author__cTV2f h4",priceBreakdownContainer:"CheckoutPage_priceBreakdownContainer__KqI59",priceBreakdownTitle:"CheckoutPage_priceBreakdownTitle__da8I9",paymentContainer:"CheckoutPage_paymentContainer__cV4tO",orderError:"CheckoutPage_orderError__aJIyS",notFoundError:"CheckoutPage_notFoundError__p2Npf",speculateError:"CheckoutPage_speculateError__ZTokl",paymentForm:"CheckoutPage_paymentForm__vuiwL",detailsContainerDesktop:"CheckoutPage_detailsContainerDesktop__w4SVt",detailsAspectWrapper:"CheckoutPage_detailsAspectWrapper__FjTNJ",detailsHeadings:"CheckoutPage_detailsHeadings__HBcW9",detailsSubtitle:"CheckoutPage_detailsSubtitle__BWgQj h5",orderBreakdownHeader:"CheckoutPage_orderBreakdownHeader__6zbvg",orderBreakdownTitle:"CheckoutPage_orderBreakdownTitle__etMpy",totalDivider:"CheckoutPage_totalDivider__zfy1R",orderBreakdown:"CheckoutPage_orderBreakdown__KkPra",section:"CheckoutPage_section__AyQhE",sectionHeading:"CheckoutPage_sectionHeading__6Sxh3 p",field:"CheckoutPage_field__qx3Wj",fieldInquiryMessage:"CheckoutPage_fieldInquiryMessage__F5tIh",error:"CheckoutPage_error__0BAAg",priceContainer:"CheckoutPage_priceContainer__YuyOj",price:"CheckoutPage_price__boBWI p",perUnit:"CheckoutPage_perUnit__Zs86f p",inquiryPrice:"CheckoutPage_inquiryPrice__yramS p"},w=e=>{const[t,a]=(0,i.useState)(!1);(0,i.useEffect)((()=>{const e=window.matchMedia("(max-width: 767px)");function t(e){a(e.matches)}return a(e.matches),e.addEventListener("change",t),function(){e.removeEventListener("change",t)}}));const{className:n,rootClassName:r,intl:o}=e,s=T()(r||S.topbar,n);return i.createElement("div",{className:s},i.createElement(v.Ux,{layout:t?"mobile":"desktop",alt:o.formatMessage({id:"CheckoutPage.goToLandingPage"})}))};w.defaultProps={className:null,rootClassName:null};const A=w;var H=a(53002),O=a(73665),F=a(21102),L=a(35074),q=a(79908);const U=(e,t,a)=>{const i=a.listing.listingTypes.find((t=>t.listingType===e)),{process:n,alias:r,unitType:o,...s}=(null===i||void 0===i?void 0:i.transactionType)||{};return t?{unitType:t,...s}:{}},W=(e,t)=>{var a;const{name:i,addressLine1:n,addressLine2:r,postal:o,city:s,state:l,country:c}=e,d=n&&o?{address:{city:s,country:c,line1:n,line2:r,postal_code:o,state:l}}:{};return{name:i,email:null===t||void 0===t||null===(a=t.attributes)||void 0===a?void 0:a.email,...d}},R=(e,t)=>{var a,i,n,r;return!!(e&&null!==t&&void 0!==t&&null!==(a=t.stripeCustomer)&&void 0!==a&&null!==(i=a.attributes)&&void 0!==i&&i.stripeCustomerId&&null!==t&&void 0!==t&&null!==(n=t.stripeCustomer)&&void 0!==n&&null!==(r=n.defaultPaymentMethod)&&void 0!==r&&r.id)},B=(e,t)=>{const a=t.getState(e);return a===t.states.PAYMENT_EXPIRED||a===t.states.PENDING_PAYMENT&&(0,P.wB)(e.attributes.lastTransitionedAt,new Date)>=15},z=(e,t)=>t.hasPassedState(t.states.PENDING_PAYMENT,e),Y=(e,t,a,i,n)=>{if(null!==e&&void 0!==e&&e.id){const{orderData:r,listing:o}=t;a(r,o,e,n),i({...t,transaction:e})}};var j=a(11760);const Q=e=>{var t,a;const{listing:n,listingTitle:r,author:o,firstImage:s,layoutListingImageConfig:l,speculateTransactionErrorMessage:c,showPrice:d,processName:u,breakdown:m,intl:g}=e,{price:p,publicData:h}=(null===n||void 0===n?void 0:n.attributes)||{},y=h.unitType||"unknown",{aspectWidth:E=1,aspectHeight:P=1,variantPrefix:C="listing-card"}=l||{},_=s?Object.keys(null===s||void 0===s||null===(t=s.attributes)||void 0===t?void 0:t.variants).filter((e=>e.startsWith(C))):[];return i.createElement("div",{className:S.detailsContainerDesktop},i.createElement(v.Zz,{width:E,height:P,className:S.detailsAspectWrapper},i.createElement(v.t3,{rootClassName:S.rootForImage,alt:r,image:s,variants:_})),i.createElement("div",{className:S.listingDetailsWrapper},i.createElement("div",{className:S.avatarWrapper},i.createElement(v.Jh,{user:o,disableProfileLink:!0})),i.createElement("div",{className:S.detailsHeadings},i.createElement(v.H4,{as:"h2"},i.createElement(v.RC,{name:"ListingPage",params:{id:null===n||void 0===n||null===(a=n.id)||void 0===a?void 0:a.uuid,slug:(0,F.qi)(r)}},r)),d?i.createElement("div",{className:S.priceContainer},i.createElement("p",{className:S.price},(0,q.lb)(g,p)),i.createElement("div",{className:S.perUnit},i.createElement(M._H,{id:"CheckoutPageWithInquiryProcess.perUnit",values:{unitType:y}}))):null),c),m?i.createElement("div",{className:S.orderBreakdownHeader},i.createElement(v.H6,{as:"h3",className:S.orderBreakdownTitle},i.createElement(M._H,{id:"CheckoutPage.".concat(u,".orderBreakdown")})),i.createElement("hr",{className:S.totalDivider})):null,m)};Q.defaultProps={speculateTransactionErrorMessage:null,breakdown:null};const x=Q,Z=e=>{var t;const{listingTitle:a,author:n,firstImage:r,layoutListingImageConfig:o}=e,{aspectWidth:s=1,aspectHeight:l=1,variantPrefix:c="listing-card"}=o||{},d=r?Object.keys(null===r||void 0===r||null===(t=r.attributes)||void 0===t?void 0:t.variants).filter((e=>e.startsWith(c))):[];return i.createElement(i.Fragment,null,i.createElement(v.Zz,{width:s,height:l,className:S.listingImageMobile},i.createElement(v.t3,{rootClassName:S.rootForImage,alt:a,image:r,variants:d})),i.createElement("div",{className:T()(S.avatarWrapper,S.avatarMobile)},i.createElement(v.Jh,{user:n,disableProfileLink:!0})))},J=e=>{const{breakdown:t,speculateTransactionErrorMessage:a}=e;return i.createElement("div",{className:S.priceBreakdownContainer},a,t)},K=["processing","requires_capture","succeeded"],V="PAY_AND_SAVE_FOR_LATER_USE",G="USE_SAVED_CARD",X=(e,t,a,i)=>{var n,r,o,s,l,c;const d=null===(n=e.orderData)||void 0===n?void 0:n.quantity,u=d?{quantity:d}:{},m=null===(r=e.orderData)||void 0===r?void 0:r.deliveryMethod,g=m?{deliveryMethod:m}:{},{listingType:p,unitType:v}=(null===e||void 0===e||null===(o=e.listing)||void 0===o||null===(s=o.attributes)||void 0===s?void 0:s.publicData)||{},h={protectedData:{...U(p,v,i),...g,...t}};var y;return{listingId:null===e||void 0===e||null===(l=e.listing)||void 0===l?void 0:l.id,...g,...u,...(y=null===(c=e.orderData)||void 0===c?void 0:c.bookingDates,y?{bookingDates:y}:{}),...h,...a}},$=e=>{let{pageData:t,fetchSpeculatedTransaction:a,fetchStripeCustomer:i,config:n}=e;i();((e,t,a)=>{var i,n,r,o,s;const l=t?t.transaction:null,c=t.listing,d=(null===l||void 0===l||null===(i=l.attributes)||void 0===i?void 0:i.processName)||(null===c||void 0===c||null===(n=c.attributes)||void 0===n||null===(r=n.publicData)||void 0===r||null===(o=r.transactionProcessAlias)||void 0===o?void 0:o.split("/")[0]),m=d?(0,u.Yt)(d):null;if(null!==t&&void 0!==t&&null!==(s=t.listing)&&void 0!==s&&s.id&&t.orderData&&m&&!z(l,m)){var g,p;const i=null===(g=t.listing.attributes.publicData)||void 0===g?void 0:g.transactionProcessAlias,n=l?l.id:null,r=(null===l||void 0===l||null===(p=l.attributes)||void 0===p?void 0:p.lastTransition)===m.transitions.INQUIRE?m.transitions.REQUEST_PAYMENT_AFTER_INQUIRY:m.transitions.REQUEST_PAYMENT;a(e,i,n,r,m.isPrivileged(r))}})(X(t,{},{},n),t,a)},ee=(e,t,a,i,n,r)=>{var o,s,l;if(n)return;r(!0);const{history:c,config:u,routeConfiguration:m,speculatedTransaction:g,currentUser:p,stripeCustomerFetched:v,paymentIntent:h,dispatch:y,onInitiateOrder:E,onConfirmCardPayment:P,onConfirmPayment:C,onSendMessage:_,onSavePaymentMethod:b,onSubmitCallback:f,pageData:I,setPageData:N,sessionStorageKey:D}=a,{card:T,message:M,paymentMethod:S,formValues:w}=e,{saveAfterOnetimePayment:A}=w,O=((e,t)=>"defaultCard"===e?G:t?V:"ONETIME_PAYMENT")(S,Array.isArray(A)&&A.length>0),F=R(v,p),L=F?null===p||void 0===p||null===(o=p.stripeCustomer)||void 0===o||null===(s=o.defaultPaymentMethod)||void 0===s||null===(l=s.attributes)||void 0===l?void 0:l.stripePaymentMethodId:null,q=h&&K.includes(h.status),U={pageData:I,speculatedTransaction:g,stripe:i,card:T,billingDetails:W(w),message:M,paymentIntent:h,hasPaymentIntentUserActionsDone:q,stripePaymentMethodId:L,process:t,onInitiateOrder:E,onConfirmCardPayment:P,onConfirmPayment:C,onSendMessage:_,onSavePaymentMethod:b,sessionStorageKey:D,stripeCustomer:null===p||void 0===p?void 0:p.stripeCustomer,isPaymentFlowUseSavedCard:O===G,isPaymentFlowPayAndSaveCard:O===V,setPageData:N},B=(e=>{const{saveAfterOnetimePayment:t,recipientName:a,recipientPhoneNumber:i,recipientAddressLine1:n,recipientAddressLine2:r,recipientPostal:o,recipientCity:s,recipientState:l,recipientCountry:c}=e;return a&&n&&o?{shippingDetails:{name:a,phoneNumber:i,address:{city:s,country:c,line1:n,line2:r,postalCode:o,state:l}}}:{}})(w);((e,t)=>{var a,i,n;const{hasPaymentIntentUserActionsDone:r,isPaymentFlowUseSavedCard:o,isPaymentFlowPayAndSaveCard:s,message:l,onConfirmCardPayment:c,onConfirmPayment:u,onInitiateOrder:m,onSavePaymentMethod:g,onSendMessage:p,pageData:v,paymentIntent:h,process:y,setPageData:E,sessionStorageKey:P,stripeCustomer:C,stripePaymentMethodId:_}=t,b=(0,d.G$)(v.transaction),f=(0,d.Cy)(C),I=null===v||void 0===v||null===(a=v.listing)||void 0===a||null===(i=a.attributes)||void 0===i||null===(n=i.publicData)||void 0===n?void 0:n.transactionProcessAlias;let N=null;const D=(e,t)=>e.then(t);return function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return e=>t.reduce(D,Promise.resolve(e))}((e=>{var t,a;const i=null===(t=b.attributes.protectedData)||void 0===t?void 0:t.stripePaymentIntents,n=(null===b||void 0===b||null===(a=b.attributes)||void 0===a?void 0:a.lastTransition)===y.transitions.INQUIRE?y.transitions.REQUEST_PAYMENT_AFTER_INQUIRY:y.transitions.REQUEST_PAYMENT,r=y.isPrivileged(n),o=i?Promise.resolve(b):m(e,I,b.id,n,r);return o.then((e=>{Y(e,v,k,E,P)})),o}),(e=>{var a,i;const n=e,s=null===n||void 0===n||null===(a=n.attributes)||void 0===a||null===(i=a.protectedData)||void 0===i?void 0:i.stripePaymentIntents;if(!s)throw new Error("Missing StripePaymentIntents key in transaction's protectedData. Check that your transaction process is configured to use payment intents.");const{stripePaymentIntentClientSecret:l}=s?n.attributes.protectedData.stripePaymentIntents.default:null,{stripe:d,card:u,billingDetails:m,paymentIntent:g}=t,p=o?{}:{card:u},v=o?{payment_method:_}:{payment_method:{billing_details:m,card:u}},h={stripePaymentIntentClientSecret:l,orderId:null===n||void 0===n?void 0:n.id,stripe:d,...p,paymentParams:v};return r?Promise.resolve({transactionId:null===n||void 0===n?void 0:n.id,paymentIntent:g}):c(h)}),(e=>{var t;N=e.paymentIntent;const a=e.transactionId,i=y.transitions.CONFIRM_PAYMENT,n=(null===b||void 0===b||null===(t=b.attributes)||void 0===t?void 0:t.lastTransition)===i?Promise.resolve(b):u(a,i,{});return n.then((e=>{Y(e,v,k,E,P)})),n}),(e=>{const t=null===e||void 0===e?void 0:e.id;return p({id:t,message:l})}),(e=>s?g(f,(N||h).payment_method).then((t=>t.errors?{...e,paymentMethodSaved:!1}:{...e,paymentMethodSaved:!0})).catch((t=>({...e,paymentMethodSaved:!1}))):Promise.resolve({...e,paymentMethodSaved:!0})))(e)})(X(I,B,O===G&&F?{paymentMethod:L}:O===V?{setupPaymentMethodForSaving:!0}:{},u),U).then((e=>{const{orderId:t,messageSuccess:a,paymentMethodSaved:i}=e;r(!1);const n=a?null:t,o=(0,H.XA)("OrderDetailsPage",m,{id:t.uuid});((e,t,a)=>{a((0,H.dI)("OrderDetailsPage",t).setInitialValues(e))})({initialMessageFailedToTransaction:n,savePaymentMethodFailed:!i},m,y),f(),c.push(o)})).catch((e=>{console.error(e),r(!1)}))},te=e=>{var t,a,n,r,o,s,l,c,m,g,p,h,y,E,P,C,_,b,f,k,I;const[N,D]=(0,i.useState)(!1),[T,w]=(0,i.useState)(null),{scrollingDisabled:H,speculateTransactionError:U,speculatedTransaction:W,initiateOrderError:Y,confirmPaymentError:Q,intl:V,currentUser:G,confirmCardPaymentError:X,paymentIntent:$,retrievePaymentIntentError:te,stripeCustomerFetched:ae,pageData:ie,processName:ne,listingTitle:re,title:oe,config:se}=e,le=(0,L.Cw)(U)||(0,L.Cw)(Y),{listing:ce,transaction:de,orderData:ue}=ie,me=(0,d.G$)(de),ge=(0,d.G$)(W,{},null),pe=(null===me||void 0===me||null===(t=me.attributes)||void 0===t||null===(a=t.lineItems)||void 0===a?void 0:a.length)>0?me:ge,ve=null===ce||void 0===ce||null===(n=ce.attributes)||void 0===n||null===(r=n.availabilityPlan)||void 0===r?void 0:r.timezone,he=null===ce||void 0===ce||null===(o=ce.attributes)||void 0===o||null===(s=o.publicData)||void 0===s?void 0:s.transactionProcessAlias,ye=null===ce||void 0===ce||null===(l=ce.attributes)||void 0===l||null===(c=l.publicData)||void 0===c?void 0:c.unitType,Ee="line-item/".concat(ye)===O.PC?O.In:O.FJ,Pe=null!==pe&&void 0!==pe&&null!==(m=pe.booking)&&void 0!==m&&m.id?{booking:pe.booking,dateType:Ee,timeZone:ve}:{},Ce=pe.id&&(null===(g=pe.attributes.lineItems)||void 0===g?void 0:g.length)>0?i.createElement(v.J0,Object.assign({className:S.orderBreakdown,userRole:"customer",transaction:pe},Pe,{currency:se.currency,marketplaceName:se.marketplaceName})):null,_e=(null===pe||void 0===pe||null===(p=pe.attributes)||void 0===p||null===(h=p.lineItems)||void 0===h?void 0:h.length)>0?((e,t)=>{const a=e.attributes.payinTotal;return(0,q.lb)(t,a)})(pe,V):null,be=ne?(0,u.Yt)(ne):null,fe=be.transitions,ke=B(me,be),Ie=!(!G||le||Y||U||te||ke),Ne=(null===ce||void 0===ce||null===(y=ce.images)||void 0===y?void 0:y.length)>0?ce.images[0]:null,De=((e,t,a,n,r,o)=>{let s=null,l=null,c=null;const d=(0,L.N2)(t),u=(0,L.Wq)(t),m=(0,L.gu)(t);if(e)s=i.createElement(M._H,{id:"CheckoutPage.listingNotFoundError"});else if(d)l=i.createElement(M._H,{id:"CheckoutPage.initiateOrderAmountTooLow"});else if((0,L.cJ)(t))l=i.createElement(M._H,{id:"CheckoutPage.bookingTimeNotAvailableMessage"});else if((0,L.IK)(t))l=i.createElement(M._H,{id:"CheckoutPage.correctQuantityInformationMissing"});else if((0,L.Z2)(t))l=i.createElement(M._H,{id:"CheckoutPage.notEnoughStockMessage"});else if(u)l=i.createElement(M._H,{id:"CheckoutPage.chargeDisabledMessage"});else if(m&&m.length>0){const e="Your destination account needs to have at least one of the following capabilities enabled";if(1===m.length&&m[0].indexOf(e)>-1)l=i.createElement(M._H,{id:"CheckoutPage.destinationAccountNotCompleteStripeError"});else{const e=m.join(", ");l=i.createElement(M._H,{id:"CheckoutPage.initiateOrderStripeError",values:{stripeErrors:e}})}}else(0,L.VR)(t)?l=i.createElement(M._H,{id:"CheckoutPage.tooManyRequestsError"}):t&&(l=i.createElement(M._H,{id:"CheckoutPage.initiateOrderError",values:{listingLink:o}}));(0,L.Eo)(r)?c=i.createElement(M._H,{id:"CheckoutPage.providerStripeAccountMissingError"}):(0,L.cJ)(r)?c=i.createElement(M._H,{id:"CheckoutPage.bookingTimeNotAvailableMessage"}):(0,L.Z2)(r)?c=i.createElement(M._H,{id:"CheckoutPage.notEnoughStockMessage"}):(0,L.ce)(r)?c=i.createElement(M._H,{id:"CheckoutPage.initiateOrderAmountTooLow"}):(0,L.IK)(r)?c=i.createElement(M._H,{id:"CheckoutPage.correctQuantityInformationMissing"}):r&&(c=i.createElement(M._H,{id:"CheckoutPage.speculateFailedMessage"}));const g=s?i.createElement("p",{className:S.notFoundError},s):null,p=l?i.createElement("p",{className:S.orderError},l):null,v=c?i.createElement("p",{className:S.orderError},c):null,h=r&&!(0,L.Eo)(r)?i.createElement("p",{className:S.speculateError},i.createElement(M._H,{id:"CheckoutPage.speculateTransactionError"})):null,y=n?i.createElement("p",{className:S.orderError},i.createElement(M._H,{id:"CheckoutPage.retrievingStripePaymentIntentFailed",values:{listingLink:o}})):null;return{listingNotFoundErrorMessage:g,initiateOrderErrorMessage:p,paymentExpiredMessage:a?i.createElement("p",{className:S.orderError},i.createElement(M._H,{id:"CheckoutPage.paymentExpiredMessage",values:{listingLink:o}})):null,retrievePaymentIntentErrorMessage:y,speculateErrorMessage:v,speculateTransactionErrorMessage:h}})(le,Y,ke,te,U,i.createElement(v.RC,{name:"ListingPage",params:{id:null===ce||void 0===ce||null===(E=ce.id)||void 0===E?void 0:E.uuid,slug:(0,F.qi)(re)}},i.createElement(M._H,{id:"CheckoutPage.errorlistingLinkText"}))),Te=!((null===me||void 0===me||null===(P=me.attributes)||void 0===P?void 0:P.transitions)||[]).find((e=>e.transition===fe.INQUIRE)),Me=null!==G&&void 0!==G&&null!==(C=G.attributes)&&void 0!==C&&C.profile?"".concat(G.attributes.profile.firstName," ").concat(G.attributes.profile.lastName):null,Se=$&&K.includes($.status),we={name:Me,recipientName:Me},Ae="shipping"===(null===ue||void 0===ue?void 0:ue.deliveryMethod)&&!z(me,be);return i.createElement(v.T3,{title:oe,scrollingDisabled:H},i.createElement(A,{intl:V}),i.createElement("div",{className:S.contentContainer},i.createElement(Z,{listingTitle:re,author:null===ce||void 0===ce?void 0:ce.author,firstImage:Ne,layoutListingImageConfig:se.layout.listingImage}),i.createElement("div",{className:S.orderFormContainer},i.createElement("div",{className:S.headingContainer},i.createElement(v.H3,{as:"h1",className:S.heading},oe),i.createElement(v.H4,{as:"h2",className:S.detailsHeadingMobile},i.createElement(M._H,{id:"CheckoutPage.listingTitle",values:{listingTitle:re}}))),i.createElement(J,{speculateTransactionErrorMessage:De.speculateTransactionErrorMessage,breakdown:Ce}),i.createElement("section",{className:S.paymentContainer},De.initiateOrderErrorMessage,De.listingNotFoundErrorMessage,De.speculateErrorMessage,De.retrievePaymentIntentErrorMessage,De.paymentExpiredMessage,Ie?i.createElement(j.Z,{className:S.paymentForm,onSubmit:t=>ee(t,be,e,T,N,D),inProgress:N,formId:"CheckoutPagePaymentForm",authorDisplayName:null===ce||void 0===ce||null===(_=ce.author)||void 0===_||null===(b=_.attributes)||void 0===b||null===(f=b.profile)||void 0===f?void 0:f.displayName,showInitialMessageInput:Te,initialValues:we,initiateOrderError:Y,confirmCardPaymentError:X,confirmPaymentError:Q,hasHandledCardPayment:Se,loadingData:!ae,defaultPaymentMethod:R(ae,G)?G.stripeCustomer.defaultPaymentMethod:null,paymentIntent:$,onStripeInitialized:t=>(w(t),((e,t,a)=>{const{paymentIntent:i,onRetrievePaymentIntent:n,pageData:r}=a,o=(null===r||void 0===r?void 0:r.transaction)||null;if(e&&!i&&(null===o||void 0===o?void 0:o.id)&&(null===t||void 0===t?void 0:t.getState(o))===(null===t||void 0===t?void 0:t.states.PENDING_PAYMENT)&&!B(o,t)){var s,l;const{stripePaymentIntentClientSecret:t}=(null===(s=o.attributes.protectedData)||void 0===s||null===(l=s.stripePaymentIntents)||void 0===l?void 0:l.default)||{};n({stripe:e,stripePaymentIntentClientSecret:t})}})(t,be,e)),askShippingDetails:Ae,showPickUplocation:"pickup"===(null===ue||void 0===ue?void 0:ue.deliveryMethod),listingLocation:null===ce||void 0===ce||null===(k=ce.attributes)||void 0===k||null===(I=k.publicData)||void 0===I?void 0:I.location,totalPrice:_e,locale:se.localization.locale,stripePublishableKey:se.stripe.publishableKey,marketplaceName:se.marketplaceName,isBooking:(0,u.Ll)(he),isFuzzyLocation:se.maps.fuzzy.enabled}):null)),i.createElement(x,{listing:ce,listingTitle:re,author:null===ce||void 0===ce?void 0:ce.author,firstImage:Ne,layoutListingImageConfig:se.layout.listingImage,speculateTransactionErrorMessage:De.speculateTransactionErrorMessage,isInquiryProcess:!1,processName:ne,breakdown:Ce,intl:V})))};te.defaultProps={initiateOrderError:null,confirmPaymentError:null,listing:null,orderData:{},speculateTransactionError:null,speculatedTransaction:null,transaction:null,currentUser:null,paymentIntent:null};const ae=te;var ie=a(55269),ne=a(62887),re=a(84480);const oe=e=>{const{error:t}=e,a=(0,L.Cw)(t),n="No transaction process attached to listing"===(null===t||void 0===t?void 0:t.message);return t?i.createElement("p",{className:S.error},a?i.createElement(M._H,{id:"CheckoutPage.listingNotFoundError"}):n?i.createElement(M._H,{id:"CheckoutPageWithInquiryProcess.initiateInquiryErrorNoProcess"}):i.createElement(M._H,{id:"CheckoutPageWithInquiryProcess.initiateInquiryError"})):null},se=e=>{var t,a;const[n,r]=(0,i.useState)(!1),{scrollingDisabled:o,intl:s,config:l,processName:c,pageData:d,listingTitle:m,title:g,initiateInquiryError:p}=e,h=((e,t,a)=>i=>{var n,r,o;if(e)return;t(!0);const{history:s,config:l,routeConfiguration:c,pageData:d,processName:m,onInquiryWithoutPayment:g,onSubmitCallback:p}=a,{inquiryMessage:v}=i,{listingType:h,transactionProcessAlias:y,unitType:E}=(null===d||void 0===d||null===(n=d.listing)||void 0===n||null===(r=n.attributes)||void 0===r?void 0:r.publicData)||{},P=(m?(0,u.Yt)(m):null).transitions.INQUIRE_WITHOUT_PAYMENT;g({listingId:null===d||void 0===d||null===(o=d.listing)||void 0===o?void 0:o.id,protectedData:{inquiryMessage:v,...U(h,E,l)}},y,P).then((e=>{t(!1),p();const a=(0,H.XA)("OrderDetailsPage",c,{id:e.uuid});s.push(a)})).catch((e=>{console.error(e),t(!1)}))})(n,r,e),{listing:y}=d,{price:E,publicData:P}=(null===y||void 0===y?void 0:y.attributes)||{},C=(null===y||void 0===y||null===(t=y.images)||void 0===t?void 0:t.length)>0?y.images[0]:null,_=i.createElement(v.RC,{name:"ListingPage",params:{id:null===y||void 0===y||null===(a=y.id)||void 0===a?void 0:a.uuid,slug:(0,F.qi)(m)}},m),b=null===P||void 0===P?void 0:P.listingType,f=l.listing.listingTypes.find((e=>e.listingType===b)),k=(0,ne.ED)(f);return i.createElement(v.T3,{title:g,scrollingDisabled:o},i.createElement(A,{intl:s}),i.createElement("div",{className:S.contentContainer},i.createElement(Z,{listingTitle:m,author:null===y||void 0===y?void 0:y.author,firstImage:C,layoutListingImageConfig:l.layout.listingImage}),i.createElement("div",{className:S.orderFormContainer},i.createElement("div",{className:S.headingContainer},i.createElement(v.H3,{as:"h1",className:S.heading},g),i.createElement(v.H4,{as:"h2",className:S.detailsHeadingMobile},i.createElement(M._H,{id:"CheckoutPage.listingTitle",values:{listingTitle:_}}),k&&E?i.createElement(i.Fragment,null,i.createElement("br",null),i.createElement("span",{className:S.inquiryPrice},(0,q.lb)(s,E))):null)),i.createElement("section",{className:S.paymentContainer},i.createElement(ie.l0,{onSubmit:h,render:e=>{const{rootClassName:t,className:a,submitButtonWrapperClassName:n,formId:r,handleSubmit:o,inProgress:l,authorDisplayName:c}=e,d=T()(t||S.root,a),u=l,m=u;return i.createElement(v.l0,{className:d,onSubmit:o,enforcePagePreloadFor:"OrderDetailsPage"},i.createElement("div",{className:S.section},i.createElement(v.X6,{as:"h4",rootClassName:S.sectionHeading},i.createElement(M._H,{id:"CheckoutPageWithInquiryProcess.messageLabel",values:{authorDisplayName:c}})),i.createElement(v.gC,{className:S.fieldInquiryMessage,type:"textarea",name:"inquiryMessage",id:r?"".concat(r,".message"):"message",placeholder:s.formatMessage({id:"CheckoutPageWithInquiryProcess.messagePlaceholder"},{authorDisplayName:c}),validate:re.kz(s.formatMessage({id:"CheckoutPageWithInquiryProcess.messageRequired"}))})),i.createElement("div",{className:n},i.createElement(oe,{error:p}),i.createElement(v.KM,{type:"submit",inProgress:u,disabled:m},i.createElement(M._H,{id:"CheckoutPageWithInquiryProcess.submitButtonText"}))))}}))),i.createElement(x,{listing:y,listingTitle:m,author:null===y||void 0===y?void 0:y.author,firstImage:C,layoutListingImageConfig:l.layout.listingImage,processName:c,showPrice:k&&!!E,intl:s})))},le="CheckoutPage",ce=()=>{var e;e=le,window&&window.sessionStorage&&window.sessionStorage.removeItem(e)},de=e=>{var t,a,i,n;const{transaction:r,listing:o}=e||{},s=null!==r&&void 0!==r&&r.id?null===r||void 0===r||null===(t=r.attributes)||void 0===t?void 0:t.processName:null!==o&&void 0!==o&&o.id?null===o||void 0===o||null===(a=o.attributes)||void 0===a||null===(i=a.publicData)||void 0===i||null===(n=i.transactionProcessAlias)||void 0===n?void 0:n.split("/")[0]:null;return(0,u.b$)(s)},ue=(0,n.qC)((0,r.$j)((e=>{const{listing:t,orderData:a,stripeCustomerFetched:i,speculateTransactionInProgress:n,speculateTransactionError:r,speculatedTransaction:o,transaction:s,initiateInquiryError:l,initiateOrderError:c,confirmPaymentError:d}=e.CheckoutPage,{currentUser:u}=e.user,{confirmCardPaymentError:g,paymentIntent:p,retrievePaymentIntentError:v}=e.stripe;return{scrollingDisabled:(0,m.uS)(e),currentUser:u,stripeCustomerFetched:i,orderData:a,speculateTransactionInProgress:n,speculateTransactionError:r,speculatedTransaction:o,transaction:s,listing:t,initiateInquiryError:l,initiateOrderError:c,confirmCardPaymentError:g,confirmPaymentError:d,paymentIntent:p,retrievePaymentIntentError:v}}),(e=>({dispatch:e,fetchSpeculatedTransaction:(t,a,i,n,r)=>e((0,N.ZI)(t,a,i,n,r)),fetchStripeCustomer:()=>e((0,N.sz)()),onInquiryWithoutPayment:(t,a,i)=>e((0,N.v4)(t,a,i)),onInitiateOrder:(t,a,i,n,r)=>e((0,N.GD)(t,a,i,n,r)),onRetrievePaymentIntent:t=>e((0,g.wI)(t)),onConfirmCardPayment:t=>e((0,g.LW)(t)),onConfirmPayment:(t,a,i)=>e((0,N.B1)(t,a,i)),onSendMessage:t=>e((0,N.bG)(t)),onSavePaymentMethod:(t,a)=>e((0,p.BX)(t,a))}))))((e=>{var t,a,n,r,m;const[g,p]=(0,i.useState)({}),[h,y]=(0,i.useState)(!1),E=(0,l.mX)(),P=(0,c.a5)(),C=(0,s.Z)(),_=(0,o.k6)();(0,i.useEffect)((()=>{const{orderData:t,listing:a,transaction:i,fetchSpeculatedTransaction:n,fetchStripeCustomer:r}=e,o=((e,t,a)=>{let{orderData:i,listing:n,transaction:r}=e;const o="PUSH"===a.action||"REPLACE"===a.action,s=!!(i&&n&&o);return s&&k(i,n,r,t),s?{orderData:i,listing:n,transaction:r}:I(t)})({orderData:t,listing:a,transaction:i},le,_);p(o||{}),y(!0),de(o)!==u.N5&&$({pageData:o||{},fetchSpeculatedTransaction:n,fetchStripeCustomer:r,config:E})}),[]);const{currentUser:b,params:f,scrollingDisabled:N,speculateTransactionInProgress:D,onInquiryWithoutPayment:T}=e,M=de(g),S=M===u.N5,w=null===g||void 0===g?void 0:g.listing,H=(null===b||void 0===b?void 0:b.id)&&(null===w||void 0===w||null===(t=w.author)||void 0===t||null===(a=t.id)||void 0===a?void 0:a.uuid)===(null===b||void 0===b||null===(n=b.id)||void 0===n?void 0:n.uuid),O=!!(null!==w&&void 0!==w&&w.id&&null!==w&&void 0!==w&&null!==(r=w.author)&&void 0!==r&&r.id&&M);if(h&&!(O&&!H))return console.error("Missing or invalid data for checkout, redirecting back to listing page.",{listing:w}),i.createElement(v.d9,{name:"ListingPage",params:f});const F=null===w||void 0===w||null===(m=w.attributes)||void 0===m?void 0:m.title,L=(0,d.d8)(null===w||void 0===w?void 0:w.author,""),q=M?C.formatMessage({id:"CheckoutPage.".concat(M,".title")},{listingTitle:F,authorDisplayName:L}):"Checkout page is loading data";return M&&S?i.createElement(se,Object.assign({config:E,routeConfiguration:P,intl:C,history:_,processName:M,pageData:g,listingTitle:F,title:q,onInquiryWithoutPayment:T,onSubmitCallback:ce},e)):!M||S||D?i.createElement(v.T3,{title:q,scrollingDisabled:N},i.createElement(A,{intl:C})):i.createElement(ae,Object.assign({config:E,routeConfiguration:P,intl:C,history:_,processName:M,sessionStorageKey:le,pageData:g,setPageData:p,listingTitle:F,title:q,onSubmitCallback:ce},e))}));ue.setInitialValues=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){const{listing:t,orderData:a}=e;k(a,t,null,le)}return(0,N.LA)(e)},ue.displayName="CheckoutPage";const me=ue}}]);
//# sourceMappingURL=CheckoutPage.d1587968.chunk.js.map