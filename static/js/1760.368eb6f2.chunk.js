"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[1760],{11760:(e,a,t)=>{t.d(a,{Z:()=>A});var i=t(72791),n=t(55269),r=t(41418),s=t.n(r),l=t(80948),o=(t(73665),t(10314)),m=t(81301),d=t(84480),c=t(60775);const p="ShippingDetails_root__YJSTk",h="ShippingDetails_heading__Y2aKv p",g="ShippingDetails_formRow__2bxpH",u="ShippingDetails_field__qPTQ+",y="ShippingDetails_fieldFullWidth__BWtHK",S=e=>{const{rootClassName:a,className:t,locale:n,intl:r,disabled:o,formApi:S,fieldId:P}=e,f=s()(a||p,t),C=r.formatMessage({id:"ShippingDetails.optionalText"}),E=(0,c.Z)(n);return i.createElement("div",{className:f},i.createElement(m.X6,{as:"h3",rootClassName:h},i.createElement(l._H,{id:"ShippingDetails.title"})),i.createElement(m.gC,{id:"".concat(P,".recipientName"),name:"recipientName",disabled:o,className:y,type:"text",autoComplete:"shipping name",label:r.formatMessage({id:"ShippingDetails.recipientNameLabel"}),placeholder:r.formatMessage({id:"ShippingDetails.recipientNamePlaceholder"}),validate:d.C1(r.formatMessage({id:"ShippingDetails.recipientNameRequired"})),onUnmount:()=>S.change("recipientName",void 0)}),i.createElement(m.gC,{id:"".concat(P,".recipientPhoneNumber"),name:"recipientPhoneNumber",disabled:o,className:y,type:"text",autoComplete:"shipping phoneNumber",label:r.formatMessage({id:"ShippingDetails.recipientPhoneNumberLabel"},{optionalText:C}),placeholder:r.formatMessage({id:"ShippingDetails.recipientPhoneNumberPlaceholder"}),onUnmount:()=>S.change("recipientPhoneNumber",void 0)}),i.createElement("div",{className:g},i.createElement(m.gC,{id:"".concat(P,".recipientAddressLine1"),name:"recipientAddressLine1",disabled:o,className:u,type:"text",autoComplete:"shipping address-line1",label:r.formatMessage({id:"ShippingDetails.addressLine1Label"}),placeholder:r.formatMessage({id:"ShippingDetails.addressLine1Placeholder"}),validate:d.C1(r.formatMessage({id:"ShippingDetails.addressLine1Required"})),onUnmount:()=>S.change("recipientAddressLine1",void 0)}),i.createElement(m.gC,{id:"".concat(P,".recipientAddressLine2"),name:"recipientAddressLine2",disabled:o,className:u,type:"text",autoComplete:"shipping address-line2",label:r.formatMessage({id:"ShippingDetails.addressLine2Label"},{optionalText:C}),placeholder:r.formatMessage({id:"ShippingDetails.addressLine2Placeholder"}),onUnmount:()=>S.change("recipientAddressLine2",void 0)})),i.createElement("div",{className:g},i.createElement(m.gC,{id:"".concat(P,".recipientPostalCode"),name:"recipientPostal",disabled:o,className:u,type:"text",autoComplete:"shipping postal-code",label:r.formatMessage({id:"ShippingDetails.postalCodeLabel"}),placeholder:r.formatMessage({id:"ShippingDetails.postalCodePlaceholder"}),validate:d.C1(r.formatMessage({id:"ShippingDetails.postalCodeRequired"})),onUnmount:()=>S.change("recipientPostal",void 0)}),i.createElement(m.gC,{id:"".concat(P,".recipientCity"),name:"recipientCity",disabled:o,className:u,type:"text",autoComplete:"shipping address-level2",label:r.formatMessage({id:"ShippingDetails.cityLabel"}),placeholder:r.formatMessage({id:"ShippingDetails.cityPlaceholder"}),validate:d.C1(r.formatMessage({id:"ShippingDetails.cityRequired"})),onUnmount:()=>S.change("recipientCity",void 0)})),i.createElement("div",{className:g},i.createElement(m.gC,{id:"".concat(P,".recipientState"),name:"recipientState",disabled:o,className:u,type:"text",autoComplete:"shipping address-level1",label:r.formatMessage({id:"ShippingDetails.stateLabel"},{optionalText:C}),placeholder:r.formatMessage({id:"ShippingDetails.statePlaceholder"}),onUnmount:()=>S.change("recipientState",void 0)}),i.createElement(m.Wy,{id:"".concat(P,".recipientCountry"),name:"recipientCountry",disabled:o,className:u,label:r.formatMessage({id:"ShippingDetails.countryLabel"}),validate:d.C1(r.formatMessage({id:"ShippingDetails.countryRequired"}))},i.createElement("option",{disabled:!0,value:""},r.formatMessage({id:"ShippingDetails.countryPlaceholder"})),E.map((e=>i.createElement("option",{key:e.code,value:e.code},e.name))))))};S.defaultProps={rootClassName:null,className:null,disabled:!1,fieldId:null};const P=S,f={root:"StripePaymentForm_root__hbiuC",locationWrapper:"StripePaymentForm_locationWrapper__2KG8C",heading:"StripePaymentForm_heading__p2zD8 p",locationDetails:"StripePaymentForm_locationDetails__UB4YX",card:"StripePaymentForm_card__vw7yG marketplaceInputStyles",cardError:"StripePaymentForm_cardError__0Oi2a",error:"StripePaymentForm_error__LIO0Z",errorMessage:"StripePaymentForm_errorMessage__UtRNh",paymentMethodSelector:"StripePaymentForm_paymentMethodSelector__ylBMy",saveForLaterUse:"StripePaymentForm_saveForLaterUse__MzO+Z",saveForLaterUseCheckbox:"StripePaymentForm_saveForLaterUseCheckbox__nIbci",saveForLaterUseLabel:"StripePaymentForm_saveForLaterUseLabel__HVqvK h5",saveForLaterUseLegalInfo:"StripePaymentForm_saveForLaterUseLegalInfo__LLu7- h5",billingDetails:"StripePaymentForm_billingDetails__oCkv9",sameAddressCheckbox:"StripePaymentForm_sameAddressCheckbox__LnjYi",messageLabel:"StripePaymentForm_messageLabel__2WvIC",messageOptional:"StripePaymentForm_messageOptional__ESxce",message:"StripePaymentForm_message__2HH+h",submitContainer:"StripePaymentForm_submitContainer__+n637",paymentInfo:"StripePaymentForm_paymentInfo__CFlG6 h5",submitButton:"StripePaymentForm_submitButton__6ayQi",missingStripeKey:"StripePaymentForm_missingStripeKey__PSMlx"},C=(e,a)=>{const{message:t,code:i,type:n}=a;if(!i||!n)return e.formatMessage({id:"StripePaymentForm.genericError"});const r="validation_error"===n?"StripePaymentForm.stripe.validation_error.".concat(i):"StripePaymentForm.stripe.".concat(n);return e.formatMessage({id:r,defaultMessage:t})},E={fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Inter"}]},_={base:{fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", Helvetica, Arial, sans-serif',fontSize:"undefined"!==typeof window&&window.innerWidth<768?"14px":"16px",fontSmoothing:"antialiased",lineHeight:"24px",letterSpacing:"-0.1px",color:"#4A4A4A","::placeholder":{color:"#B2B2B2"}}},b=e=>{const{cardClasses:a,formId:t,handleStripeElementRef:n,hasCardError:r,error:s,label:o,intl:d,marketplaceName:c}=e,p=o||d.formatMessage({id:"StripePaymentForm.saveAfterOnetimePayment"});return i.createElement(i.Fragment,null,i.createElement("label",{className:f.paymentLabel,htmlFor:"".concat(t,"-card")},i.createElement(l._H,{id:"StripePaymentForm.paymentCardDetails"})),i.createElement("div",{className:a,id:"".concat(t,"-card"),ref:n}),r?i.createElement("span",{className:f.error},s):null,i.createElement("div",{className:f.saveForLaterUse},i.createElement(m.vE,{className:f.saveForLaterUseCheckbox,textClassName:f.saveForLaterUseLabel,id:"saveAfterOnetimePayment",name:"saveAfterOnetimePayment",label:p,value:"saveAfterOnetimePayment",useSuccessColor:!0}),i.createElement("span",{className:f.saveForLaterUseLegalInfo},i.createElement(l._H,{id:"StripePaymentForm.saveforLaterUseLegalInfo",values:{marketplaceName:c}}))))},F=e=>{const{cardClasses:a,formId:t,changePaymentMethod:n,defaultPaymentMethod:r,handleStripeElementRef:s,hasCardError:o,error:d,paymentMethod:c,intl:p,marketplaceName:h}=e,g=r.attributes.card.last4Digits,u=p.formatMessage({id:"StripePaymentForm.replaceAfterOnetimePayment"},{last4Digits:g});return i.createElement(i.Fragment,null,i.createElement(m.X6,{as:"h3",rootClassName:f.heading},i.createElement(l._H,{id:"StripePaymentForm.payWithHeading"})),i.createElement(m.Me,{className:f.paymentMethodSelector,card:r.attributes.card,onChange:n}),"replaceCard"===c?i.createElement(b,{cardClasses:a,formId:t,handleStripeElementRef:s,hasCardError:o,error:d,label:u,intl:p,marketplaceName:h}):null)},N=(e,a)=>null==e&&a?"defaultCard":null==e?"onetimeCardPayment":e,v=(e,a,t,i)=>{const n=i||"defaultCard"===a&&t,r=["onetimeCardPayment","replaceCard"].includes(a);return{onetimePaymentNeedsAttention:!n&&!(r&&e),showOnetimePaymentFields:r}},M=e=>{const{askShippingDetails:a,showPickUplocation:t,listingLocation:n,formApi:r,locale:s,isBooking:o,isFuzzyLocation:d,intl:c}=e,p=null!==n&&void 0!==n&&n.building?"".concat(n.building,", ").concat(n.address):null!==n&&void 0!==n&&n.address?n.address:c.formatMessage({id:"StripePaymentForm.locationUnknown"});return a?i.createElement(P,{intl:c,formApi:r,locale:s}):!o&&t?i.createElement("div",{className:f.locationWrapper},i.createElement(m.X6,{as:"h3",rootClassName:f.heading},i.createElement(l._H,{id:"StripePaymentForm.pickupDetailsTitle"})),i.createElement("p",{className:f.locationDetails},p)):o&&!d?i.createElement("div",{className:f.locationWrapper},i.createElement(m.X6,{as:"h3",rootClassName:f.heading},i.createElement(l._H,{id:"StripePaymentForm.locationDetailsTitle"})),i.createElement("p",{className:f.locationDetails},p)):null},L={error:null,cardValueValid:!1,paymentMethod:null};class D extends i.Component{constructor(e){super(e),this.state=L,this.updateBillingDetailsToMatchShippingAddress=this.updateBillingDetailsToMatchShippingAddress.bind(this),this.handleCardValueChange=this.handleCardValueChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.paymentForm=this.paymentForm.bind(this),this.initializeStripeElement=this.initializeStripeElement.bind(this),this.handleStripeElementRef=this.handleStripeElementRef.bind(this),this.changePaymentMethod=this.changePaymentMethod.bind(this),this.finalFormAPI=null,this.cardContainer=null}componentDidMount(){if(!window.Stripe)throw new Error("Stripe must be loaded for StripePaymentForm");const e=this.props.stripePublishableKey;if(e){const{onStripeInitialized:a,hasHandledCardPayment:t,defaultPaymentMethod:i,loadingData:n}=this.props;this.stripe=window.Stripe(e),a(this.stripe),t||i||n||this.initializeStripeElement()}}componentWillUnmount(){this.card&&(this.card.removeEventListener("change",this.handleCardValueChange),this.card.unmount(),this.card=null)}initializeStripeElement(e){const a=this.stripe.elements(E);this.card||(this.card=a.create("card",{style:_}),this.card.mount(e||this.cardContainer),this.card.addEventListener("change",this.handleCardValueChange),window.addEventListener("resize",(()=>{this.card&&(window.innerWidth<768?this.card.update({style:{base:{fontSize:"14px",lineHeight:"24px"}}}):this.card.update({style:{base:{fontSize:"18px",lineHeight:"24px"}}}))})))}updateBillingDetailsToMatchShippingAddress(e){var a;const t=this.finalFormAPI,i=(null===(a=t.getState())||void 0===a?void 0:a.values)||{};t.batch((()=>{t.change("name",e?i.recipientName:""),t.change("addressLine1",e?i.recipientAddressLine1:""),t.change("addressLine2",e?i.recipientAddressLine2:""),t.change("postal",e?i.recipientPostal:""),t.change("city",e?i.recipientCity:""),t.change("state",e?i.recipientState:""),t.change("country",e?i.recipientCountry:"")}))}changePaymentMethod(e){this.card&&"defaultCard"===e&&(this.card.removeEventListener("change",this.handleCardValueChange),this.card.unmount(),this.card=null,this.setState({cardValueValid:!1})),this.setState({paymentMethod:e}),"defaultCard"===e&&this.finalFormAPI?this.finalFormAPI.change("sameAddressCheckbox",void 0):"replaceCard"===e&&this.finalFormAPI&&(this.finalFormAPI.change("sameAddressCheckbox",["sameAddress"]),this.updateBillingDetailsToMatchShippingAddress(!0))}handleStripeElementRef(e){this.cardContainer=e,this.stripe&&e&&this.initializeStripeElement(e)}handleCardValueChange(e){const{intl:a}=this.props,{error:t,complete:i}=e,n=e.value.postalCode;this.finalFormAPI&&this.finalFormAPI.change("postal",n),this.setState((e=>({error:t?C(a,t):null,cardValueValid:i})))}handleSubmit(e){const{onSubmit:a,inProgress:t,formId:i,hasHandledCardPayment:n,defaultPaymentMethod:r}=this.props,{initialMessage:s}=e,{cardValueValid:l,paymentMethod:m}=this.state,d=null===r||void 0===r?void 0:r.id,c=N(m,d),{onetimePaymentNeedsAttention:p}=v(l,c,d,n);if(t||p)return;a({message:s?s.trim():null,card:this.card,formId:i,formValues:e,paymentMethod:N(m,(0,o.S2)(r).id)})}paymentForm(e){const{className:a,rootClassName:t,inProgress:n,loadingData:r,formId:d,paymentInfo:c,authorDisplayName:p,showInitialMessageInput:h,intl:g,initiateOrderError:u,confirmCardPaymentError:y,confirmPaymentError:S,invalid:P,handleSubmit:C,form:E,hasHandledCardPayment:_,defaultPaymentMethod:L,listingLocation:D,askShippingDetails:A,showPickUplocation:I,totalPrice:k,locale:x,stripePublishableKey:H,marketplaceName:U,isBooking:w,isFuzzyLocation:B,values:O}=e;this.finalFormAPI=E;const z=(0,o.S2)(L),V=!(_||S),{cardValueValid:R,paymentMethod:T}=this.state,K=z.id,W=N(T,K),{onetimePaymentNeedsAttention:X,showOnetimePaymentFields:q}=v(R,W,K,_),Y=P||X||n,Z=this.state.error&&!n,G=y||S,j=s()(t||f.root,a),Q=s()(f.card,{[f.cardSuccess]:this.state.cardValueValid,[f.cardError]:Z}),J=k||"",$=y&&"payment_intent_authentication_failure"===y.code?g.formatMessage({id:"StripePaymentForm.confirmCardPaymentError"}):y?y.message:S?g.formatMessage({id:"StripePaymentForm.confirmPaymentError"}):g.formatMessage({id:"StripePaymentForm.genericError"}),ee=g.formatMessage({id:"StripePaymentForm.billingDetailsNameLabel"}),ae=g.formatMessage({id:"StripePaymentForm.billingDetailsNamePlaceholder"}),te=g.formatMessage({id:"StripePaymentForm.messagePlaceholder"},{name:p}),ie=g.formatMessage({id:"StripePaymentForm.messageOptionalText"}),ne=g.formatMessage({id:"StripePaymentForm.messageLabel"},{messageOptionalText:ie}),re=i.createElement(m.hy,{intl:g,form:E,fieldId:d,card:this.card,locale:x}),se=w?"yes":"no";return H?i.createElement(m.l0,{className:j,onSubmit:C,enforcePagePreloadFor:"OrderDetailsPage"},i.createElement(M,{askShippingDetails:A,showPickUplocation:I,listingLocation:D,isBooking:w,isFuzzyLocation:B,formApi:E,locale:x,intl:g}),V&&!r?i.createElement(i.Fragment,null,K?i.createElement(F,{cardClasses:Q,formId:d,defaultPaymentMethod:z,changePaymentMethod:this.changePaymentMethod,handleStripeElementRef:this.handleStripeElementRef,hasCardError:Z,error:this.state.error,paymentMethod:W,intl:g,marketplaceName:U}):i.createElement(i.Fragment,null,i.createElement(m.X6,{as:"h3",rootClassName:f.heading},i.createElement(l._H,{id:"StripePaymentForm.paymentHeading"})),i.createElement(b,{cardClasses:Q,formId:d,handleStripeElementRef:this.handleStripeElementRef,hasCardError:Z,error:this.state.error,intl:g,marketplaceName:U})),q?i.createElement("div",{className:f.billingDetails},i.createElement(m.X6,{as:"h3",rootClassName:f.heading},i.createElement(l._H,{id:"StripePaymentForm.billingDetails"})),A?i.createElement(m.vE,{className:f.sameAddressCheckbox,textClassName:f.sameAddressLabel,id:"sameAddressCheckbox",name:"sameAddressCheckbox",label:g.formatMessage({id:"StripePaymentForm.sameBillingAndShippingAddress"}),value:"sameAddress",useSuccessColor:!0,onChange:e=>{const a=e.target.checked;this.updateBillingDetailsToMatchShippingAddress(a)}}):null,i.createElement(m.gC,{className:f.field,type:"text",id:"name",name:"name",autoComplete:"cc-name",label:ee,placeholder:ae}),re):null):r?i.createElement("p",{className:f.spinner},i.createElement(m.vM,null)):null,u?i.createElement("span",{className:f.errorMessage},u.message):null,h?i.createElement("div",null,i.createElement(m.X6,{as:"h3",rootClassName:f.heading},i.createElement(l._H,{id:"StripePaymentForm.messageHeading"})),i.createElement(m.gC,{type:"textarea",id:"".concat(d,"-message"),name:"initialMessage",label:ne,placeholder:te,className:f.message})):null,i.createElement("div",{className:f.submitContainer},G?i.createElement("span",{className:f.errorMessage},$):null,i.createElement(m.KM,{className:f.submitButton,type:"submit",inProgress:n,disabled:Y},V?i.createElement(l._H,{id:"StripePaymentForm.submitPaymentInfo",values:{totalPrice:J,isBooking:se}}):i.createElement(l._H,{id:"StripePaymentForm.submitConfirmPaymentInfo",values:{totalPrice:J,isBooking:se}})),i.createElement("p",{className:f.paymentInfo},i.createElement(l._H,{id:"StripePaymentForm.submitConfirmPaymentFinePrint",values:{isBooking:se,name:p}})))):i.createElement("div",{className:f.missingStripeKey},i.createElement(l._H,{id:"StripePaymentForm.missingStripeKey"}))}render(){const{onSubmit:e,...a}=this.props;return i.createElement(n.l0,Object.assign({onSubmit:this.handleSubmit},a,{render:this.paymentForm}))}}D.defaultProps={className:null,rootClassName:null,inProgress:!1,loadingData:!1,showInitialMessageInput:!0,hasHandledCardPayment:!1,defaultPaymentMethod:null,initiateOrderError:null,confirmCardPaymentError:null,confirmPaymentError:null,askShippingDetails:!1,showPickUplocation:!1,listingLocation:null,totalPrice:null,isFuzzyLocation:!1};const A=(0,l.XN)(D)}}]);
//# sourceMappingURL=1760.368eb6f2.chunk.js.map