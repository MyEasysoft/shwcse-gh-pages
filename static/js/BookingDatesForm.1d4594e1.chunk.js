"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[2735],{73554:(e,t,n)=>{n.r(t),n.d(t,{BookingDatesFormComponent:()=>$,default:()=>K});var a=n(72791),o=n(42789),r=n(55269),s=n(41418),i=n.n(s),l=n(80948),c=n(84480),d=n(53176),u=n(73665),m=n(7285),D=n(81301),g=n(38975);const y="BookingDatesForm_root__It1h9",k="BookingDatesForm_bookingBreakdownTitle__jquSB",h="BookingDatesForm_totalDivider__DT8iL",v="BookingDatesForm_bookingDates__uThZd",E="BookingDatesForm_priceBreakdownContainer__6ZoJr",b="BookingDatesForm_sideBarError__BqsBi h4",_="BookingDatesForm_finePrint__EzN6H marketplaceTinyFontStyles",f="BookingDatesForm_submitButton__KUzZT",B="BookingDatesForm_arrowIcon__KtzsU",p=new Date,N=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,d.RY)(e,"month",t,n,"months")},F=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,d.RY)(e,"month",t,-1*n,"months")},I=(e,t,n)=>(0,d.RY)(e,"day",n,t-1,"days"),R=(e,t,n)=>e.findIndex((e=>(0,d.mh)(t,e.attributes.start,e.attributes.end,"hour",n)))>-1,T=(e,t,n)=>{var a;const o=(0,d.XU)(t,n);return(null===e||void 0===e||null===(a=e[o])||void 0===a?void 0:a.timeSlots)||[]},Y=(e,t,n,a)=>{const o=(0,d.RY)(t,"day",a,1,"days");if((0,d.KC)(o,n,a))return null;const r=T(e,o,a);return R(r,o,a)?Y(e,o,n,a):o},C=(e,t,n,a)=>{const o=(0,d.RY)(n,"day",a,-1,"days");if((0,d.KC)(o,t,a))return null;const r=T(e,o,a);return R(r,o,a)?C(e,t,o,a):o},P=(e,t)=>(n,a)=>{const o=(0,d.RY)((0,d.vc)(n,t),"day",t),r=(0,d.RY)((0,d.vc)(a,t),"day",t);return!!Y(e,o,r,t)},w=(e,t,n,a)=>e&&t&&(!n||a===d.I7)&&a!==d.dB,S=(e,t,n,a,o,r)=>s=>{const i=o-1,l=(0,d.RY)(p,"day",r,i,"days"),c=(0,d.RY)(p,"day",r,i+1,"days"),m=(0,d.RY)(t,"day",r),D=w(e,t,n,s)?Y(e,t,c,r):null;if(D)return e=>{const t=(0,d.vc)(e,r),n=(0,d.RY)(t,"day",r),o=((e,t,n)=>{const a=t instanceof Date,o=e===u.E4;return a?o?(0,d.RY)(t,"day",n,-1,"days"):t:null})(a,D,r);return!(0,d.U$)(n,m)||!(0,d.U$)(o,n)};const g=e&&n&&!t&&s!==d.I7?C(e,p,n,r):null;return g?e=>{const t=(0,d.vc)(e,r),n=(0,d.RY)(t,"day",r),a=(0,d.RY)(g,"day",r,1,"days");return!(0,d.U$)(n,a)||!(0,d.U$)(l,n)}:e=>{const t=(0,d.vc)(e,r),n=(0,d.RY)(t,"day",r);return!(0,d.U$)(n,p)||!(0,d.U$)(l,n)}},U=(e,t,n)=>{var a;return!!((null===e||void 0===e||null===(a=e.attributes)||void 0===a?void 0:a.type)===u.wf)&&(0,d.mh)(t,e.attributes.start,e.attributes.end,void 0,n)},M=(e,t,n,a,o)=>{const r=I(p,n,a);if((0,d.mh)(e,p,r)){const n=(0,d.U$)(p,e)?p:e,s=N(e,a);o(t,n,(0,d.U$)(s,r)?(0,d.RY)(r,"day",a):s,a)}},L=e=>a.createElement(D.JT,Object.assign({},e,{direction:"left",rootClassName:B})),Z=e=>a.createElement(D.JT,Object.assign({},e,{direction:"right",rootClassName:B})),A=e=>{const{currentMonth:t,dayCountAvailableForBooking:n,timeZone:o}=e,r=N(t,o);return(0,d.U$)(r,I(p,n,o))?null:a.createElement(Z,null)},O=e=>{const{currentMonth:t,timeZone:n}=e,o=F(t,n),r=(0,d.RY)(p,"month",n);return(0,d.U$)(o,r)?a.createElement(L,null):null},$=e=>{const[t,n]=(0,a.useState)(null),[o,s]=(0,a.useState)((0,d.RY)(p,"month",e.timeZone));(0,a.useEffect)((()=>{e.onMonthChanged&&e.onMonthChanged(monthId)}),[o]);const{rootClassName:B,className:I,price:R,listingId:C,isOwnListing:L,fetchLineItemsInProgress:Z,onFetchTransactionLineItems:$,onSubmit:H,timeZone:K,dayCountAvailableForBooking:j,marketplaceName:q,payoutDetailsWarning:x,...J}=e,z=i()(B||y,I),W=((e,t)=>n=>{const{startDate:a,endDate:o}=n.bookingDates||{};a?o?t(n):(n.preventDefault(),e(d.I7)):(n.preventDefault(),e(d.dB))})(n,H),X=(e=>t=>{e(t)})(n),Q=((e,t,n,a)=>o=>{const{startDate:r,endDate:s}=o.values&&o.values.bookingDates?o.values.bookingDates:{};r&&s&&!n&&a({orderData:{bookingStart:r,bookingEnd:s},listingId:e,isOwnListing:t})})(C,L,Z,$);return a.createElement(r.l0,Object.assign({},J,{unitPrice:R,onSubmit:W,render:e=>{const{endDatePlaceholder:n,startDatePlaceholder:i,formId:y,handleSubmit:B,intl:I,lineItemUnitType:$,values:H,monthlyTimeSlots:J,lineItems:W,fetchLineItemsError:V,onFetchTimeSlots:G}=e,{startDate:ee,endDate:te}=H&&H.bookingDates?H.bookingDates:{},ne=I.formatMessage({id:"FieldDateRangeInput.invalidStartDate"}),ae=I.formatMessage({id:"FieldDateRangeInput.invalidEndDate"}),oe=ee&&te?{startDate:ee,endDate:te}:null,re=oe&&W&&!Z&&!V,se={weekday:"short",month:"short",day:"numeric"},ie=(0,d.RY)(p,"day",K),le=(0,d.yG)(ie,1,"days"),ce=i||I.formatDate(ie,se),de=n||I.formatDate(le,se),ue=((e,t,n,a,o,r,s)=>i=>{n(i(e,o,2),r,a,o,s);const l=(0,d.XU)(e,o),c=t[l];c&&c.fetchTimeSlotsError&&n(e,r,a,o,s)})(o,J,M,j,K,C,G),me=((e,t,n,a,o,r)=>s=>{const i=o-1,l=(0,d.RY)(p,"day",r,i+1,"days"),c=T(e,t,r),m=w(c,t,n,s)?Y(e,t,l,r):null;return!c||t||n||s!==d.I7||a!==u.mi?m||!c?()=>!1:t=>{const n=(0,d.vc)(t,r),a=(0,d.RY)(n,"day",r);return!T(e,a,r).find((e=>U(e,a)))}:t=>{const n=(0,d.vc)(t,r),a=(0,d.RY)(n,"day",r);return!T(e,a,r).find((e=>U(e,a)))}})(J,ee,te,$,j,K),De=S(J,ee,te,$,j,K);return a.createElement(D.l0,{onSubmit:B,className:z,enforcePagePreloadFor:"CheckoutPage"},a.createElement(r.lP,{subscription:{values:!0},onChange:Q}),a.createElement(D.WN,{className:v,name:"bookingDates",isDaily:$===u.E4,startDateId:"".concat(y,".bookingStartDate"),startDateLabel:I.formatMessage({id:"BookingDatesForm.bookingStartTitle"}),startDatePlaceholderText:ce,endDateId:"".concat(y,".bookingEndDate"),endDateLabel:I.formatMessage({id:"BookingDatesForm.bookingEndTitle"}),endDatePlaceholderText:de,focusedInput:t,onFocusedInputChange:X,format:e=>{const{startDate:t,endDate:n}=e||{},a=t?(0,d.dw)(t,K):t,o=n?(0,d.dw)(n,K):n;return e?{startDate:a,endDate:o}:e},parse:e=>{const{startDate:t,endDate:n}=e||{},a=t?(0,d.RY)((0,d.vc)(t,K),"day",K):t,o=n?(0,d.RY)((0,d.vc)(n,K),"day",K):n;return e?{startDate:a,endDate:o}:e},useMobileMargins:!0,validate:(0,c.A3)((0,c.C1)(I.formatMessage({id:"BookingDatesForm.requiredDate"})),(0,c.FB)(ne,ae)),initialVisibleMonth:(0,d.$T)(ee||ie,K),navNext:a.createElement(A,{currentMonth:o,timeZone:K,dayCountAvailableForBooking:j}),navPrev:a.createElement(O,{currentMonth:o,timeZone:K}),onPrevMonthClick:()=>{s((e=>F(e,K))),ue(F)},onNextMonthClick:()=>{s((e=>N(e,K))),ue(N)},isDayBlocked:me,isOutsideRange:De,isBlockedBetween:P(J,K),disabled:Z,onClose:e=>{var t;return s((0,d.RY)(null!==(t=null===e||void 0===e?void 0:e.startDate)&&void 0!==t?t:ie,"month",K))}}),re?a.createElement("div",{className:E},a.createElement(D.H6,{as:"h3",className:k},a.createElement(l._H,{id:"BookingDatesForm.priceBreakdownTitle"})),a.createElement("hr",{className:h}),a.createElement(g.Z,{breakdownData:oe,lineItems:W,timeZone:K,currency:R.currency,marketplaceName:q,processName:m.j5})):null,V?a.createElement("span",{className:b},a.createElement(l._H,{id:"BookingDatesForm.fetchLineItemsError"})):null,a.createElement("div",{className:f},a.createElement(D.KM,{type:"submit",inProgress:Z},a.createElement(l._H,{id:"BookingDatesForm.requestToBook"}))),a.createElement("p",{className:_},x||a.createElement(l._H,{id:L?"BookingDatesForm.ownListing":"BookingDatesForm.youWontBeChargedInfo"})))}}))};$.defaultProps={rootClassName:null,className:null,price:null,isOwnListing:!1,startDatePlaceholder:null,endDatePlaceholder:null,lineItems:null,fetchLineItemsError:null,monthlyTimeSlots:null};const H=(0,o.qC)(l.XN)($);H.displayName="BookingDatesForm";const K=H},38975:(e,t,n)=>{n.d(t,{Z:()=>k});var a=n(72791),o=n(55950),r=n(66319),s=n(80948),i=n(73665),l=n(79908),c=n(7285),d=n(81301),u=n(60949);const{Money:m,UUID:D}=r.types,g=(e,t)=>{const n=e.reduce(((e,t)=>{const n=(0,l.ud)(t.lineTotal);return new o.Z(n).add(e)}),new o.Z(0)),a=e[0]&&e[0].unitPrice?e[0].unitPrice.currency:t;return new m((0,l.aV)(n.toNumber(),(0,l.p_)(a)),a)},y=function(e,t,n){const a={start:e,end:t};return{id:new D("estimated-booking"),type:"booking",attributes:{...a}}},k=e=>{const{breakdownData:t={},lineItems:n,timeZone:o,currency:r,marketplaceName:l,processName:m}=e,{startDate:k,endDate:h}=t;let v=null;try{v=(0,c.Yt)(m)}catch(F){return a.createElement("div",{className:u.Z.error},a.createElement(s._H,{id:"OrderPanel.unknownTransactionProcess"}))}const E=null===n||void 0===n?void 0:n.find((e=>i.Y8.includes(e.code)&&!e.reversal)),b=null===E||void 0===E?void 0:E.code,_=[i.E4,i.mi].includes(b),f=n&&n.length>0,B=!_||k&&h,p=b===i.PC?i.In:i.FJ,N=f&&B?((e,t,n,a,o,r,s,i)=>{const l=null===r||void 0===r?void 0:r.transitions,d=new Date,u=e.filter((e=>e.includeFor.includes("customer"))),m=e.filter((e=>e.includeFor.includes("provider"))),k=g(u,i),h=g(m,i),v=t&&n?{booking:y(t,n,a,o)}:{};return{id:new D("estimated-transaction"),type:"transaction",attributes:{createdAt:d,processName:s,lastTransitionedAt:d,lastTransition:l.REQUEST_PAYMENT,payinTotal:k,payoutTotal:h,lineItems:u,transitions:[{createdAt:d,by:c.AL,transition:l.REQUEST_PAYMENT}]},...v}})(n,k,h,b,o,v,m,r):null;return N?a.createElement(d.J0,{className:u.Z.receipt,userRole:"customer",transaction:N,booking:N.booking,dateType:p,timeZone:o,currency:r,marketplaceName:l}):null}}}]);
//# sourceMappingURL=BookingDatesForm.1d4594e1.chunk.js.map