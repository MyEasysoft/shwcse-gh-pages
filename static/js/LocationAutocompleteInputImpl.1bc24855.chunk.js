"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[863],{21866:(e,t,n)=>{n.r(t),n.d(t,{default:()=>V});var o={};n.r(o),n.d(o,{CURRENT_LOCATION_ID:()=>k,GeocoderAttribution:()=>F,default:()=>G});var i={};n.r(i),n.d(i,{CURRENT_LOCATION_ID:()=>K,GeocoderAttribution:()=>U,default:()=>z});var s=n(72791),c=n(41418),r=n.n(c),l=n(48573),a=n.n(l),d=n(6639),h=n(80948),u=(n(73665),n(81301));const p="LocationAutocompleteInput_root__C33Xn",g="LocationAutocompleteInput_icon__05Eu7",m="LocationAutocompleteInput_iconSvg__ZBozF",P="LocationAutocompleteInput_iconSvgGroup__ZVPyL",w="LocationAutocompleteInput_iconSpinner__qTgyR",f="LocationAutocompleteInput_input__dNBGc",_="LocationAutocompleteInput_predictionsRoot__IdlJx",S="LocationAutocompleteInput_predictionsRootGoogle__Xf2kH",v="LocationAutocompleteInput_predictionsRootMapbox__Zr6UD",L="LocationAutocompleteInput_poweredByGoogle__pGmSt",I="LocationAutocompleteInput_predictions__v8sKL marketplaceBodyFontStyles",y="LocationAutocompleteInput_highlighted__NKrMp",x="LocationAutocompleteInput_currentLocation__CHnR6 p",N="LocationAutocompleteInput_currentLocationIcon__2uXoi",b=()=>s.createElement("svg",{className:m,width:"21",height:"22",viewBox:"0 0 21 22",xmlns:"http://www.w3.org/2000/svg"},s.createElement("g",{className:P,transform:"matrix(-1 0 0 1 20 1)",strokeWidth:"2",fill:"none",fillRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"},s.createElement("path",{d:"M13 14l5.241 5.241"}),s.createElement("circle",{cx:"7.5",cy:"7.5",r:"7.5"}))),C=()=>s.createElement("svg",{className:N,width:"12",height:"12",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M11.9269636.07279915c-.0779984-.0770013-.1959959-.0950016-.2924939-.04400074L.13470842 6.02889945c-.10199788.05300089-.15499678.16900284-.12749735.28100473.02799942.11150188.12799734.1900032.24299496.1900032h5.249891v5.25008842c0 .1150019.07899836.2160036.19049604.2430041C5.71009267 11.998 5.73059224 12 5.75009184 12c.0914981 0 .1779963-.0505009.22199539-.1345023L11.9719627.36530407c.0499989-.09650162.0319993-.21500362-.0449991-.29250492",fill:"#FFF",fillRule:"evenodd"}));var E=n(66319),D=n(721);const{LatLng:A,LatLngBounds:T}=E.types,k="current-location",M={address:500,country:2e3,region:2e3,postcode:2e3,district:2e3,place:2e3,locality:2e3,neighborhood:2e3,poi:2e3,"poi.landmark":2e3},O=(e,t)=>{if(!e)return null;const n=new window.mapboxgl.LngLat(e.lng,e.lat).toBounds(t);return new T(new A(n.getNorth(),n.getEast()),new A(n.getSouth(),n.getWest()))},B=e=>e&&Array.isArray(e.center)&&2===e.center.length?new A(e.center[1],e.center[0]):null,R=e=>{if(e){if(Array.isArray(e.bbox)&&4===e.bbox.length)return new T(new A(e.bbox[3],e.bbox[2]),new A(e.bbox[1],e.bbox[0]));{const t=Array.isArray(e.place_type)&&e.place_type[0],n=t&&M[t]||500;return O(B(e),n)}}return null},F=()=>null;const G=class{getClient(){if(!("undefined"!==typeof window&&window.mapboxgl&&window.mapboxSdk))throw new Error("Mapbox libraries are required for GeocoderMapbox");return this._client||(this._client=window.mapboxSdk({accessToken:window.mapboxgl.accessToken})),this._client}getPlacePredictions(e,t,n){const o=t?{countries:t}:{};return this.getClient().geocoding.forwardGeocode({query:e,limit:5,...o,language:[n]}).send().then((t=>({search:e,predictions:t.body.features})))}getPredictionId(e){return e.id}getPredictionAddress(e){return e.predictionPlace?e.predictionPlace.address:e.place_name}getPlaceDetails(e,t){return this.getPredictionId(e)===k?(0,D.kO)().then((e=>({address:"",origin:e,bounds:O(e,t)}))):e.predictionPlace?Promise.resolve(e.predictionPlace):Promise.resolve({address:this.getPredictionAddress(e),origin:B(e),bounds:R(e)})}};var H=n(90193);const K="current-location",U=e=>{const{rootClassName:t,className:n}=e,o=r()(t||L,n);return s.createElement("div",{className:o})};const z=class{constructor(){this.sessionToken=null}getSessionToken(){return this.sessionToken=this.sessionToken||new window.google.maps.places.AutocompleteSessionToken,this.sessionToken}getPlacePredictions(e,t){const n=t?{componentRestrictions:{country:t}}:{};return H.ek(e,this.getSessionToken(),n).then((t=>({search:e,predictions:t.predictions})))}getPredictionId(e){return e.predictionPlace?e.id:e.place_id}getPredictionAddress(e){return e.predictionPlace?e.predictionPlace.address:e.description}getPlaceDetails(e,t){return this.getPredictionId(e)===K?(0,D.kO)().then((e=>({address:"",origin:e,bounds:H.xX(e,t)}))):e.predictionPlace?Promise.resolve(e.predictionPlace):H.eD(e.place_id,this.getSessionToken()).then((e=>(this.sessionToken=null,e)))}},W="down",X=e=>{const t=e&&e.changedTouches?e.changedTouches[0]:null;return t?{x:t.screenX,y:t.screenY}:null},Q=e=>"googleMaps"===e?i:o,Z=e=>{const{rootClassName:t,className:n,children:o,predictions:i,currentLocationId:c,geocoder:l,isGoogleMapsInUse:a,highlightedIndex:d,onSelectStart:u,onSelectMove:p,onSelectEnd:g}=e;if(0===i.length)return null;const m=a?S:v,P=r()(t||_,m,n);return s.createElement("div",{className:P},s.createElement("ul",{className:I},i.map(((e,t)=>{const n=t===d,o=l.getPredictionId(e);return s.createElement("li",{className:n?y:null,key:o,onTouchStart:e=>{e.preventDefault(),u(X(e.nativeEvent))},onMouseDown:e=>{e.preventDefault(),u()},onTouchMove:e=>{e.preventDefault(),p(X(e.nativeEvent))},onTouchEnd:t=>{t.preventDefault(),g(e)},onMouseUp:t=>{t.preventDefault(),g(e)}},o===c?s.createElement("span",{className:x},s.createElement(C,null),s.createElement(h._H,{id:"LocationAutocompleteInput.currentLocation"})):l.getPredictionAddress(e))}))),o)};Z.defaultProps={rootClassName:null,className:null,highlightedIndex:null};const q=e=>{const t=e.input.value||{},{search:n="",predictions:o=[],selectedPlace:i=null}=t;return{search:n,predictions:o,selectedPlace:i}};class j extends s.Component{constructor(e){super(e),this._isMounted=!1,this.state={inputHasFocus:!1,selectionInProgress:!1,touchStartedFrom:null,highlightedIndex:-1,fetchingPlaceDetails:!1,fetchingPredictions:!1},this.input=null,this.shortQueryTimeout=null,this.getGeocoder=this.getGeocoder.bind(this),this.currentPredictions=this.currentPredictions.bind(this),this.changeHighlight=this.changeHighlight.bind(this),this.selectPrediction=this.selectPrediction.bind(this),this.selectItemIfNoneSelected=this.selectItemIfNoneSelected.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onChange=this.onChange.bind(this),this.handleOnBlur=this.handleOnBlur.bind(this),this.handlePredictionsSelectStart=this.handlePredictionsSelectStart.bind(this),this.handlePredictionsSelectMove=this.handlePredictionsSelectMove.bind(this),this.handlePredictionsSelectEnd=this.handlePredictionsSelectEnd.bind(this),this.finalizeSelection=this.finalizeSelection.bind(this),this.predict=a()(this.predict.bind(this),300,{leading:!0})}componentDidMount(){this._isMounted=!0}componentWillUnmount(){window.clearTimeout(this.shortQueryTimeout),this._isMounted=!1}getGeocoder(){const e=Q(this.props.config.maps.mapProvider).default;return this._geocoder||(this._geocoder=new e),this._geocoder}currentPredictions(){const{search:e,predictions:t}=q(this.props),{useDefaultPredictions:n,config:o}=this.props,i=t&&t.length>0,s=!e&&!i&&n,c=Q(o.maps.mapProvider),r=(o.maps.search.suggestCurrentLocation?[{id:c.CURRENT_LOCATION_ID,predictionPlace:{}}]:[]).concat(o.maps.search.defaults);return s?r:t}onKeyDown(e){if(38===e.keyCode)e.preventDefault(),this.changeHighlight("up");else if(40===e.keyCode)e.preventDefault(),this.changeHighlight(W);else if(13===e.keyCode){const{selectedPlace:t}=q(this.props);t||(e.preventDefault(),e.stopPropagation(),this.selectItemIfNoneSelected(),this.input.blur())}else 9===e.keyCode?(this.selectItemIfNoneSelected(),this.input.blur()):27===e.keyCode&&this.input&&this.input.blur()}onChange(e){const t=this.props.input.onChange,n=this.currentPredictions(),o=e.target.value;t({search:o,predictions:o?n:[],selectedPlace:null}),this.setState({highlightedIndex:-1}),o&&(o.length>=3?(this.shortQueryTimeout&&window.clearTimeout(this.shortQueryTimeout),this.predict(o)):this.shortQueryTimeout=window.setTimeout((()=>{this.predict(o)}),1e3))}changeHighlight(e){this.setState(((t,n)=>{const o=this.currentPredictions(),i=t.highlightedIndex;let s=i;return"up"===e?s=0===i?0:i-1:e===W&&(s=i+1),s<0?s=-1:s>=o.length&&(s=o.length-1),{highlightedIndex:s}}))}selectPrediction(e){var t,n;const o=null===(t=this.props.config.maps)||void 0===t||null===(n=t.search)||void 0===n?void 0:n.currentLocationBoundsDistance;this.props.input.onChange({...this.props.input,selectedPlace:null}),this.setState({fetchingPlaceDetails:!0}),this.getGeocoder().getPlaceDetails(e,o).then((e=>{this._isMounted&&(this.setState({fetchingPlaceDetails:!1}),this.props.input.onChange({search:e.address,predictions:[],selectedPlace:e}))})).catch((e=>{this.setState({fetchingPlaceDetails:!1}),console.error(e),this.props.input.onChange({...this.props.input.value,selectedPlace:null})}))}selectItemIfNoneSelected(){if(this.state.fetchingPredictions)return;const{search:e,selectedPlace:t}=q(this.props),n=this.currentPredictions();if(!t)if(n&&n.length>0){const e=-1!==this.state.highlightedIndex?this.state.highlightedIndex:0;this.selectPrediction(n[e])}else this.predict(e)}predict(e){const t=this.props.config,n=this.props.input.onChange;return this.setState({fetchingPredictions:!0}),this.getGeocoder().getPlacePredictions(e,t.maps.search.countryLimit,t.localization.locale).then((e=>{const{search:t}=q(this.props);this.setState({fetchingPredictions:!1}),e.search===t&&n({search:e.search,predictions:e.predictions,selectedPlace:null})})).catch((e=>{this.setState({fetchingPredictions:!1}),console.error(e);const t=q(this.props);n({...t,selectedPlace:null})}))}finalizeSelection(){this.setState({inputHasFocus:!1,highlightedIndex:-1}),this.props.input.onBlur(q(this.props))}handleOnBlur(){this.props.closeOnBlur&&!this.state.selectionInProgress&&this.finalizeSelection()}handlePredictionsSelectStart(e){this.setState({selectionInProgress:!0,touchStartedFrom:e,isSwipe:!1})}handlePredictionsSelectMove(e){this.setState((t=>{const n=t.touchStartedFrom;return{selectionInProgress:!1,isSwipe:!!!!n&&Math.abs(n.y-e.y)>5}}))}handlePredictionsSelectEnd(e){let t=!1;this.setState((e=>(e.isSwipe||(t=!0),{selectionInProgress:!1,touchStartedFrom:null,isSwipe:!1})),(()=>{t&&(this.selectPrediction(e),this.finalizeSelection())}))}render(){const{autoFocus:e,rootClassName:t,className:n,iconClassName:o,inputClassName:i,predictionsClassName:c,predictionsAttributionClassName:l,validClassName:a,placeholder:d,input:h,meta:m,inputRef:P,disabled:_,config:S}=this.props,{name:v,onFocus:L}=h,{search:I}=q(this.props),{touched:y,valid:x}=m||{},N=x&&y,C=this.currentPredictions(),E=r()(t||p,n),D=r()(o||g),A=r()(i||f,{[a]:N}),T=r()(c),k=this.state.inputHasFocus,M=Q(S.maps.mapProvider),O=M.GeocoderAttribution;return s.createElement("div",{className:E},s.createElement("div",{className:D},this.state.fetchingPlaceDetails?s.createElement(u.vM,{className:w}):s.createElement(b,null)),s.createElement("input",{className:A,type:"search",autoComplete:"off",autoFocus:e,placeholder:d,name:v,value:I,disabled:_||this.state.fetchingPlaceDetails,onFocus:e=>{this.setState({inputHasFocus:!0}),L(e)},onBlur:this.handleOnBlur,onChange:this.onChange,onKeyDown:this.onKeyDown,ref:e=>{this.input=e,P&&P(e)},"data-testid":"location-search"}),k?s.createElement(Z,{rootClassName:T,predictions:C,currentLocationId:M.CURRENT_LOCATION_ID,isGoogleMapsInUse:"googleMaps"===S.maps.mapProvider,geocoder:this.getGeocoder(),highlightedIndex:this.state.highlightedIndex,onSelectStart:this.handlePredictionsSelectStart,onSelectMove:this.handlePredictionsSelectMove,onSelectEnd:this.handlePredictionsSelectEnd},s.createElement(O,{className:l})):null)}}const J=e=>{const t=(0,d.mX)();return s.createElement(j,Object.assign({config:t},e))};J.defaultProps={autoFocus:!1,closeOnBlur:!0,rootClassName:null,className:null,iconClassName:null,inputClassName:null,predictionsClassName:null,predictionsAttributionClassName:null,validClassName:null,placeholder:"",useDefaultPredictions:!0,meta:null,inputRef:null};const V=J},90193:(e,t,n)=>{n.d(t,{Js:()=>h,Kl:()=>u,eD:()=>l,ek:()=>a,xX:()=>d});var o=n(66319);const{LatLng:i,LatLngBounds:s}=o.types,c=e=>e&&e.geometry&&e.geometry.location?new i(e.geometry.location.lat(),e.geometry.location.lng()):null,r=e=>{if(e&&e.geometry&&e.geometry.viewport){const t=e.geometry.viewport.getNorthEast(),n=e.geometry.viewport.getSouthWest();return new s(new i(t.lat(),t.lng()),new i(n.lat(),n.lng()))}return null},l=(e,t)=>new Promise(((n,o)=>{const i=window.google.maps.places.PlacesServiceStatus,s=document.createElement("div"),l=new window.google.maps.places.PlacesService(s),a=t?{sessionToken:t}:{};l.getDetails({placeId:e,fields:["address_component","formatted_address","geometry","place_id"],...a},((t,s)=>{s!==i.OK?o(new Error('Could not get details for place id "'.concat(e,'", error status was "').concat(s,'"'))):n({address:t.formatted_address,origin:c(t),bounds:r(t)})}))})),a=(e,t,n)=>new Promise(((o,i)=>{const s=new window.google.maps.places.AutocompleteService,c=t?{sessionToken:t}:{};s.getPlacePredictions({input:e,...c,...n},((t,n)=>{if((e=>{const{OK:t,ZERO_RESULTS:n}=window.google.maps.places.PlacesServiceStatus;return e===t||e===n})(n)){o({search:e,predictions:t||[]})}else i(new Error("Prediction service status not OK: ".concat(n)))}))})),d=(e,t)=>{const n=new window.google.maps.Circle({center:new window.google.maps.LatLng(e.lat,e.lng),radius:t}).getBounds(),o=n.getNorthEast(),c=n.getSouthWest();return new s(new i(o.lat(),o.lng()),new i(c.lat(),c.lng()))},h=(e,t)=>{const{getPixelPositionOffset:n}=t;return"function"===typeof n?n(e.offsetWidth,e.offsetHeight):{}},u=(e,t,n)=>{const o=(e,t)=>new t(e.lat,e.lng),i=(e,t)=>new t(new window.google.maps.LatLng(e.ne.lat,e.ne.lng),new window.google.maps.LatLng(e.sw.lat,e.sw.lng)),s=(e,t,n)=>e instanceof t?e:n(e,t);if(n.bounds){return((e,t,n)=>{const o=e.fromLatLngToDivPixel(n.getNorthEast()),i=e.fromLatLngToDivPixel(n.getSouthWest());return o&&i?{left:"".concat(i.x+t.x,"px"),top:"".concat(o.y+t.y,"px"),width:"".concat(o.x-i.x-t.x,"px"),height:"".concat(i.y-o.y-t.y,"px")}:{left:"-9999px",top:"-9999px"}})(e,t,s(n.bounds,window.google.maps.LatLngBounds,i))}return((e,t,n)=>{const o=e.fromLatLngToDivPixel(n);if(o){const{x:e,y:n}=o;return{left:"".concat(e+t.x,"px"),top:"".concat(n+t.y,"px")}}return{left:"-9999px",top:"-9999px"}})(e,t,s(n.position,window.google.maps.LatLng,o))}}}]);
//# sourceMappingURL=LocationAutocompleteInputImpl.1bc24855.chunk.js.map