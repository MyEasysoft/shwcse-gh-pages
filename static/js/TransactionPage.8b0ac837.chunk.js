"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[1173],{73008:(e,t,a)=>{a.r(t),a.d(t,{TransactionPageComponent:()=>fe,default:()=>ke});var s=a(72791),n=a(42789),i=a(47375),o=a(58272),l=a(41418),r=a.n(l),d=a(6639),c=a(86134),m=a(80948),u=a(53002),g=a(73665),v=a(53176),p=a(21102),E=a(7285),h=a(25863),M=a(46902),N=a(43093),P=a(81301),b=a(52745),_=a(67600),T=a(55470),I=a(78315),D=a(55269),w=a(84480);const S="DisputeModal_root__fYhdZ marketplaceModalBaseStyles",y="DisputeModal_modalContent__K900t",C="DisputeModal_modalIcon__3lXfI marketplaceModalIconStyles",f="DisputeModal_modalTitle__zcpYJ marketplaceModalTitleStyles",k="DisputeModal_modalMessage__LihTB marketplaceModalParagraphStyles",F="DisputeModal_formRoot__kyVhn",R="DisputeModal_errorPlaceholder__tGpUX",Z="DisputeModal_disputeMessage__hzvM5",B="DisputeModal_submitButton__U5hSU",H=e=>s.createElement(D.l0,Object.assign({},e,{render:e=>{const{className:t,rootClassName:a,disabled:n,handleSubmit:i,intl:o,formId:l,invalid:d,disputeSubmitted:c,disputeError:u,disputeInProgress:g}=e,v=u?s.createElement(m._H,{id:"DisputeModal.disputeSubmitFailed"}):null,p=r()(a||F,t),E=d||n||g||c;return s.createElement(P.l0,{className:p,onSubmit:i},s.createElement(P.gC,{className:Z,type:"textarea",id:l?"".concat(l,".disputeReason"):"disputeReason",name:"disputeReason",label:o.formatMessage({id:"DisputeModal.label"}),placeholder:o.formatMessage({id:"DisputeModal.disputePlaceholder"}),validate:(0,w.C1)(o.formatMessage({id:"DisputeModal.disputeReasonRequired"}))}),s.createElement("p",{className:R},v),s.createElement(P.KM,{className:B,type:"submit",inProgress:g,disabled:E,ready:c},o.formatMessage({id:"DisputeModal.submit"})))}})),O=e=>{const t=(0,d.mX)().marketplaceName;return s.createElement(s.Fragment,null,s.createElement("p",{className:f},s.createElement(m._H,{id:"DisputeModal.title"})),s.createElement("p",{className:k},s.createElement(m._H,{id:"DisputeModal.description",values:{marketplaceName:t}})),s.createElement(H,{onSubmit:e.onDisputeOrder,disputeSubmitted:e.disputeSubmitted,disputeInProgress:e.disputeInProgress,disputeError:e.disputeError,intl:e.intl}))},L=e=>s.createElement(s.Fragment,null,s.createElement("p",{className:f},s.createElement(m._H,{id:"DisputeModal.sentTitle"})),s.createElement("p",{className:k},s.createElement(m._H,{id:"DisputeModal.sentMessage"})),s.createElement("p",{className:k},s.createElement(m._H,{id:"DisputeModal.sentNextStep"}))),A=e=>{const{className:t,rootClassName:a,id:n,intl:i,isOpen:o,onCloseModal:l,onManageDisableScrolling:d,onDisputeOrder:c,disputeSubmitted:m,disputeInProgress:u,disputeError:g}=e,v=r()(a||S,t);return s.createElement(P.u_,{id:n,containerClassName:v,contentClassName:y,isOpen:o,onClose:l,onManageDisableScrolling:d,usePortal:!0,closeButtonMessage:i.formatMessage({id:"DisputeModal.close"})},s.createElement(P.qm,{className:C}),m?s.createElement(L,null):s.createElement(O,{onDisputeOrder:c,disputeSubmitted:m,disputeInProgress:u,disputeError:g,intl:i}))};A.defaultProps={className:null,rootClassName:null,isOpen:!1,disputeSubmitted:!1,disputeInProgress:!1,disputeError:null};const W=(0,m.XN)(A);var U=a(52007),q=a.n(U),V=a(49523);const x="ReviewModal_root__fIlBS marketplaceModalBaseStyles",X="ReviewModal_modalContent__db5Iu",Y="ReviewModal_modalIcon__mOvmv marketplaceModalIconStyles",z="ReviewModal_modalTitle__pDkDS marketplaceModalTitleStyles",G="ReviewModal_reviewee__4Vr8h",J="ReviewModal_modalMessage__outW6 marketplaceModalParagraphStyles",K=e=>{const{className:t,rootClassName:a,id:n,marketplaceName:i,intl:o,isOpen:l,onCloseModal:d,onManageDisableScrolling:c,onSubmitReview:u,revieweeName:g,reviewSent:v,sendReviewInProgress:p,sendReviewError:E}=e,h=r()(a||x,t),M=o.formatMessage({id:"ReviewModal.later"}),N=s.createElement("span",{className:G},g);return s.createElement(P.u_,{id:n,containerClassName:h,contentClassName:X,isOpen:l,onClose:d,onManageDisableScrolling:c,usePortal:!0,closeButtonMessage:M},s.createElement(P.sX,{className:Y}),s.createElement("p",{className:z},s.createElement(m._H,{id:"ReviewModal.title",values:{revieweeName:N}})),s.createElement("p",{className:J},s.createElement(m._H,{id:"ReviewModal.description",values:{marketplaceName:i}})),s.createElement(V.Z,{onSubmit:u,reviewSent:v,sendReviewInProgress:p,sendReviewError:E}))},{bool:j,string:Q}=q();K.defaultProps={className:null,rootClassName:null,reviewSent:!1,sendReviewInProgress:!1,sendReviewError:null};const $=(0,m.XN)(K);var ee=a(62887),te=a(10314);var ae=a(89654),se=a(8413);const ne=e=>{const{className:t,rootClassName:a,orderBreakdown:n,processName:i}=e,o=r()(a||se.Z.breakdownMaybe,t);return n?s.createElement("div",{className:o},s.createElement(P.H6,{as:"h3",className:se.Z.orderBreakdownTitle},s.createElement(m._H,{id:"TransactionPanel.".concat(i,".orderBreakdownTitle")})),s.createElement("hr",{className:se.Z.totalDivider}),n):null};var ie=a(79908);const oe=e=>{const{showDetailCardHeadings:t,listingTitle:a,subTitle:n,showPrice:i,price:o,intl:l}=e;return t?s.createElement("div",{className:se.Z.detailCardHeadings},s.createElement(P.H4,{as:"h2",className:se.Z.detailCardTitle},a,i&&o?s.createElement(s.Fragment,null,s.createElement("br",null),s.createElement("span",{className:se.Z.inquiryPrice},(0,ie.lb)(l,o))):null),n?s.createElement("p",{className:se.Z.detailCardSubtitle},n):null):null},le=e=>{var t;const{className:a,rootClassName:n,avatarWrapperClassName:i,listingTitle:o,image:l,provider:d,isCustomer:c,listingImageConfig:m}=e,u=r()(n||se.Z.detailCardImageWrapper,a),{aspectWidth:g=1,aspectHeight:v=1,variantPrefix:p="listing-card"}=m,E=l?Object.keys(null===l||void 0===l||null===(t=l.attributes)||void 0===t?void 0:t.variants).filter((e=>e.startsWith(p))):[];return s.createElement(s.Fragment,null,s.createElement(P.Zz,{width:g,height:v,className:u},s.createElement(P.t3,{rootClassName:se.Z.rootForImage,alt:o,image:l,variants:E})),c?s.createElement("div",{className:i||se.Z.avatarWrapper},s.createElement(P.Jh,{user:d})):null)};var re=a(60775);const de=e=>{const{className:t,rootClassName:a,linkRootClassName:n,location:i,geolocation:o,showAddress:l}=e,{address:d,building:c}=i||{},{lat:u,lng:g}=o||{},v=o?"https://maps.google.com/?q=".concat(u,",").concat(g):d?"https://maps.google.com/?q=".concat(encodeURIComponent(d)):null,p="string"===typeof c&&c.length>0?"".concat(c,", ").concat(d):d,E=r()(a||se.Z.address,t);return l&&v?s.createElement("p",{className:E},p," ",s.createElement("br",null),s.createElement("span",{className:se.Z.viewOnGoogleMapsWrapper},s.createElement(P.dL,{className:n,href:v},s.createElement(m._H,{id:"AddressLinkMaybe.viewOnGoogleMaps"})))):null},ce=e=>{const{className:t,rootClassName:a,protectedData:n,listing:i,locale:o}=e,l=r()(a||se.Z.deliveryInfoContainer,t),d=null===n||void 0===n?void 0:n.deliveryMethod,c="shipping"===d;if("pickup"===d){var u,g,v;const e=(null===i||void 0===i||null===(u=i.attributes)||void 0===u||null===(g=u.publicData)||void 0===g?void 0:g.location)||{};return s.createElement("div",{className:l},s.createElement(P.X6,{as:"h3",rootClassName:se.Z.sectionHeading},s.createElement(m._H,{id:"TransactionPanel.pickupInfoHeading"})),s.createElement("div",{className:se.Z.pickupInfoContent},s.createElement(de,{linkRootClassName:se.Z.pickupAddress,location:e,geolocation:null===i||void 0===i||null===(v=i.attributes)||void 0===v?void 0:v.geolocation,showAddress:!0})))}if(c){const{name:e,phoneNumber:t,address:a}=(null===n||void 0===n?void 0:n.shippingDetails)||{},{line1:i,line2:r,city:d,postalCode:c,state:u,country:g}=a||{},v=t?s.createElement(s.Fragment,null,t,s.createElement("br",null)):null,p=(0,re.Z)(o).find((e=>e.code===g)),E=null===p||void 0===p?void 0:p.name;return s.createElement("div",{className:l},s.createElement(P.X6,{as:"h3",rootClassName:se.Z.sectionHeading},s.createElement(m._H,{id:"TransactionPanel.shippingInfoHeading"})),s.createElement("div",{className:se.Z.shippingInfoContent},e,s.createElement("br",null),v,i,r?", ".concat(r):"",s.createElement("br",null),c,", ",d,s.createElement("br",null),u?"".concat(u,", "):"",E,s.createElement("br",null)))}return null},me=e=>{const{className:t,rootClassName:a,listing:n,showBookingLocation:i}=e,o=r()(a||se.Z.bookingLocationContainer,t);if(i){var l,d,c;const e=(null===n||void 0===n||null===(l=n.attributes)||void 0===l||null===(d=l.publicData)||void 0===d?void 0:d.location)||{};return s.createElement("div",{className:o},s.createElement(P.X6,{as:"h3",rootClassName:se.Z.sectionHeading},s.createElement(m._H,{id:"TransactionPanel.bookingLocationHeading"})),s.createElement("div",{className:se.Z.bookingLocationContent},s.createElement(de,{linkRootClassName:se.Z.bookingLocationAddress,location:e,geolocation:null===n||void 0===n||null===(c=n.attributes)||void 0===c?void 0:c.geolocation,showAddress:!0})))}return null},ue=e=>{const{className:t,rootClassName:a,protectedData:n,showInquiryMessage:i,isCustomer:o}=e,l=r()(a||se.Z.deliveryInfoContainer,t),d=o?se.Z.ownInquiryMessage:se.Z.inquiryMessage;return i?s.createElement("div",{className:l},s.createElement(P.X6,{as:"h3",rootClassName:se.Z.sectionHeading},s.createElement(m._H,{id:"TransactionPanel.inquiryMessageHeading"})),s.createElement("p",{className:d},null===n||void 0===n?void 0:n.inquiryMessage)):null},ge=e=>{const{className:t,rootClassName:a,activityFeed:n,hasTransitions:i,fetchMessagesError:o,initialMessageFailed:l,hasMessages:d,isConversation:c}=e,u=d||i||l||o,g=r()(a||se.Z.feedContainer,t);return u?s.createElement("div",{className:g},s.createElement(P.X6,{as:"h3",rootClassName:se.Z.sectionHeading},c?s.createElement(m._H,{id:"TransactionPanel.conversationHeading"}):s.createElement(m._H,{id:"TransactionPanel.activityHeading"})),l?s.createElement("p",{className:se.Z.messageError},s.createElement(m._H,{id:"TransactionPanel.initialMessageFailed"})):null,o?s.createElement("p",{className:se.Z.messageError},s.createElement(m._H,{id:"TransactionPanel.messageLoadingFailed"})):null,s.createElement("div",{className:se.Z.feedContent},n)):null},ve=e=>{const{className:t,rootClassName:a,showButtons:n,primaryButtonProps:i,secondaryButtonProps:o,isListingDeleted:l,isProvider:d}=e;if(l&&d)return null;const c=(null===i||void 0===i?void 0:i.inProgress)||(null===o||void 0===o?void 0:o.inProgress),m=i?s.createElement(P.KM,{inProgress:i.inProgress,disabled:c,onClick:i.onAction},i.buttonText):null,u=null!==i&&void 0!==i&&i.error?s.createElement("p",{className:se.Z.actionError},null===i||void 0===i?void 0:i.errorText):null,g=o?s.createElement(P.kq,{inProgress:null===o||void 0===o?void 0:o.inProgress,disabled:c,onClick:o.onAction},o.buttonText):null,v=null!==o&&void 0!==o&&o.error?s.createElement("p",{className:se.Z.actionError},null===o||void 0===o?void 0:o.errorText):null,p=r()(a||se.Z.actionButtons,t);return n?s.createElement("div",{className:p},s.createElement("div",{className:se.Z.actionErrors},u,v),s.createElement("div",{className:se.Z.actionButtonWrapper},g,m)):null},pe=e=>{const{className:t,rootClassName:a,showDispute:n,onOpenDisputeModal:i}=e,o=i?s.createElement(P.T5,{className:se.Z.diminishedActionButton,onClick:i},s.createElement(m._H,{id:"TransactionPanel.disputeOrder"})):null,l=r()(a||se.Z.diminishedActionButtonRoot,t);return n?s.createElement("div",{className:l},o):null};var Ee=a(75746);class he extends s.Component{constructor(e){super(e),this.state={sendMessageFormFocused:!1},this.isMobSaf=!1,this.sendMessageFormName="TransactionPanel.SendMessageForm",this.onSendMessageFormFocus=this.onSendMessageFormFocus.bind(this),this.onSendMessageFormBlur=this.onSendMessageFormBlur.bind(this),this.onMessageSubmit=this.onMessageSubmit.bind(this),this.scrollToMessage=this.scrollToMessage.bind(this)}componentDidMount(){this.isMobSaf=(()=>{if(!window)return!1;const e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),a=!!e.match(/WebKit/i);return t&&a})()}onSendMessageFormFocus(){this.setState({sendMessageFormFocused:!0}),this.isMobSaf&&window.scroll({top:document.body.scrollHeight,left:0,behavior:"smooth"})}onSendMessageFormBlur(){this.setState({sendMessageFormFocused:!1})}onMessageSubmit(e,t){const a=e.message?e.message.trim():null,{transactionId:s,onSendMessage:n,config:i}=this.props;a&&n(s,a,i).then((e=>{t.reset(),this.scrollToMessage(e)})).catch((e=>{}))}scrollToMessage(e){const t="#msg-".concat(e.uuid),a=document.querySelector(t);a&&a.scrollIntoView({block:"start",behavior:"smooth"})}render(){var e,t,a,n,i,o,l,d,c,u,g,v,E;const{rootClassName:h,className:M,currentUser:N,transactionRole:b,listing:_,customer:T,provider:I,hasTransitions:D,protectedData:w,messages:S,initialMessageFailed:y,savePaymentMethodFailed:C,fetchMessagesError:f,sendMessageInProgress:k,sendMessageError:F,onOpenDisputeModal:R,intl:Z,stateData:B,showBookingLocation:H,activityFeed:O,isInquiryProcess:L,orderBreakdown:A,orderPanel:W,config:U}=this.props,q="customer"===b,V="provider"===b,x=!(null===_||void 0===_||null===(e=_.attributes)||void 0===e||!e.deleted),X=!(null===T||void 0===T||null===(t=T.attributes)||void 0===t||!t.banned),Y=!(null===T||void 0===T||null===(a=T.attributes)||void 0===a||!a.deleted),z=!(null===I||void 0===I||null===(n=I.attributes)||void 0===n||!n.banned),G=!(null===I||void 0===I||null===(i=I.attributes)||void 0===i||!i.deleted),{authorDisplayName:J,customerDisplayName:K,otherUserDisplayNameString:j}=((e,t,a,n)=>{var i,o;const l=s.createElement(P.GI,{user:t,intl:n}),r=s.createElement(P.GI,{user:a,intl:n});let d="",c="";const m=e.id&&(null===a||void 0===a?void 0:a.id)&&e.id.uuid===(null===a||void 0===a||null===(i=a.id)||void 0===i?void 0:i.uuid),u=e.id&&(null===t||void 0===t?void 0:t.id)&&e.id.uuid===(null===t||void 0===t||null===(o=t.id)||void 0===o?void 0:o.uuid);return m?(d=l,c=(0,te.d8)(t,"")):u&&(d=r,c=(0,te.d8)(a,"")),{authorDisplayName:l,customerDisplayName:r,otherUserDisplayName:d,otherUserDisplayNameString:c}})(N,I,T,Z),Q=Z.formatMessage({id:"TransactionPanel.deletedListingTitle"}),$=x?Q:null===_||void 0===_||null===(o=_.attributes)||void 0===o?void 0:o.title,ie=(null===_||void 0===_||null===(l=_.images)||void 0===l?void 0:l.length)>0?null===_||void 0===_?void 0:_.images[0]:null,re=s.createElement(ve,{showButtons:B.showActionButtons,primaryButtonProps:null===B||void 0===B?void 0:B.primaryButtonProps,secondaryButtonProps:null===B||void 0===B?void 0:B.secondaryButtonProps,isListingDeleted:x,isProvider:V}),de=null===_||void 0===_||null===(d=_.attributes)||void 0===d||null===(c=d.publicData)||void 0===c?void 0:c.listingType,he=U.listing.listingTypes.find((e=>e.listingType===de)),Me=L&&(0,ee.ED)(he),Ne=!X&&!Y&&!z&&!G,Pe=(null===w||void 0===w?void 0:w.deliveryMethod)||"none",be=r()(h||se.Z.root,M);return s.createElement("div",{className:be},s.createElement("div",{className:se.Z.container},s.createElement("div",{className:se.Z.txInfo},s.createElement(le,{rootClassName:se.Z.imageWrapperMobile,avatarWrapperClassName:se.Z.avatarWrapperMobile,listingTitle:$,image:ie,provider:I,isCustomer:q,listingImageConfig:U.layout.listingImage}),V?s.createElement("div",{className:se.Z.avatarWrapperProviderDesktop},s.createElement(P.Vt,{user:T,className:se.Z.avatarDesktop})):null,s.createElement(Ee.Z,{processName:B.processName,processState:B.processState,showExtraInfo:B.showExtraInfo,showPriceOnMobile:Me,price:null===_||void 0===_||null===(u=_.attributes)||void 0===u?void 0:u.price,intl:Z,deliveryMethod:Pe,isPendingPayment:!!B.isPendingPayment,transactionRole:b,providerName:J,customerName:K,isCustomerBanned:X,listingId:null===_||void 0===_||null===(g=_.id)||void 0===g?void 0:g.uuid,listingTitle:$,listingDeleted:x}),s.createElement(ue,{protectedData:w,showInquiryMessage:L,isCustomer:q}),L?null:s.createElement("div",{className:se.Z.orderDetails},s.createElement("div",{className:se.Z.orderDetailsMobileSection},s.createElement(ne,{orderBreakdown:A,processName:B.processName}),s.createElement(pe,{showDispute:B.showDispute,onOpenDisputeModal:R})),C?s.createElement("p",{className:se.Z.genericError},s.createElement(m._H,{id:"TransactionPanel.savePaymentMethodFailed",values:{paymentMethodsPageLink:s.createElement(P.RC,{name:"PaymentMethodsPage"},s.createElement(m._H,{id:"TransactionPanel.paymentMethodsPageLink"}))}})):null,s.createElement(ce,{className:se.Z.deliveryInfoSection,protectedData:w,listing:_,locale:U.localization.locale}),s.createElement(me,{className:se.Z.deliveryInfoSection,listing:_,showBookingLocation:H})),s.createElement(ge,{rootClassName:se.Z.feedContainer,hasMessages:S.length>0,hasTransitions:D,fetchMessagesError:f,initialMessageFailed:y,activityFeed:O,isConversation:L}),Ne?s.createElement(ae.Z,{formId:this.sendMessageFormName,rootClassName:se.Z.sendMessageForm,messagePlaceholder:Z.formatMessage({id:"TransactionPanel.sendMessagePlaceholder"},{name:j}),inProgress:k,sendMessageError:F,onFocus:this.onSendMessageFormFocus,onBlur:this.onSendMessageFormBlur,onSubmit:this.onMessageSubmit}):s.createElement("div",{className:se.Z.sendingMessageNotAllowed},s.createElement(m._H,{id:"TransactionPanel.sendingMessageNotAllowed"})),B.showActionButtons?s.createElement(s.Fragment,null,s.createElement("div",{className:se.Z.mobileActionButtonSpacer}),s.createElement("div",{className:se.Z.mobileActionButtons},re)):null),s.createElement("div",{className:se.Z.asideDesktop},s.createElement("div",{className:se.Z.stickySection},s.createElement("div",{className:se.Z.detailCard},s.createElement(le,{avatarWrapperClassName:se.Z.avatarWrapperDesktop,listingTitle:$,image:ie,provider:I,isCustomer:q,listingImageConfig:U.layout.listingImage}),s.createElement(oe,{showDetailCardHeadings:B.showDetailCardHeadings,listingTitle:x?$:s.createElement(P.RC,{name:"ListingPage",params:{id:null===(v=_.id)||void 0===v?void 0:v.uuid,slug:(0,p.qi)($)}},$),showPrice:Me,price:null===_||void 0===_||null===(E=_.attributes)||void 0===E?void 0:E.price,intl:Z}),B.showOrderPanel?W:null,s.createElement(ne,{className:se.Z.breakdownContainer,orderBreakdown:A,processName:B.processName}),B.showActionButtons?s.createElement("div",{className:se.Z.desktopActionButtons},re):null),s.createElement(pe,{showDispute:B.showDispute,onOpenDisputeModal:R})))))}}he.defaultProps={rootClassName:null,className:null,currentUser:null,listing:null,customer:null,provider:null,hasTransitions:!1,fetchMessagesError:null,initialMessageFailed:!1,savePaymentMethodFailed:!1,sendMessageError:null,sendReviewError:null,stateData:{},activityFeed:null,showBookingLocation:!1,orderBreakdown:null,orderPanel:null};const Me=(0,m.XN)(he);var Ne=a(44594);const Pe="TransactionPage_root__pFunE",be="TransactionPage_loading__wApW9",_e="TransactionPage_error__z8nzA TransactionPage_loading__wApW9",Te="TransactionPage_tabContent__vhSQp",Ie="TransactionPage_tabContentVisible__UWgq+",De="TransactionPage_breakdown__21PAc",we="TransactionPage_orderPanel__JuHgu",Se="TransactionPage_orderTitle__3FPJd",ye="TransactionPage_orderPanelTitle__LWkWH",Ce=(e,t,a,s)=>n=>{const{disputeReason:i}=n;a(e,t,i?{protectedData:{disputeReason:i}}:{}).then((e=>s(!0))).catch((e=>{}))},fe=e=>{var t,a,n,i,o,l,h,M,N,D,w,S,y,C,f,k,F,R,Z,B,H,O;const[L,A]=(0,s.useState)(!1),[U,q]=(0,s.useState)(!1),[V,x]=(0,s.useState)(!1),[X,Y]=(0,s.useState)(!1),z=(0,d.mX)(),G=(0,c.a5)(),{currentUser:J,initialMessageFailedToTransaction:K,savePaymentMethodFailed:j,fetchMessagesError:Q,fetchMessagesInProgress:ee,totalMessagePages:te,oldestMessagePageFetched:ae,fetchTransactionError:se,history:ne,intl:ie,messages:oe,onManageDisableScrolling:le,onSendMessage:re,onSendReview:de,onShowMoreMessages:ce,params:me,scrollingDisabled:ue,sendMessageError:ge,sendMessageInProgress:ve,sendReviewError:pe,sendReviewInProgress:Ee,transaction:he,transactionRole:Ne,transitionInProgress:fe,transitionError:ke,onTransition:Fe,monthlyTimeSlots:Re,onFetchTimeSlots:Ze,nextTransitions:Be,callSetInitialValues:He,onInitializeCardPaymentData:Oe,onFetchTransactionLineItems:Le,lineItems:Ae,fetchLineItemsInProgress:We,fetchLineItemsError:Ue}=e,{listing:qe,provider:Ve,customer:xe,booking:Xe}=he||{},Ye=(null===he||void 0===he||null===(t=he.attributes)||void 0===t?void 0:t.transitions)||[],ze=Ne===E.Q,Ge=Ne===E.AL,Je=(0,E.b$)(null===he||void 0===he||null===(a=he.attributes)||void 0===a?void 0:a.processName);let Ke=null;try{Ke=Je?(0,E.Yt)(Je):null}catch(_t){}const je=(e,t)=>{const{setInitialValues:a}=(0,u.dI)("CheckoutPage",G);He(a,e),Oe(),ne.push((0,u.EW)("CheckoutPage",G,{id:t.id.uuid,slug:(0,p.qi)(t.attributes.title)},{}))};if(null!==he&&void 0!==he&&he.id&&(Qe=he,Ke&&Ke.getState(Qe)===Ke.states.PENDING_PAYMENT)&&Ge&&he.attributes.lineItems){je({listing:qe,transaction:he,orderData:{}},qe)}var Qe;const $e=()=>{x(!0)},et=ie.formatMessage({id:"TransactionPage.deletedListing"}),tt=null===qe||void 0===qe||null===(n=qe.attributes)||void 0===n?void 0:n.deleted,at=tt?et:null===qe||void 0===qe||null===(i=qe.attributes)||void 0===i?void 0:i.title,st=Ke&&J&&(null===he||void 0===he?void 0:he.id)&&(null===he||void 0===he||null===(o=he.id)||void 0===o?void 0:o.uuid)===me.id&&(null===he||void 0===he||null===(l=he.attributes)||void 0===l?void 0:l.lineItems)&&he.customer&&he.provider&&!se,nt=st&&ze&&J.id.uuid===(null===Ve||void 0===Ve||null===(h=Ve.id)||void 0===h?void 0:h.uuid),it=st&&Ge&&J.id.uuid===(null===xe||void 0===xe||null===(M=xe.id)||void 0===M?void 0:M.uuid);if(st&&ze&&!nt)return console.error("Tried to access a sale that was not owned by the current user"),s.createElement(P.d9,{name:"InboxPage",params:{tab:"sales"}});if(st&&Ge&&!it)return console.error("Tried to access an order that was not owned by the current user"),s.createElement(P.d9,{name:"InboxPage",params:{tab:"orders"}});const ot=r()(Te,Ie),lt=Ge?"TransactionPage.fetchOrderFailed":"TransactionPage.fetchSaleFailed",rt=Ge?"TransactionPage.loadingOrderData":"TransactionPage.loadingSaleData",dt=se?s.createElement("p",{className:_e},s.createElement(m._H,{id:"".concat(lt)})):he&&!Ke?s.createElement("div",{className:_e},s.createElement(m._H,{id:"TransactionPage.unknownTransactionProcess"})):s.createElement("div",{className:be},s.createElement(m._H,{id:"".concat(rt)}),s.createElement(P.vM,null)),ct=!(!K||K.uuid!==(null===he||void 0===he||null===(N=he.id)||void 0===N?void 0:N.uuid)),mt=it?s.createElement(P.GI,{user:Ve,intl:ie}):s.createElement(P.GI,{user:xe,intl:ie}),ut=st?(0,T.O)({transaction:he,transactionRole:Ne,nextTransitions:Be,transitionInProgress:fe,transitionError:ke,sendReviewInProgress:Ee,sendReviewError:pe,onTransition:Fe,onOpenReviewModal:$e,intl:ie},Ke):{},gt=(null===he||void 0===he||null===(D=he.attributes)||void 0===D||null===(w=D.lineItems)||void 0===w?void 0:w.length)>0,vt=gt?null===(S=he.attributes)||void 0===S||null===(y=S.lineItems)||void 0===y?void 0:y.find((e=>g.Y8.includes(e.code)&&!e.reversal)):null,pt=vt?vt.code:st?((e,t)=>{var a,s,n,i;const o=null===e||void 0===e||null===(a=e.attributes)||void 0===a||null===(s=a.protectedData)||void 0===s?void 0:s.unitType,l=null===t||void 0===t||null===(n=t.attributes)||void 0===n||null===(i=n.publicData)||void 0===i?void 0:i.unitType;return"line-item/".concat(o||l)})(he,qe):null,Et=null===qe||void 0===qe||null===(C=qe.attributes)||void 0===C||null===(f=C.availabilityPlan)||void 0===f?void 0:f.timezone,ht=pt===g.PC?g.In:g.FJ,Mt=null!==Xe&&void 0!==Xe&&Xe.id?{booking:Xe,dateType:ht,timeZone:Et}:{},Nt=gt?{orderBreakdown:s.createElement(P.J0,Object.assign({className:De,userRole:Ne,transaction:he},Mt,{currency:z.currency,marketplaceName:z.marketplaceName}))}:{},Pt=(0,E.YL)(ut.processName)&&(null===(k=Ke)||void 0===k?void 0:k.hasPassedState(null===(F=Ke)||void 0===F||null===(R=F.states)||void 0===R?void 0:R.ACCEPTED,he)),bt=st?s.createElement(Me,Object.assign({className:ot,currentUser:J,transactionId:null===he||void 0===he?void 0:he.id,listing:qe,customer:xe,provider:Ve,hasTransitions:Ye.length>0,protectedData:null===he||void 0===he||null===(Z=he.attributes)||void 0===Z?void 0:Z.protectedData,messages:oe,initialMessageFailed:ct,savePaymentMethodFailed:j,fetchMessagesError:Q,sendMessageInProgress:ve,sendMessageError:ge,onSendMessage:re,onOpenDisputeModal:()=>{A(!0)},stateData:ut,transactionRole:Ne,showBookingLocation:Pt,activityFeed:s.createElement(I.Z,{messages:oe,transaction:he,stateData:ut,intl:ie,currentUser:J,hasOlderMessages:te>ae&&!ee,onOpenReviewModal:$e,onShowOlderMessages:()=>ce(he.id,z),fetchMessagesInProgress:ee}),isInquiryProcess:Je===E.N5,config:z},Nt,{orderPanel:s.createElement(P.el,{className:we,titleClassName:Se,listing:qe,isOwnListing:nt,lineItemUnitType:pt,title:at,titleDesktop:s.createElement(P.H4,{as:"h2",className:ye},tt?at:s.createElement(P.RC,{name:"ListingPage",params:{id:null===(B=qe.id)||void 0===B?void 0:B.uuid,slug:(0,p.qi)(at)}},at)),author:Ve,onSubmit:e=>{const{bookingDates:t,bookingStartTime:a,bookingEndTime:s,quantity:n,deliveryMethod:i,...o}=e,l=t?{bookingDates:{bookingStart:t.startDate,bookingEnd:t.endDate}}:a&&s?{bookingDates:{bookingStart:(0,v.Ft)(a),bookingEnd:(0,v.Ft)(s)}}:{},r=Number.parseInt(n,10),d=Number.isInteger(r)?{quantity:r}:{},c={listing:qe,transaction:he,orderData:{...l,...d,...i?{deliveryMethod:i}:{},...o},confirmPaymentError:null};je(c,qe)},onManageDisableScrolling:le,onFetchTimeSlots:Ze,monthlyTimeSlots:Re,onFetchTransactionLineItems:Le,lineItems:Ae,fetchLineItemsInProgress:We,fetchLineItemsError:Ue,validListingTypes:z.listing.listingTypes,marketplaceCurrency:z.currency,dayCountAvailableForBooking:z.stripe.dayCountAvailableForBooking,marketplaceName:z.marketplaceName})})):dt;return s.createElement(P.T3,{title:ie.formatMessage({id:"TransactionPage.schemaTitle"},{title:at}),scrollingDisabled:ue},s.createElement(P.ip,{topbar:s.createElement(b.Z,null),footer:s.createElement(_.Z,null)},s.createElement("div",{className:Pe},bt),s.createElement($,{id:"ReviewOrderModal",isOpen:V,onCloseModal:()=>x(!1),onManageDisableScrolling:le,onSubmitReview:e=>{const{reviewRating:t,reviewContent:a}=e,s=Number.parseInt(t,10),{states:n,transitions:i}=Ke,o=Ne===E.AL?{reviewAsFirst:i.REVIEW_1_BY_CUSTOMER,reviewAsSecond:i.REVIEW_2_BY_CUSTOMER,hasOtherPartyReviewedFirst:Ke.getTransitionsToStates([n.REVIEWED_BY_PROVIDER]).includes(he.attributes.lastTransition)}:{reviewAsFirst:i.REVIEW_1_BY_PROVIDER,reviewAsSecond:i.REVIEW_2_BY_PROVIDER,hasOtherPartyReviewedFirst:Ke.getTransitionsToStates([n.REVIEWED_BY_CUSTOMER]).includes(he.attributes.lastTransition)};de(he,o,{reviewRating:s,reviewContent:a},z).then((e=>{x(!1),Y(!0)})).catch((e=>{}))},revieweeName:mt,reviewSent:X,sendReviewInProgress:Ee,sendReviewError:pe,marketplaceName:z.marketplaceName}),null!==(H=Ke)&&void 0!==H&&null!==(O=H.transitions)&&void 0!==O&&O.DISPUTE?s.createElement(W,{id:"DisputeOrderModal",isOpen:L,onCloseModal:()=>A(!1),onManageDisableScrolling:le,onDisputeOrder:Ce(null===he||void 0===he?void 0:he.id,Ke.transitions.DISPUTE,Fe,q),disputeSubmitted:U,disputeInProgress:fe===Ke.transitions.DISPUTE,disputeError:ke}):null))};fe.defaultProps={currentUser:null,fetchTransactionError:null,transitionInProgress:null,transitionError:null,transaction:null,fetchMessagesError:null,initialMessageFailedToTransaction:null,savePaymentMethodFailed:!1,sendMessageError:null,monthlyTimeSlots:null,fetchTimeSlotsError:null,lineItems:null,fetchLineItemsError:null};const ke=(0,n.qC)(o.EN,(0,i.$j)((e=>{const{fetchTransactionError:t,transitionInProgress:a,transitionError:s,transactionRef:n,fetchMessagesInProgress:i,fetchMessagesError:o,totalMessagePages:l,oldestMessagePageFetched:r,messages:d,initialMessageFailedToTransaction:c,savePaymentMethodFailed:m,sendMessageInProgress:u,sendMessageError:g,sendReviewInProgress:v,sendReviewError:p,monthlyTimeSlots:E,processTransitions:N,lineItems:P,fetchLineItemsInProgress:b,fetchLineItemsError:_}=e.TransactionPage,{currentUser:T}=e.user,I=(0,h.EV)(e,n?[n]:[]),D=I.length>0?I[0]:null;return{currentUser:T,fetchTransactionError:t,transitionInProgress:a,transitionError:s,scrollingDisabled:(0,M.uS)(e),transaction:D,fetchMessagesInProgress:i,fetchMessagesError:o,totalMessagePages:l,oldestMessagePageFetched:r,messages:d,initialMessageFailedToTransaction:c,savePaymentMethodFailed:m,sendMessageInProgress:u,sendMessageError:g,sendReviewInProgress:v,sendReviewError:p,monthlyTimeSlots:E,nextTransitions:N,lineItems:P,fetchLineItemsInProgress:b,fetchLineItemsError:_}}),(e=>({onTransition:(t,a,s)=>e((0,Ne.Vr)(t,a,s)),onShowMoreMessages:(t,a)=>e((0,Ne.EP)(t,a)),onSendMessage:(t,a,s)=>e((0,Ne.bG)(t,a,s)),onManageDisableScrolling:(t,a)=>e((0,M.R4)(t,a)),onSendReview:(t,a,s,n)=>e((0,Ne.se)(t,a,s,n)),callSetInitialValues:(t,a)=>e(t(a)),onInitializeCardPaymentData:()=>e((0,N.aw)()),onFetchTransactionLineItems:(t,a,s)=>e((0,Ne.An)(t,a,s)),onFetchTimeSlots:(t,a,s,n)=>e((0,Ne.HA)(t,a,s,n))}))),m.XN)(fe)}}]);
//# sourceMappingURL=TransactionPage.8b0ac837.chunk.js.map